var lt=Object.defineProperty;var se=(r,t,e)=>t in r?lt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var V=(r,t)=>{for(var e in t)lt(r,e,{get:t[e],enumerable:!0})};var Y=(r,t,e)=>(se(r,typeof t!="symbol"?t+"":t,e),e);var cr=class{assets=new Map;toLoad=0;loadImage(t,e){let i=new Image;i.src=e,i.crossOrigin="Anonymous";let n=new Promise(s=>{i.onload=()=>{s(i)}});return this.addAsync(t,n),n}loadAudio(t,e){let i=fetch(e).then(n=>n.arrayBuffer()).then(n=>M.audio.audioContext.decodeAudioData(n));return this.addAsync(t,i),i}addAsync(t,e){++this.toLoad,e.then(i=>{this.assets.set(t,i),--this.toLoad})}waitForAssetsToLoad(){return new Promise(t=>{let e=()=>{this.toLoad==0?t(this.assets):setTimeout(()=>{e()},250)};e()})}get(t){return this.assets.get(t)}};var Nr=class{constructor(){this.create()}create(){}show(){}hide(){}resize(t,e){}render(t){}dispose(){}};var _r=class{screen=null;constructor(){}preload(){}create(){}resize(t,e){this.screen&&this.screen.resize(t,e)}render(t){this.screen&&this.screen.render(t)}setScreen(t){this.screen&&this.screen.hide(),this.screen=t,this.screen.show()}};var B=class{static lerp(t,e,i){return(i-e)*t+e}static rand(t,e){return Math.random()*(e-t)+t}static randInt(t,e){return Math.floor(this.rand(t,e+1))}static clamp(t,e,i){return Math.min(Math.max(t,e),i)}static sat(t){return this.clamp(t,0,1)}static shuffle(t){for(let e=0;e<t.length;++e){let i=this.randInt(0,t.length-1);[t[e],t[i]]=[t[i],t[e]]}}static choice(t){return t[this.randInt(0,t.length-1)]}static isPowerOf2(t){return(t&t-1)==0}static max(t){return Math.max(...t)}static min(t){return Math.min(...t)}static avg(t){return t.reduce((e,i)=>e+i)/t.length}static step(t,e,i){return(i-t)/(e-t)}};var Q=class{id;data;constructor(t,e={}){this.data=t,this.id=M.gl.createTexture(),M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texImage2D(M.gl.TEXTURE_2D,0,M.gl.RGBA,M.gl.RGBA,M.gl.UNSIGNED_BYTE,t),B.isPowerOf2(t.width)&&B.isPowerOf2(t.height)&&M.gl.generateMipmap(M.gl.TEXTURE_2D),M.gl.bindTexture(M.gl.TEXTURE_2D,null),this.setFilter(e.filter||M.gl.LINEAR),this.setWrap(e.wrap||M.gl.CLAMP_TO_EDGE)}setFilter(t){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_MIN_FILTER,t),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_MAG_FILTER,t==M.gl.NEAREST?M.gl.NEAREST:M.gl.LINEAR),M.gl.bindTexture(M.gl.TEXTURE_2D,null)}setWrap(t){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_WRAP_S,t),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_WRAP_T,t),M.gl.bindTexture(M.gl.TEXTURE_2D,null)}bind(){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id)}dispose(){M.gl.deleteTexture(this.id)}get width(){return this.data.width}get height(){return this.data.height}};var Z=class{options;columns=10;charFrom=32;charTo=126;bitmap;texture;charWidth;charHeight;constructor(t){this.options=t,this.charWidth=t.fontSize*t.charRatio,this.charHeight=t.fontSize*1.2,this.bitmap=this.generateBitmap(),this.texture=new Q(this.bitmap,{filter:M.gl.LINEAR_MIPMAP_LINEAR})}generateBitmap(){let t=document.createElement("canvas"),e=this.charTo-this.charFrom+1,i=Math.floor(e/this.columns);t.width=2**Math.ceil(Math.log2(this.columns*this.charWidth)),t.height=2**Math.ceil(Math.log2(i*this.charHeight));let n=t.getContext("2d");n.textBaseline="middle",n.textAlign="center",n.fillStyle="white",n.font=`${this.options.fontSize}px ${this.options.fontFamily}`;for(let s=0;s<e;++s){let a=String.fromCharCode(s+this.charFrom),h=(s%this.columns+.5)*this.charWidth,o=(Math.floor(s/this.columns)+.5)*this.charHeight;n.fillText(a,h,o)}return t}getCharPosition(t){if(t<this.charFrom||t>this.charTo)return null;let e=t-this.charFrom;return[e%this.columns*this.charWidth,Math.floor(e/this.columns)*this.charHeight]}};var X=class{program;constructor(t,e){let i=this.compileShader(t,M.gl.VERTEX_SHADER),n=this.compileShader(e,M.gl.FRAGMENT_SHADER);if(this.program=M.gl.createProgram(),M.gl.attachShader(this.program,i),M.gl.attachShader(this.program,n),M.gl.linkProgram(this.program),!M.gl.getProgramParameter(this.program,M.gl.LINK_STATUS))throw console.log(M.gl.getProgramInfoLog(this.program)),new Error("program unable to link");this.attribs={positions:M.gl.getAttribLocation(this.program,"position"),normals:M.gl.getAttribLocation(this.program,"normal"),colors:M.gl.getAttribLocation(this.program,"color"),uvs:M.gl.getAttribLocation(this.program,"uv"),sizes:M.gl.getAttribLocation(this.program,"size")},this.uniforms=[{name:"projectionMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"projectionMatrix")},{name:"modelViewMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"modelViewMatrix")},{name:"modelMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"modelMatrix")},{name:"normalMatrix",type:"mat3",location:M.gl.getUniformLocation(this.program,"normalMatrix")},{name:"lightColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightColor")},{name:"lightDirection",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightDirection")},{name:"lightPosition",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightPosition")},{name:"cameraPosition",type:"vec3",location:M.gl.getUniformLocation(this.program,"cameraPosition")},{name:"pointMultiplier",type:"float",location:M.gl.getUniformLocation(this.program,"pointMultiplier")},{name:"ambientColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"ambientColor")},{name:"uvOffset",type:"vec2",location:M.gl.getUniformLocation(this.program,"uvOffset")},{name:"fogColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"fogColor")},{name:"fogNear",type:"float",location:M.gl.getUniformLocation(this.program,"fogNear")},{name:"fogFar",type:"float",location:M.gl.getUniformLocation(this.program,"fogFar")},{name:"fogTime",type:"float",location:M.gl.getUniformLocation(this.program,"fogTime")}]}activate(){M.gl.useProgram(this.program)}compileShader(t,e){let i=M.gl.createShader(e);if(M.gl.shaderSource(i,t),M.gl.compileShader(i),!M.gl.getShaderParameter(i,M.gl.COMPILE_STATUS))throw console.log(M.gl.getShaderInfoLog(i)),console.log(t),new Error("shader unable to compile");return i}dispose(){}static create(t,e={}){let i="precision mediump float;",n=f=>f.replace("{{USER}}",e.onCustomProcessPosition===void 0?"":e.onCustomProcessPosition),s=e.useFog===!0?"#define USE_FOG":"",a=Array.isArray(e.uniforms),h="",o="";a&&e.uniforms.forEach(f=>{let x=`	uniform ${f.type} ${f.name};
`;switch(f.shader){case"vert":h+=x;break;case"frag":o+=x;break}});let c,l;switch(t){case this.Type.SIMPLE:{c=[h,s,n(this.SIMPLE_VS)].join(`
`),l=[i,o,s,this.SIMPLE_FS].join(`
`);break}case this.Type.TEXTURE:{c=[h,s,n(this.TEXTURE_VS)].join(`
`),l=[i,o,s,this.TEXTURE_FS].join(`
`);break}case this.Type.PARTICLE:{c=[h,this.PARTICLE_VS].join(`
`),l=[i,o,this.PARTICLE_FS].join(`
`);break}default:throw new Error("Type not found: "+t)}let p=new X(c,l);if(a)for(let f of e.uniforms)p.uniforms.push({name:f.name,type:f.type,location:M.gl.getUniformLocation(p.program,f.name)});return p}},L=X;Y(L,"Type",Object.freeze({SIMPLE:"simple",TEXTURE:"texture",PARTICLE:"particle"})),Y(L,"PROC_POS_FUNC",`
    vec3 proc_pos(vec3 position) {
        {{USER}}
        return position;
    }
    `),Y(L,"FOG_VERT_PARAMS",`
    #ifdef USE_FOG
    varying vec3 vWorldPosition;
    #endif
    `),Y(L,"FOG_VERT",`
    #ifdef USE_FOG
    vWorldPosition = worldPosition.xyz;
    #endif
    `),Y(L,"FOG_FRAG_PARAMS",`
    #ifdef USE_FOG
    varying vec3 vWorldPosition;
    uniform vec3 fogColor;
    uniform float fogNear;
    uniform float fogFar;
    uniform float fogTime;
    #endif
    `),Y(L,"FOG_FRAG",`
    #ifdef USE_FOG
    vec3 fogDirection = normalize(vWorldPosition);
    float fogDepth = length(vWorldPosition);

    float fogFactor = smoothstep(fogNear, fogFar, fogDepth);
    fogFactor = clamp(fogFactor, 0.0, 1.0);

    gl_FragColor = mix( gl_FragColor, vec4(fogColor, fogAlpha), fogFactor);
    #endif
    `),Y(L,"SIMPLE_VS",`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    attribute vec3 position;
    attribute vec4 color;

    varying vec4 vColor;

    ${X.FOG_VERT_PARAMS}

    ${X.PROC_POS_FUNC}

    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(proc_pos(position), 1.0);
        gl_Position = projectionMatrix * worldPosition;
        vColor = color;
        ${X.FOG_VERT}
    }
    `),Y(L,"SIMPLE_FS",`
    varying vec4 vColor;
    uniform vec3 ambientColor;
    uniform vec3 cameraPosition;

    ${X.FOG_FRAG_PARAMS}

    void main(void) {
        gl_FragColor = vec4(vColor.rgb * ambientColor, vColor.a);
        float fogAlpha = 1.0;
        ${X.FOG_FRAG}
    }
    `),Y(L,"TEXTURE_VS",`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    attribute vec3 position;
    attribute vec4 color;
    attribute vec2 uv;

    varying vec4 vColor;
    varying vec2 vUv;
    
    ${X.FOG_VERT_PARAMS}

    ${X.PROC_POS_FUNC}

    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(proc_pos(position), 1.0);
        gl_Position = projectionMatrix * worldPosition;
        vColor = color;
        vUv = uv;
        ${X.FOG_VERT}
    }
    `),Y(L,"TEXTURE_FS",` 
    varying vec4 vColor;
    varying vec2 vUv;

    uniform sampler2D tex;
    uniform vec3 ambientColor;
    uniform vec2 uvOffset;
    uniform vec3 cameraPosition;

    ${X.FOG_FRAG_PARAMS}

    void main(void) {
        vec4 texColor = texture2D(tex, vUv + uvOffset);
        gl_FragColor = vec4(vColor.rgb * texColor.rgb * ambientColor, texColor.a * vColor.a);
        float fogAlpha = texColor.a;
        ${X.FOG_FRAG}
    }
    `),Y(L,"PARTICLE_VS",`
    attribute vec3 position;
    attribute vec4 color;
    attribute float size;
    
    uniform float pointMultiplier;
    uniform mat4 projectionMatrix;
    uniform mat4 modelViewMatrix;
    
    varying vec4 vColor;
    
    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * worldPosition;
        gl_PointSize = size * pointMultiplier / gl_Position.w;
        vColor = color;
    }
    `),Y(L,"PARTICLE_FS",`
    varying vec4 vColor;

    uniform sampler2D tex;
    uniform vec3 ambientColor;
    uniform vec3 cameraPosition;
    
    void main(void) {
        vec4 texColor = texture2D(tex, gl_PointCoord);
        gl_FragColor = vec4(vColor.rgb * texColor.rgb * ambientColor * texColor.a, texColor.a) * vColor.a;
    }
    `);var lr=class{canvas;gl;frameId=null;width;height;delta=0;fps=60;lastFrameTime;frameStart;frames;game;shaders=new Map;fonts=new Map;constructor(t){this.game=t,this.canvas=this.createCanvas(),this.canvas.width=this.width=innerWidth,this.canvas.height=this.height=innerHeight,this.gl=this.canvas.getContext("webgl")}onResume(){this.lastFrameTime=this.frameStart=performance.now(),this.frames=0,this.RAF()}createCanvas(){let t=document.createElement("canvas");return t.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()},document.body.appendChild(t),t}onResize(){this.canvas.width=this.width=innerWidth,this.canvas.height=this.height=innerHeight,this.game.resize(this.width,this.height)}onDrawFrame(){let t=performance.now();this.delta=(t-this.lastFrameTime)*.001,this.lastFrameTime=t,M.input.update(),this.game.render(this.delta),t-this.frameStart>=1e3&&(this.fps=this.frames,this.frames=0,this.frameStart=t),++this.frames}RAF(){this.frameId=requestAnimationFrame(()=>{this.RAF(),this.onDrawFrame()})}compileShaders(){this.shaders.set("simple",L.create(L.Type.SIMPLE)),this.shaders.set("texture",L.create(L.Type.TEXTURE)),this.shaders.set("particle",L.create(L.Type.PARTICLE))}generateFonts(){this.fonts.set("Consolas",new Z({fontFamily:"Consolas",fontSize:48,charRatio:.6}))}getShader(t){return this.shaders.get(t)}getFont(t){return this.fonts.get(t)}};var ie={};V(ie,{Batch:()=>hr,Camera:()=>$,Drawable:()=>W,DrawableGroup:()=>Or,Font:()=>Z,Mesh:()=>U,OrthographicCamera:()=>zr,Particle:()=>Ir,ParticleSystem:()=>Lr,PerspectiveCamera:()=>Ar,Shader:()=>L,ShaderInstance:()=>k,Sprite:()=>Sr,TextDrawable:()=>br,Texture:()=>Q,meshes:()=>st});var ee={};V(ee,{glMatrix:()=>G,mat2:()=>Fr,mat2d:()=>Yr,mat3:()=>u,mat4:()=>b,quat:()=>K,quat2:()=>nt,vec2:()=>H,vec3:()=>S,vec4:()=>Mr});var G={};V(G,{ARRAY_TYPE:()=>T,EPSILON:()=>y,RANDOM:()=>q,equals:()=>ce,setMatrixArrayType:()=>ae,toRadian:()=>oe});var y=1e-6,T=typeof Float32Array<"u"?Float32Array:Array,q=Math.random;function ae(r){T=r}var he=Math.PI/180;function oe(r){return r*he}function ce(r,t){return Math.abs(r-t)<=y*Math.max(1,Math.abs(r),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Fr={};V(Fr,{LDU:()=>ze,add:()=>Se,adjoint:()=>de,clone:()=>fe,copy:()=>pe,create:()=>le,determinant:()=>ye,equals:()=>Ie,exactEquals:()=>be,frob:()=>Te,fromRotation:()=>Pe,fromScaling:()=>Ae,fromValues:()=>ve,identity:()=>xe,invert:()=>ge,mul:()=>Ce,multiply:()=>ft,multiplyScalar:()=>Le,multiplyScalarAndAdd:()=>Oe,rotate:()=>we,scale:()=>Ee,set:()=>me,str:()=>Re,sub:()=>De,subtract:()=>pt,transpose:()=>Me});function le(){var r=new T(4);return T!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r}function fe(r){var t=new T(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function pe(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function xe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r}function ve(r,t,e,i){var n=new T(4);return n[0]=r,n[1]=t,n[2]=e,n[3]=i,n}function me(r,t,e,i,n){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function Me(r,t){if(r===t){var e=t[1];r[1]=t[2],r[2]=e}else r[0]=t[0],r[1]=t[2],r[2]=t[1],r[3]=t[3];return r}function ge(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*s-n*i;return a?(a=1/a,r[0]=s*a,r[1]=-i*a,r[2]=-n*a,r[3]=e*a,r):null}function de(r,t){var e=t[0];return r[0]=t[3],r[1]=-t[1],r[2]=-t[2],r[3]=e,r}function ye(r){return r[0]*r[3]-r[2]*r[1]}function ft(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],l=e[3];return r[0]=i*h+s*o,r[1]=n*h+a*o,r[2]=i*c+s*l,r[3]=n*c+a*l,r}function we(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o+s*h,r[1]=n*o+a*h,r[2]=i*-h+s*o,r[3]=n*-h+a*o,r}function Ee(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1];return r[0]=i*h,r[1]=n*h,r[2]=s*o,r[3]=a*o,r}function Pe(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=-e,r[3]=i,r}function Ae(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=t[1],r}function Re(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function Te(r){return Math.hypot(r[0],r[1],r[2],r[3])}function ze(r,t,e,i){return r[2]=i[2]/i[0],e[0]=i[0],e[1]=i[1],e[3]=i[3]-r[2]*e[1],[r,t,e]}function Se(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function pt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}function be(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]}function Ie(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=t[0],h=t[1],o=t[2],c=t[3];return Math.abs(e-a)<=y*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(i-h)<=y*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=y*Math.max(1,Math.abs(s),Math.abs(c))}function Le(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function Oe(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r}var Ce=ft,De=pt;var Yr={};V(Yr,{add:()=>Qe,clone:()=>_e,copy:()=>Fe,create:()=>Ne,determinant:()=>Ve,equals:()=>ri,exactEquals:()=>Je,frob:()=>$e,fromRotation:()=>ke,fromScaling:()=>We,fromTranslation:()=>He,fromValues:()=>Ue,identity:()=>Ye,invert:()=>Ge,mul:()=>ti,multiply:()=>xt,multiplyScalar:()=>Ze,multiplyScalarAndAdd:()=>Ke,rotate:()=>Be,scale:()=>Xe,set:()=>qe,str:()=>ue,sub:()=>ei,subtract:()=>vt,translate:()=>je});function Ne(){var r=new T(6);return T!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r}function _e(r){var t=new T(6);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t}function Fe(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function Ye(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r}function Ue(r,t,e,i,n,s){var a=new T(6);return a[0]=r,a[1]=t,a[2]=e,a[3]=i,a[4]=n,a[5]=s,a}function qe(r,t,e,i,n,s,a){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r}function Ge(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=e*s-i*n;return o?(o=1/o,r[0]=s*o,r[1]=-i*o,r[2]=-n*o,r[3]=e*o,r[4]=(n*h-s*a)*o,r[5]=(i*a-e*h)*o,r):null}function Ve(r){return r[0]*r[3]-r[1]*r[2]}function xt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=e[0],l=e[1],p=e[2],f=e[3],x=e[4],v=e[5];return r[0]=i*c+s*l,r[1]=n*c+a*l,r[2]=i*p+s*f,r[3]=n*p+a*f,r[4]=i*x+s*v+h,r[5]=n*x+a*v+o,r}function Be(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=Math.sin(e),l=Math.cos(e);return r[0]=i*l+s*c,r[1]=n*l+a*c,r[2]=i*-c+s*l,r[3]=n*-c+a*l,r[4]=h,r[5]=o,r}function Xe(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=e[0],l=e[1];return r[0]=i*c,r[1]=n*c,r[2]=s*l,r[3]=a*l,r[4]=h,r[5]=o,r}function je(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=e[0],l=e[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=i*c+s*l+h,r[5]=n*c+a*l+o,r}function ke(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=-e,r[3]=i,r[4]=0,r[5]=0,r}function We(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=t[1],r[4]=0,r[5]=0,r}function He(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=t[0],r[5]=t[1],r}function ue(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"}function $e(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)}function Qe(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r}function vt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r}function Ze(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r}function Ke(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r[4]=t[4]+e[4]*i,r[5]=t[5]+e[5]*i,r}function Je(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]}function ri(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=t[0],c=t[1],l=t[2],p=t[3],f=t[4],x=t[5];return Math.abs(e-o)<=y*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-l)<=y*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-p)<=y*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-f)<=y*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(h-x)<=y*Math.max(1,Math.abs(h),Math.abs(x))}var ti=xt,ei=vt;var u={};V(u,{add:()=>Ti,adjoint:()=>fi,clone:()=>ni,copy:()=>si,create:()=>Ur,determinant:()=>pi,equals:()=>Ii,exactEquals:()=>bi,frob:()=>Ri,fromMat2d:()=>yi,fromMat4:()=>ii,fromQuat:()=>wi,fromRotation:()=>gi,fromScaling:()=>di,fromTranslation:()=>Mi,fromValues:()=>ai,identity:()=>oi,invert:()=>li,mul:()=>Li,multiply:()=>mt,multiplyScalar:()=>zi,multiplyScalarAndAdd:()=>Si,normalFromMat4:()=>Ei,projection:()=>Pi,rotate:()=>vi,scale:()=>mi,set:()=>hi,str:()=>Ai,sub:()=>Oi,subtract:()=>Mt,translate:()=>xi,transpose:()=>ci});function Ur(){var r=new T(9);return T!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ii(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r}function ni(r){var t=new T(9);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function si(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function ai(r,t,e,i,n,s,a,h,o){var c=new T(9);return c[0]=r,c[1]=t,c[2]=e,c[3]=i,c[4]=n,c[5]=s,c[6]=a,c[7]=h,c[8]=o,c}function hi(r,t,e,i,n,s,a,h,o,c){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r[8]=c,r}function oi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function ci(r,t){if(r===t){var e=t[1],i=t[2],n=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=i,r[7]=n}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function li(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],l=t[8],p=l*a-h*c,f=-l*s+h*o,x=c*s-a*o,v=e*p+i*f+n*x;return v?(v=1/v,r[0]=p*v,r[1]=(-l*i+n*c)*v,r[2]=(h*i-n*a)*v,r[3]=f*v,r[4]=(l*e-n*o)*v,r[5]=(-h*e+n*s)*v,r[6]=x*v,r[7]=(-c*e+i*o)*v,r[8]=(a*e-i*s)*v,r):null}function fi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],l=t[8];return r[0]=a*l-h*c,r[1]=n*c-i*l,r[2]=i*h-n*a,r[3]=h*o-s*l,r[4]=e*l-n*o,r[5]=n*s-e*h,r[6]=s*c-a*o,r[7]=i*o-e*c,r[8]=e*a-i*s,r}function pi(r){var t=r[0],e=r[1],i=r[2],n=r[3],s=r[4],a=r[5],h=r[6],o=r[7],c=r[8];return t*(c*s-a*o)+e*(-c*n+a*h)+i*(o*n-s*h)}function mt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=t[8],f=e[0],x=e[1],v=e[2],g=e[3],m=e[4],d=e[5],E=e[6],w=e[7],P=e[8];return r[0]=f*i+x*a+v*c,r[1]=f*n+x*h+v*l,r[2]=f*s+x*o+v*p,r[3]=g*i+m*a+d*c,r[4]=g*n+m*h+d*l,r[5]=g*s+m*o+d*p,r[6]=E*i+w*a+P*c,r[7]=E*n+w*h+P*l,r[8]=E*s+w*o+P*p,r}function xi(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=t[8],f=e[0],x=e[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=h,r[5]=o,r[6]=f*i+x*a+c,r[7]=f*n+x*h+l,r[8]=f*s+x*o+p,r}function vi(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=t[8],f=Math.sin(e),x=Math.cos(e);return r[0]=x*i+f*a,r[1]=x*n+f*h,r[2]=x*s+f*o,r[3]=x*a-f*i,r[4]=x*h-f*n,r[5]=x*o-f*s,r[6]=c,r[7]=l,r[8]=p,r}function mi(r,t,e){var i=e[0],n=e[1];return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=n*t[3],r[4]=n*t[4],r[5]=n*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function Mi(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r}function gi(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=0,r[3]=-e,r[4]=i,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function di(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=t[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function yi(r,t){return r[0]=t[0],r[1]=t[1],r[2]=0,r[3]=t[2],r[4]=t[3],r[5]=0,r[6]=t[4],r[7]=t[5],r[8]=1,r}function wi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e+e,h=i+i,o=n+n,c=e*a,l=i*a,p=i*h,f=n*a,x=n*h,v=n*o,g=s*a,m=s*h,d=s*o;return r[0]=1-p-v,r[3]=l-d,r[6]=f+m,r[1]=l+d,r[4]=1-c-v,r[7]=x-g,r[2]=f-m,r[5]=x+g,r[8]=1-c-p,r}function Ei(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],l=t[8],p=t[9],f=t[10],x=t[11],v=t[12],g=t[13],m=t[14],d=t[15],E=e*h-i*a,w=e*o-n*a,P=e*c-s*a,R=i*o-n*h,A=i*c-s*h,N=n*c-s*o,O=l*g-p*v,C=l*m-f*v,I=l*d-x*v,_=p*m-f*g,D=p*d-x*g,F=f*d-x*m,z=E*F-w*D+P*_+R*I-A*C+N*O;return z?(z=1/z,r[0]=(h*F-o*D+c*_)*z,r[1]=(o*I-a*F-c*C)*z,r[2]=(a*D-h*I+c*O)*z,r[3]=(n*D-i*F-s*_)*z,r[4]=(e*F-n*I+s*C)*z,r[5]=(i*I-e*D-s*O)*z,r[6]=(g*N-m*A+d*R)*z,r[7]=(m*P-v*N-d*w)*z,r[8]=(v*A-g*P+d*E)*z,r):null}function Pi(r,t,e){return r[0]=2/t,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/e,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function Ai(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function Ri(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function Ti(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r[8]=t[8]+e[8],r}function Mt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r[6]=t[6]-e[6],r[7]=t[7]-e[7],r[8]=t[8]-e[8],r}function zi(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*e,r}function Si(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r[4]=t[4]+e[4]*i,r[5]=t[5]+e[5]*i,r[6]=t[6]+e[6]*i,r[7]=t[7]+e[7]*i,r[8]=t[8]+e[8]*i,r}function bi(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]}function Ii(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],l=r[8],p=t[0],f=t[1],x=t[2],v=t[3],g=t[4],m=t[5],d=t[6],E=t[7],w=t[8];return Math.abs(e-p)<=y*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(i-f)<=y*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-x)<=y*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-v)<=y*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-g)<=y*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(h-m)<=y*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(o-d)<=y*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(c-E)<=y*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-w)<=y*Math.max(1,Math.abs(l),Math.abs(w))}var Li=mt,Oi=Mt;var b={};V(b,{add:()=>vn,adjoint:()=>qi,clone:()=>Di,copy:()=>Ni,create:()=>Ci,determinant:()=>Gi,equals:()=>dn,exactEquals:()=>gn,frob:()=>xn,fromQuat:()=>en,fromQuat2:()=>Ji,fromRotation:()=>$i,fromRotationTranslation:()=>yt,fromRotationTranslationScale:()=>rn,fromRotationTranslationScaleOrigin:()=>tn,fromScaling:()=>ui,fromTranslation:()=>Hi,fromValues:()=>_i,fromXRotation:()=>Qi,fromYRotation:()=>Zi,fromZRotation:()=>Ki,frustum:()=>nn,getRotation:()=>Gr,getScaling:()=>wt,getTranslation:()=>qr,identity:()=>gt,invert:()=>Ui,lookAt:()=>ln,mul:()=>yn,multiply:()=>dt,multiplyScalar:()=>mn,multiplyScalarAndAdd:()=>Mn,ortho:()=>on,orthoNO:()=>Pt,orthoZO:()=>cn,perspective:()=>sn,perspectiveFromFieldOfView:()=>hn,perspectiveNO:()=>Et,perspectiveZO:()=>an,rotate:()=>Xi,rotateX:()=>ji,rotateY:()=>ki,rotateZ:()=>Wi,scale:()=>Bi,set:()=>Fi,str:()=>pn,sub:()=>wn,subtract:()=>At,targetTo:()=>fn,translate:()=>Vi,transpose:()=>Yi});function Ci(){var r=new T(16);return T!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Di(r){var t=new T(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function Ni(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function _i(r,t,e,i,n,s,a,h,o,c,l,p,f,x,v,g){var m=new T(16);return m[0]=r,m[1]=t,m[2]=e,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=h,m[8]=o,m[9]=c,m[10]=l,m[11]=p,m[12]=f,m[13]=x,m[14]=v,m[15]=g,m}function Fi(r,t,e,i,n,s,a,h,o,c,l,p,f,x,v,g,m){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r[8]=c,r[9]=l,r[10]=p,r[11]=f,r[12]=x,r[13]=v,r[14]=g,r[15]=m,r}function gt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Yi(r,t){if(r===t){var e=t[1],i=t[2],n=t[3],s=t[6],a=t[7],h=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=i,r[9]=s,r[11]=t[14],r[12]=n,r[13]=a,r[14]=h}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function Ui(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],l=t[8],p=t[9],f=t[10],x=t[11],v=t[12],g=t[13],m=t[14],d=t[15],E=e*h-i*a,w=e*o-n*a,P=e*c-s*a,R=i*o-n*h,A=i*c-s*h,N=n*c-s*o,O=l*g-p*v,C=l*m-f*v,I=l*d-x*v,_=p*m-f*g,D=p*d-x*g,F=f*d-x*m,z=E*F-w*D+P*_+R*I-A*C+N*O;return z?(z=1/z,r[0]=(h*F-o*D+c*_)*z,r[1]=(n*D-i*F-s*_)*z,r[2]=(g*N-m*A+d*R)*z,r[3]=(f*A-p*N-x*R)*z,r[4]=(o*I-a*F-c*C)*z,r[5]=(e*F-n*I+s*C)*z,r[6]=(m*P-v*N-d*w)*z,r[7]=(l*N-f*P+x*w)*z,r[8]=(a*D-h*I+c*O)*z,r[9]=(i*I-e*D-s*O)*z,r[10]=(v*A-g*P+d*E)*z,r[11]=(p*P-l*A-x*E)*z,r[12]=(h*C-a*_-o*O)*z,r[13]=(e*_-i*C+n*O)*z,r[14]=(g*w-v*R-m*E)*z,r[15]=(l*R-p*w+f*E)*z,r):null}function qi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],l=t[8],p=t[9],f=t[10],x=t[11],v=t[12],g=t[13],m=t[14],d=t[15];return r[0]=h*(f*d-x*m)-p*(o*d-c*m)+g*(o*x-c*f),r[1]=-(i*(f*d-x*m)-p*(n*d-s*m)+g*(n*x-s*f)),r[2]=i*(o*d-c*m)-h*(n*d-s*m)+g*(n*c-s*o),r[3]=-(i*(o*x-c*f)-h*(n*x-s*f)+p*(n*c-s*o)),r[4]=-(a*(f*d-x*m)-l*(o*d-c*m)+v*(o*x-c*f)),r[5]=e*(f*d-x*m)-l*(n*d-s*m)+v*(n*x-s*f),r[6]=-(e*(o*d-c*m)-a*(n*d-s*m)+v*(n*c-s*o)),r[7]=e*(o*x-c*f)-a*(n*x-s*f)+l*(n*c-s*o),r[8]=a*(p*d-x*g)-l*(h*d-c*g)+v*(h*x-c*p),r[9]=-(e*(p*d-x*g)-l*(i*d-s*g)+v*(i*x-s*p)),r[10]=e*(h*d-c*g)-a*(i*d-s*g)+v*(i*c-s*h),r[11]=-(e*(h*x-c*p)-a*(i*x-s*p)+l*(i*c-s*h)),r[12]=-(a*(p*m-f*g)-l*(h*m-o*g)+v*(h*f-o*p)),r[13]=e*(p*m-f*g)-l*(i*m-n*g)+v*(i*f-n*p),r[14]=-(e*(h*m-o*g)-a*(i*m-n*g)+v*(i*o-n*h)),r[15]=e*(h*f-o*p)-a*(i*f-n*p)+l*(i*o-n*h),r}function Gi(r){var t=r[0],e=r[1],i=r[2],n=r[3],s=r[4],a=r[5],h=r[6],o=r[7],c=r[8],l=r[9],p=r[10],f=r[11],x=r[12],v=r[13],g=r[14],m=r[15],d=t*a-e*s,E=t*h-i*s,w=t*o-n*s,P=e*h-i*a,R=e*o-n*a,A=i*o-n*h,N=c*v-l*x,O=c*g-p*x,C=c*m-f*x,I=l*g-p*v,_=l*m-f*v,D=p*m-f*g;return d*D-E*_+w*I+P*C-R*O+A*N}function dt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=t[8],f=t[9],x=t[10],v=t[11],g=t[12],m=t[13],d=t[14],E=t[15],w=e[0],P=e[1],R=e[2],A=e[3];return r[0]=w*i+P*h+R*p+A*g,r[1]=w*n+P*o+R*f+A*m,r[2]=w*s+P*c+R*x+A*d,r[3]=w*a+P*l+R*v+A*E,w=e[4],P=e[5],R=e[6],A=e[7],r[4]=w*i+P*h+R*p+A*g,r[5]=w*n+P*o+R*f+A*m,r[6]=w*s+P*c+R*x+A*d,r[7]=w*a+P*l+R*v+A*E,w=e[8],P=e[9],R=e[10],A=e[11],r[8]=w*i+P*h+R*p+A*g,r[9]=w*n+P*o+R*f+A*m,r[10]=w*s+P*c+R*x+A*d,r[11]=w*a+P*l+R*v+A*E,w=e[12],P=e[13],R=e[14],A=e[15],r[12]=w*i+P*h+R*p+A*g,r[13]=w*n+P*o+R*f+A*m,r[14]=w*s+P*c+R*x+A*d,r[15]=w*a+P*l+R*v+A*E,r}function Vi(r,t,e){var i=e[0],n=e[1],s=e[2],a,h,o,c,l,p,f,x,v,g,m,d;return t===r?(r[12]=t[0]*i+t[4]*n+t[8]*s+t[12],r[13]=t[1]*i+t[5]*n+t[9]*s+t[13],r[14]=t[2]*i+t[6]*n+t[10]*s+t[14],r[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],h=t[1],o=t[2],c=t[3],l=t[4],p=t[5],f=t[6],x=t[7],v=t[8],g=t[9],m=t[10],d=t[11],r[0]=a,r[1]=h,r[2]=o,r[3]=c,r[4]=l,r[5]=p,r[6]=f,r[7]=x,r[8]=v,r[9]=g,r[10]=m,r[11]=d,r[12]=a*i+l*n+v*s+t[12],r[13]=h*i+p*n+g*s+t[13],r[14]=o*i+f*n+m*s+t[14],r[15]=c*i+x*n+d*s+t[15]),r}function Bi(r,t,e){var i=e[0],n=e[1],s=e[2];return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Xi(r,t,e,i){var n=i[0],s=i[1],a=i[2],h=Math.hypot(n,s,a),o,c,l,p,f,x,v,g,m,d,E,w,P,R,A,N,O,C,I,_,D,F,z,j;return h<y?null:(h=1/h,n*=h,s*=h,a*=h,o=Math.sin(e),c=Math.cos(e),l=1-c,p=t[0],f=t[1],x=t[2],v=t[3],g=t[4],m=t[5],d=t[6],E=t[7],w=t[8],P=t[9],R=t[10],A=t[11],N=n*n*l+c,O=s*n*l+a*o,C=a*n*l-s*o,I=n*s*l-a*o,_=s*s*l+c,D=a*s*l+n*o,F=n*a*l+s*o,z=s*a*l-n*o,j=a*a*l+c,r[0]=p*N+g*O+w*C,r[1]=f*N+m*O+P*C,r[2]=x*N+d*O+R*C,r[3]=v*N+E*O+A*C,r[4]=p*I+g*_+w*D,r[5]=f*I+m*_+P*D,r[6]=x*I+d*_+R*D,r[7]=v*I+E*_+A*D,r[8]=p*F+g*z+w*j,r[9]=f*F+m*z+P*j,r[10]=x*F+d*z+R*j,r[11]=v*F+E*z+A*j,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function ji(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[4],a=t[5],h=t[6],o=t[7],c=t[8],l=t[9],p=t[10],f=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*n+c*i,r[5]=a*n+l*i,r[6]=h*n+p*i,r[7]=o*n+f*i,r[8]=c*n-s*i,r[9]=l*n-a*i,r[10]=p*n-h*i,r[11]=f*n-o*i,r}function ki(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[0],a=t[1],h=t[2],o=t[3],c=t[8],l=t[9],p=t[10],f=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*n-c*i,r[1]=a*n-l*i,r[2]=h*n-p*i,r[3]=o*n-f*i,r[8]=s*i+c*n,r[9]=a*i+l*n,r[10]=h*i+p*n,r[11]=o*i+f*n,r}function Wi(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[0],a=t[1],h=t[2],o=t[3],c=t[4],l=t[5],p=t[6],f=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*n+c*i,r[1]=a*n+l*i,r[2]=h*n+p*i,r[3]=o*n+f*i,r[4]=c*n-s*i,r[5]=l*n-a*i,r[6]=p*n-h*i,r[7]=f*n-o*i,r}function Hi(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function ui(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function $i(r,t,e){var i=e[0],n=e[1],s=e[2],a=Math.hypot(i,n,s),h,o,c;return a<y?null:(a=1/a,i*=a,n*=a,s*=a,h=Math.sin(t),o=Math.cos(t),c=1-o,r[0]=i*i*c+o,r[1]=n*i*c+s*h,r[2]=s*i*c-n*h,r[3]=0,r[4]=i*n*c-s*h,r[5]=n*n*c+o,r[6]=s*n*c+i*h,r[7]=0,r[8]=i*s*c+n*h,r[9]=n*s*c-i*h,r[10]=s*s*c+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Qi(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=e,r[7]=0,r[8]=0,r[9]=-e,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zi(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=0,r[2]=-e,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=e,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ki(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=0,r[3]=0,r[4]=-e,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function yt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=i+i,o=n+n,c=s+s,l=i*h,p=i*o,f=i*c,x=n*o,v=n*c,g=s*c,m=a*h,d=a*o,E=a*c;return r[0]=1-(x+g),r[1]=p+E,r[2]=f-d,r[3]=0,r[4]=p-E,r[5]=1-(l+g),r[6]=v+m,r[7]=0,r[8]=f+d,r[9]=v-m,r[10]=1-(l+x),r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Ji(r,t){var e=new T(3),i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=i*i+n*n+s*s+a*a;return p>0?(e[0]=(h*a+l*i+o*s-c*n)*2/p,e[1]=(o*a+l*n+c*i-h*s)*2/p,e[2]=(c*a+l*s+h*n-o*i)*2/p):(e[0]=(h*a+l*i+o*s-c*n)*2,e[1]=(o*a+l*n+c*i-h*s)*2,e[2]=(c*a+l*s+h*n-o*i)*2),yt(r,t,e),r}function qr(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function wt(r,t){var e=t[0],i=t[1],n=t[2],s=t[4],a=t[5],h=t[6],o=t[8],c=t[9],l=t[10];return r[0]=Math.hypot(e,i,n),r[1]=Math.hypot(s,a,h),r[2]=Math.hypot(o,c,l),r}function Gr(r,t){var e=new T(3);wt(e,t);var i=1/e[0],n=1/e[1],s=1/e[2],a=t[0]*i,h=t[1]*n,o=t[2]*s,c=t[4]*i,l=t[5]*n,p=t[6]*s,f=t[8]*i,x=t[9]*n,v=t[10]*s,g=a+l+v,m=0;return g>0?(m=Math.sqrt(g+1)*2,r[3]=.25*m,r[0]=(p-x)/m,r[1]=(f-o)/m,r[2]=(h-c)/m):a>l&&a>v?(m=Math.sqrt(1+a-l-v)*2,r[3]=(p-x)/m,r[0]=.25*m,r[1]=(h+c)/m,r[2]=(f+o)/m):l>v?(m=Math.sqrt(1+l-a-v)*2,r[3]=(f-o)/m,r[0]=(h+c)/m,r[1]=.25*m,r[2]=(p+x)/m):(m=Math.sqrt(1+v-a-l)*2,r[3]=(h-c)/m,r[0]=(f+o)/m,r[1]=(p+x)/m,r[2]=.25*m),r}function rn(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=t[3],o=n+n,c=s+s,l=a+a,p=n*o,f=n*c,x=n*l,v=s*c,g=s*l,m=a*l,d=h*o,E=h*c,w=h*l,P=i[0],R=i[1],A=i[2];return r[0]=(1-(v+m))*P,r[1]=(f+w)*P,r[2]=(x-E)*P,r[3]=0,r[4]=(f-w)*R,r[5]=(1-(p+m))*R,r[6]=(g+d)*R,r[7]=0,r[8]=(x+E)*A,r[9]=(g-d)*A,r[10]=(1-(p+v))*A,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function tn(r,t,e,i,n){var s=t[0],a=t[1],h=t[2],o=t[3],c=s+s,l=a+a,p=h+h,f=s*c,x=s*l,v=s*p,g=a*l,m=a*p,d=h*p,E=o*c,w=o*l,P=o*p,R=i[0],A=i[1],N=i[2],O=n[0],C=n[1],I=n[2],_=(1-(g+d))*R,D=(x+P)*R,F=(v-w)*R,z=(x-P)*A,j=(1-(f+d))*A,ir=(m+E)*A,nr=(v+w)*N,ot=(m-E)*N,ct=(1-(f+g))*N;return r[0]=_,r[1]=D,r[2]=F,r[3]=0,r[4]=z,r[5]=j,r[6]=ir,r[7]=0,r[8]=nr,r[9]=ot,r[10]=ct,r[11]=0,r[12]=e[0]+O-(_*O+z*C+nr*I),r[13]=e[1]+C-(D*O+j*C+ot*I),r[14]=e[2]+I-(F*O+ir*C+ct*I),r[15]=1,r}function en(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e+e,h=i+i,o=n+n,c=e*a,l=i*a,p=i*h,f=n*a,x=n*h,v=n*o,g=s*a,m=s*h,d=s*o;return r[0]=1-p-v,r[1]=l+d,r[2]=f-m,r[3]=0,r[4]=l-d,r[5]=1-c-v,r[6]=x+g,r[7]=0,r[8]=f+m,r[9]=x-g,r[10]=1-c-p,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function nn(r,t,e,i,n,s,a){var h=1/(e-t),o=1/(n-i),c=1/(s-a);return r[0]=s*2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*o,r[6]=0,r[7]=0,r[8]=(e+t)*h,r[9]=(n+i)*o,r[10]=(a+s)*c,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*c,r[15]=0,r}function Et(r,t,e,i,n){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=(n+i)*a,r[14]=2*n*i*a):(r[10]=-1,r[14]=-2*i),r}var sn=Et;function an(r,t,e,i,n){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=n*a,r[14]=n*i*a):(r[10]=-1,r[14]=-i),r}function hn(r,t,e,i){var n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),o=2/(a+h),c=2/(n+s);return r[0]=o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=-((a-h)*o*.5),r[9]=(n-s)*c*.5,r[10]=i/(e-i),r[11]=-1,r[12]=0,r[13]=0,r[14]=i*e/(e-i),r[15]=0,r}function Pt(r,t,e,i,n,s,a){var h=1/(t-e),o=1/(i-n),c=1/(s-a);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(t+e)*h,r[13]=(n+i)*o,r[14]=(a+s)*c,r[15]=1,r}var on=Pt;function cn(r,t,e,i,n,s,a){var h=1/(t-e),o=1/(i-n),c=1/(s-a);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=c,r[11]=0,r[12]=(t+e)*h,r[13]=(n+i)*o,r[14]=s*c,r[15]=1,r}function ln(r,t,e,i){var n,s,a,h,o,c,l,p,f,x,v=t[0],g=t[1],m=t[2],d=i[0],E=i[1],w=i[2],P=e[0],R=e[1],A=e[2];return Math.abs(v-P)<y&&Math.abs(g-R)<y&&Math.abs(m-A)<y?gt(r):(l=v-P,p=g-R,f=m-A,x=1/Math.hypot(l,p,f),l*=x,p*=x,f*=x,n=E*f-w*p,s=w*l-d*f,a=d*p-E*l,x=Math.hypot(n,s,a),x?(x=1/x,n*=x,s*=x,a*=x):(n=0,s=0,a=0),h=p*a-f*s,o=f*n-l*a,c=l*s-p*n,x=Math.hypot(h,o,c),x?(x=1/x,h*=x,o*=x,c*=x):(h=0,o=0,c=0),r[0]=n,r[1]=h,r[2]=l,r[3]=0,r[4]=s,r[5]=o,r[6]=p,r[7]=0,r[8]=a,r[9]=c,r[10]=f,r[11]=0,r[12]=-(n*v+s*g+a*m),r[13]=-(h*v+o*g+c*m),r[14]=-(l*v+p*g+f*m),r[15]=1,r)}function fn(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=i[0],o=i[1],c=i[2],l=n-e[0],p=s-e[1],f=a-e[2],x=l*l+p*p+f*f;x>0&&(x=1/Math.sqrt(x),l*=x,p*=x,f*=x);var v=o*f-c*p,g=c*l-h*f,m=h*p-o*l;return x=v*v+g*g+m*m,x>0&&(x=1/Math.sqrt(x),v*=x,g*=x,m*=x),r[0]=v,r[1]=g,r[2]=m,r[3]=0,r[4]=p*m-f*g,r[5]=f*v-l*m,r[6]=l*g-p*v,r[7]=0,r[8]=l,r[9]=p,r[10]=f,r[11]=0,r[12]=n,r[13]=s,r[14]=a,r[15]=1,r}function pn(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function xn(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function vn(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r[8]=t[8]+e[8],r[9]=t[9]+e[9],r[10]=t[10]+e[10],r[11]=t[11]+e[11],r[12]=t[12]+e[12],r[13]=t[13]+e[13],r[14]=t[14]+e[14],r[15]=t[15]+e[15],r}function At(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r[6]=t[6]-e[6],r[7]=t[7]-e[7],r[8]=t[8]-e[8],r[9]=t[9]-e[9],r[10]=t[10]-e[10],r[11]=t[11]-e[11],r[12]=t[12]-e[12],r[13]=t[13]-e[13],r[14]=t[14]-e[14],r[15]=t[15]-e[15],r}function mn(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*e,r[9]=t[9]*e,r[10]=t[10]*e,r[11]=t[11]*e,r[12]=t[12]*e,r[13]=t[13]*e,r[14]=t[14]*e,r[15]=t[15]*e,r}function Mn(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r[4]=t[4]+e[4]*i,r[5]=t[5]+e[5]*i,r[6]=t[6]+e[6]*i,r[7]=t[7]+e[7]*i,r[8]=t[8]+e[8]*i,r[9]=t[9]+e[9]*i,r[10]=t[10]+e[10]*i,r[11]=t[11]+e[11]*i,r[12]=t[12]+e[12]*i,r[13]=t[13]+e[13]*i,r[14]=t[14]+e[14]*i,r[15]=t[15]+e[15]*i,r}function gn(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]}function dn(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],l=r[8],p=r[9],f=r[10],x=r[11],v=r[12],g=r[13],m=r[14],d=r[15],E=t[0],w=t[1],P=t[2],R=t[3],A=t[4],N=t[5],O=t[6],C=t[7],I=t[8],_=t[9],D=t[10],F=t[11],z=t[12],j=t[13],ir=t[14],nr=t[15];return Math.abs(e-E)<=y*Math.max(1,Math.abs(e),Math.abs(E))&&Math.abs(i-w)<=y*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(n-P)<=y*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(s-R)<=y*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(a-A)<=y*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(h-N)<=y*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(o-O)<=y*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(c-C)<=y*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(l-I)<=y*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(p-_)<=y*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(f-D)<=y*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(x-F)<=y*Math.max(1,Math.abs(x),Math.abs(F))&&Math.abs(v-z)<=y*Math.max(1,Math.abs(v),Math.abs(z))&&Math.abs(g-j)<=y*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(m-ir)<=y*Math.max(1,Math.abs(m),Math.abs(ir))&&Math.abs(d-nr)<=y*Math.max(1,Math.abs(d),Math.abs(nr))}var yn=dt,wn=At;var K={};V(K,{add:()=>Ys,calculateW:()=>Ss,clone:()=>Ns,conjugate:()=>Os,copy:()=>dr,create:()=>ar,dot:()=>yr,equals:()=>Xs,exactEquals:()=>Bs,exp:()=>qt,fromEuler:()=>Cs,fromMat3:()=>Vt,fromValues:()=>_s,getAngle:()=>zs,getAxisAngle:()=>Ts,identity:()=>Rs,invert:()=>Ls,len:()=>Gs,length:()=>wr,lerp:()=>qs,ln:()=>Gt,mul:()=>Us,multiply:()=>Ut,normalize:()=>it,pow:()=>bs,random:()=>Is,rotateX:()=>rt,rotateY:()=>tt,rotateZ:()=>et,rotationTo:()=>js,scale:()=>Bt,set:()=>Fs,setAxes:()=>Ws,setAxisAngle:()=>Yt,slerp:()=>gr,sqlerp:()=>ks,sqrLen:()=>Vs,squaredLength:()=>Er,str:()=>Ds});var S={};V(S,{add:()=>Rn,angle:()=>jn,bezier:()=>Fn,ceil:()=>Tn,clone:()=>En,copy:()=>Pn,create:()=>fr,cross:()=>sr,dist:()=>Kn,distance:()=>bt,div:()=>Zn,divide:()=>St,dot:()=>xr,equals:()=>un,exactEquals:()=>Hn,floor:()=>zn,forEach:()=>ts,fromValues:()=>pr,hermite:()=>_n,inverse:()=>Dn,len:()=>Br,length:()=>Rt,lerp:()=>Nn,max:()=>bn,min:()=>Sn,mul:()=>Qn,multiply:()=>zt,negate:()=>Cn,normalize:()=>Vr,random:()=>Yn,rotateX:()=>Vn,rotateY:()=>Bn,rotateZ:()=>Xn,round:()=>In,scale:()=>Ln,scaleAndAdd:()=>On,set:()=>An,sqrDist:()=>Jn,sqrLen:()=>rs,squaredDistance:()=>It,squaredLength:()=>Lt,str:()=>Wn,sub:()=>$n,subtract:()=>Tt,transformMat3:()=>qn,transformMat4:()=>Un,transformQuat:()=>Gn,zero:()=>kn});function fr(){var r=new T(3);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function En(r){var t=new T(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function Rt(r){var t=r[0],e=r[1],i=r[2];return Math.hypot(t,e,i)}function pr(r,t,e){var i=new T(3);return i[0]=r,i[1]=t,i[2]=e,i}function Pn(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function An(r,t,e,i){return r[0]=t,r[1]=e,r[2]=i,r}function Rn(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Tt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function zt(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function St(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function Tn(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function zn(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function Sn(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function bn(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function In(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function Ln(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function On(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r}function bt(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2];return Math.hypot(e,i,n)}function It(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2];return e*e+i*i+n*n}function Lt(r){var t=r[0],e=r[1],i=r[2];return t*t+e*e+i*i}function Cn(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function Dn(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function Vr(r,t){var e=t[0],i=t[1],n=t[2],s=e*e+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function xr(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function sr(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[0],h=e[1],o=e[2];return r[0]=n*o-s*h,r[1]=s*a-i*o,r[2]=i*h-n*a,r}function Nn(r,t,e,i){var n=t[0],s=t[1],a=t[2];return r[0]=n+i*(e[0]-n),r[1]=s+i*(e[1]-s),r[2]=a+i*(e[2]-a),r}function _n(r,t,e,i,n,s){var a=s*s,h=a*(2*s-3)+1,o=a*(s-2)+s,c=a*(s-1),l=a*(3-2*s);return r[0]=t[0]*h+e[0]*o+i[0]*c+n[0]*l,r[1]=t[1]*h+e[1]*o+i[1]*c+n[1]*l,r[2]=t[2]*h+e[2]*o+i[2]*c+n[2]*l,r}function Fn(r,t,e,i,n,s){var a=1-s,h=a*a,o=s*s,c=h*a,l=3*s*h,p=3*o*a,f=o*s;return r[0]=t[0]*c+e[0]*l+i[0]*p+n[0]*f,r[1]=t[1]*c+e[1]*l+i[1]*p+n[1]*f,r[2]=t[2]*c+e[2]*l+i[2]*p+n[2]*f,r}function Yn(r,t){t=t||1;var e=q()*2*Math.PI,i=q()*2-1,n=Math.sqrt(1-i*i)*t;return r[0]=Math.cos(e)*n,r[1]=Math.sin(e)*n,r[2]=i*t,r}function Un(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[3]*i+e[7]*n+e[11]*s+e[15];return a=a||1,r[0]=(e[0]*i+e[4]*n+e[8]*s+e[12])/a,r[1]=(e[1]*i+e[5]*n+e[9]*s+e[13])/a,r[2]=(e[2]*i+e[6]*n+e[10]*s+e[14])/a,r}function qn(r,t,e){var i=t[0],n=t[1],s=t[2];return r[0]=i*e[0]+n*e[3]+s*e[6],r[1]=i*e[1]+n*e[4]+s*e[7],r[2]=i*e[2]+n*e[5]+s*e[8],r}function Gn(r,t,e){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],l=n*c-s*o,p=s*h-i*c,f=i*o-n*h,x=n*f-s*p,v=s*l-i*f,g=i*p-n*l,m=a*2;return l*=m,p*=m,f*=m,x*=2,v*=2,g*=2,r[0]=h+l+x,r[1]=o+p+v,r[2]=c+f+g,r}function Vn(r,t,e,i){var n=[],s=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function Bn(r,t,e,i){var n=[],s=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function Xn(r,t,e,i){var n=[],s=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function jn(r,t){var e=r[0],i=r[1],n=r[2],s=t[0],a=t[1],h=t[2],o=Math.sqrt(e*e+i*i+n*n),c=Math.sqrt(s*s+a*a+h*h),l=o*c,p=l&&xr(r,t)/l;return Math.acos(Math.min(Math.max(p,-1),1))}function kn(r){return r[0]=0,r[1]=0,r[2]=0,r}function Wn(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function Hn(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function un(r,t){var e=r[0],i=r[1],n=r[2],s=t[0],a=t[1],h=t[2];return Math.abs(e-s)<=y*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(i-a)<=y*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=y*Math.max(1,Math.abs(n),Math.abs(h))}var $n=Tt,Qn=zt,Zn=St,Kn=bt,Jn=It,Br=Rt,rs=Lt,ts=function(){var r=fr();return function(t,e,i,n,s,a){var h,o;for(e||(e=3),i||(i=0),n?o=Math.min(n*e+i,t.length):o=t.length,h=i;h<o;h+=e)r[0]=t[h],r[1]=t[h+1],r[2]=t[h+2],s(r,r,a),t[h]=r[0],t[h+1]=r[1],t[h+2]=r[2];return t}}();var Mr={};V(Mr,{add:()=>Hr,ceil:()=>es,clone:()=>Xr,copy:()=>kr,create:()=>Ot,cross:()=>ls,dist:()=>ys,distance:()=>_t,div:()=>ds,divide:()=>Nt,dot:()=>Qr,equals:()=>Jr,exactEquals:()=>Kr,floor:()=>is,forEach:()=>As,fromValues:()=>jr,inverse:()=>cs,len:()=>Es,length:()=>vr,lerp:()=>Zr,max:()=>ss,min:()=>ns,mul:()=>gs,multiply:()=>Dt,negate:()=>os,normalize:()=>$r,random:()=>fs,round:()=>as,scale:()=>ur,scaleAndAdd:()=>hs,set:()=>Wr,sqrDist:()=>ws,sqrLen:()=>Ps,squaredDistance:()=>Ft,squaredLength:()=>mr,str:()=>ms,sub:()=>Ms,subtract:()=>Ct,transformMat4:()=>ps,transformQuat:()=>xs,zero:()=>vs});function Ot(){var r=new T(4);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Xr(r){var t=new T(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function jr(r,t,e,i){var n=new T(4);return n[0]=r,n[1]=t,n[2]=e,n[3]=i,n}function kr(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Wr(r,t,e,i,n){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function Hr(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function Ct(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}function Dt(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r[3]=t[3]*e[3],r}function Nt(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r[3]=t[3]/e[3],r}function es(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r[3]=Math.ceil(t[3]),r}function is(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r[3]=Math.floor(t[3]),r}function ns(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r[3]=Math.min(t[3],e[3]),r}function ss(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3]),r}function as(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r[3]=Math.round(t[3]),r}function ur(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function hs(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r}function _t(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2],s=t[3]-r[3];return Math.hypot(e,i,n,s)}function Ft(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2],s=t[3]-r[3];return e*e+i*i+n*n+s*s}function vr(r){var t=r[0],e=r[1],i=r[2],n=r[3];return Math.hypot(t,e,i,n)}function mr(r){var t=r[0],e=r[1],i=r[2],n=r[3];return t*t+e*e+i*i+n*n}function os(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r}function cs(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r[3]=1/t[3],r}function $r(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*e+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=i*a,r[2]=n*a,r[3]=s*a,r}function Qr(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function ls(r,t,e,i){var n=e[0]*i[1]-e[1]*i[0],s=e[0]*i[2]-e[2]*i[0],a=e[0]*i[3]-e[3]*i[0],h=e[1]*i[2]-e[2]*i[1],o=e[1]*i[3]-e[3]*i[1],c=e[2]*i[3]-e[3]*i[2],l=t[0],p=t[1],f=t[2],x=t[3];return r[0]=p*c-f*o+x*h,r[1]=-(l*c)+f*a-x*s,r[2]=l*o-p*a+x*n,r[3]=-(l*h)+p*s-f*n,r}function Zr(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=t[3];return r[0]=n+i*(e[0]-n),r[1]=s+i*(e[1]-s),r[2]=a+i*(e[2]-a),r[3]=h+i*(e[3]-h),r}function fs(r,t){t=t||1;var e,i,n,s,a,h;do e=q()*2-1,i=q()*2-1,a=e*e+i*i;while(a>=1);do n=q()*2-1,s=q()*2-1,h=n*n+s*s;while(h>=1);var o=Math.sqrt((1-a)/h);return r[0]=t*e,r[1]=t*i,r[2]=t*n*o,r[3]=t*s*o,r}function ps(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3];return r[0]=e[0]*i+e[4]*n+e[8]*s+e[12]*a,r[1]=e[1]*i+e[5]*n+e[9]*s+e[13]*a,r[2]=e[2]*i+e[6]*n+e[10]*s+e[14]*a,r[3]=e[3]*i+e[7]*n+e[11]*s+e[15]*a,r}function xs(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[0],h=e[1],o=e[2],c=e[3],l=c*i+h*s-o*n,p=c*n+o*i-a*s,f=c*s+a*n-h*i,x=-a*i-h*n-o*s;return r[0]=l*c+x*-a+p*-o-f*-h,r[1]=p*c+x*-h+f*-a-l*-o,r[2]=f*c+x*-o+l*-h-p*-a,r[3]=t[3],r}function vs(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function ms(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function Kr(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]}function Jr(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=t[0],h=t[1],o=t[2],c=t[3];return Math.abs(e-a)<=y*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(i-h)<=y*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=y*Math.max(1,Math.abs(s),Math.abs(c))}var Ms=Ct,gs=Dt,ds=Nt,ys=_t,ws=Ft,Es=vr,Ps=mr,As=function(){var r=Ot();return function(t,e,i,n,s,a){var h,o;for(e||(e=4),i||(i=0),n?o=Math.min(n*e+i,t.length):o=t.length,h=i;h<o;h+=e)r[0]=t[h],r[1]=t[h+1],r[2]=t[h+2],r[3]=t[h+3],s(r,r,a),t[h]=r[0],t[h+1]=r[1],t[h+2]=r[2],t[h+3]=r[3];return t}}();function ar(){var r=new T(4);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Rs(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Yt(r,t,e){e=e*.5;var i=Math.sin(e);return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=Math.cos(e),r}function Ts(r,t){var e=Math.acos(t[3])*2,i=Math.sin(e/2);return i>y?(r[0]=t[0]/i,r[1]=t[1]/i,r[2]=t[2]/i):(r[0]=1,r[1]=0,r[2]=0),e}function zs(r,t){var e=yr(r,t);return Math.acos(2*e*e-1)}function Ut(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],l=e[3];return r[0]=i*l+a*h+n*c-s*o,r[1]=n*l+a*o+s*h-i*c,r[2]=s*l+a*c+i*o-n*h,r[3]=a*l-i*h-n*o-s*c,r}function rt(r,t,e){e*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o+a*h,r[1]=n*o+s*h,r[2]=s*o-n*h,r[3]=a*o-i*h,r}function tt(r,t,e){e*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o-s*h,r[1]=n*o+a*h,r[2]=s*o+i*h,r[3]=a*o-n*h,r}function et(r,t,e){e*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o+n*h,r[1]=n*o-i*h,r[2]=s*o+a*h,r[3]=a*o-s*h,r}function Ss(r,t){var e=t[0],i=t[1],n=t[2];return r[0]=e,r[1]=i,r[2]=n,r[3]=Math.sqrt(Math.abs(1-e*e-i*i-n*n)),r}function qt(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=Math.sqrt(e*e+i*i+n*n),h=Math.exp(s),o=a>0?h*Math.sin(a)/a:0;return r[0]=e*o,r[1]=i*o,r[2]=n*o,r[3]=h*Math.cos(a),r}function Gt(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=Math.sqrt(e*e+i*i+n*n),h=a>0?Math.atan2(a,s)/a:0;return r[0]=e*h,r[1]=i*h,r[2]=n*h,r[3]=.5*Math.log(e*e+i*i+n*n+s*s),r}function bs(r,t,e){return Gt(r,t),Bt(r,r,e),qt(r,r),r}function gr(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=t[3],o=e[0],c=e[1],l=e[2],p=e[3],f,x,v,g,m;return x=n*o+s*c+a*l+h*p,x<0&&(x=-x,o=-o,c=-c,l=-l,p=-p),1-x>y?(f=Math.acos(x),v=Math.sin(f),g=Math.sin((1-i)*f)/v,m=Math.sin(i*f)/v):(g=1-i,m=i),r[0]=g*n+m*o,r[1]=g*s+m*c,r[2]=g*a+m*l,r[3]=g*h+m*p,r}function Is(r){var t=q(),e=q(),i=q(),n=Math.sqrt(1-t),s=Math.sqrt(t);return r[0]=n*Math.sin(2*Math.PI*e),r[1]=n*Math.cos(2*Math.PI*e),r[2]=s*Math.sin(2*Math.PI*i),r[3]=s*Math.cos(2*Math.PI*i),r}function Ls(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*e+i*i+n*n+s*s,h=a?1/a:0;return r[0]=-e*h,r[1]=-i*h,r[2]=-n*h,r[3]=s*h,r}function Os(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function Vt(r,t){var e=t[0]+t[4]+t[8],i;if(e>0)i=Math.sqrt(e+1),r[3]=.5*i,i=.5/i,r[0]=(t[5]-t[7])*i,r[1]=(t[6]-t[2])*i,r[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(t[s*3+a]-t[a*3+s])*i,r[s]=(t[s*3+n]+t[n*3+s])*i,r[a]=(t[a*3+n]+t[n*3+a])*i}return r}function Cs(r,t,e,i){var n=.5*Math.PI/180;t*=n,e*=n,i*=n;var s=Math.sin(t),a=Math.cos(t),h=Math.sin(e),o=Math.cos(e),c=Math.sin(i),l=Math.cos(i);return r[0]=s*o*l-a*h*c,r[1]=a*h*l+s*o*c,r[2]=a*o*c-s*h*l,r[3]=a*o*l+s*h*c,r}function Ds(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var Ns=Xr,_s=jr,dr=kr,Fs=Wr,Ys=Hr,Us=Ut,Bt=ur,yr=Qr,qs=Zr,wr=vr,Gs=wr,Er=mr,Vs=Er,it=$r,Bs=Kr,Xs=Jr,js=function(){var r=fr(),t=pr(1,0,0),e=pr(0,1,0);return function(i,n,s){var a=xr(n,s);return a<-.999999?(sr(r,t,n),Br(r)<1e-6&&sr(r,e,n),Vr(r,r),Yt(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(sr(r,n,s),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,it(i,i))}}(),ks=function(){var r=ar(),t=ar();return function(e,i,n,s,a,h){return gr(r,i,a,h),gr(t,n,s,h),gr(e,r,t,2*h*(1-h)),e}}(),Ws=function(){var r=Ur();return function(t,e,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],it(t,Vt(t,r))}}();var nt={};V(nt,{add:()=>va,clone:()=>us,conjugate:()=>ya,copy:()=>jt,create:()=>Hs,dot:()=>Wt,equals:()=>Ta,exactEquals:()=>Ra,fromMat4:()=>Js,fromRotation:()=>Ks,fromRotationTranslation:()=>Xt,fromRotationTranslationValues:()=>Qs,fromTranslation:()=>Zs,fromValues:()=>$s,getDual:()=>ia,getReal:()=>ea,getTranslation:()=>aa,identity:()=>ra,invert:()=>da,len:()=>wa,length:()=>Ht,lerp:()=>ga,mul:()=>ma,multiply:()=>kt,normalize:()=>Pa,rotateAroundAxis:()=>xa,rotateByQuatAppend:()=>fa,rotateByQuatPrepend:()=>pa,rotateX:()=>oa,rotateY:()=>ca,rotateZ:()=>la,scale:()=>Ma,set:()=>ta,setDual:()=>sa,setReal:()=>na,sqrLen:()=>Ea,squaredLength:()=>Pr,str:()=>Aa,translate:()=>ha});function Hs(){var r=new T(8);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r}function us(r){var t=new T(8);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t}function $s(r,t,e,i,n,s,a,h){var o=new T(8);return o[0]=r,o[1]=t,o[2]=e,o[3]=i,o[4]=n,o[5]=s,o[6]=a,o[7]=h,o}function Qs(r,t,e,i,n,s,a){var h=new T(8);h[0]=r,h[1]=t,h[2]=e,h[3]=i;var o=n*.5,c=s*.5,l=a*.5;return h[4]=o*i+c*e-l*t,h[5]=c*i+l*r-o*e,h[6]=l*i+o*t-c*r,h[7]=-o*r-c*t-l*e,h}function Xt(r,t,e){var i=e[0]*.5,n=e[1]*.5,s=e[2]*.5,a=t[0],h=t[1],o=t[2],c=t[3];return r[0]=a,r[1]=h,r[2]=o,r[3]=c,r[4]=i*c+n*o-s*h,r[5]=n*c+s*a-i*o,r[6]=s*c+i*h-n*a,r[7]=-i*a-n*h-s*o,r}function Zs(r,t){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=t[0]*.5,r[5]=t[1]*.5,r[6]=t[2]*.5,r[7]=0,r}function Ks(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r}function Js(r,t){var e=ar();Gr(e,t);var i=new T(3);return qr(i,t),Xt(r,e,i),r}function jt(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r}function ra(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r}function ta(r,t,e,i,n,s,a,h,o){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r}var ea=dr;function ia(r,t){return r[0]=t[4],r[1]=t[5],r[2]=t[6],r[3]=t[7],r}var na=dr;function sa(r,t){return r[4]=t[0],r[5]=t[1],r[6]=t[2],r[7]=t[3],r}function aa(r,t){var e=t[4],i=t[5],n=t[6],s=t[7],a=-t[0],h=-t[1],o=-t[2],c=t[3];return r[0]=(e*c+s*a+i*o-n*h)*2,r[1]=(i*c+s*h+n*a-e*o)*2,r[2]=(n*c+s*o+e*h-i*a)*2,r}function ha(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0]*.5,o=e[1]*.5,c=e[2]*.5,l=t[4],p=t[5],f=t[6],x=t[7];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=a*h+n*c-s*o+l,r[5]=a*o+s*h-i*c+p,r[6]=a*c+i*o-n*h+f,r[7]=-i*h-n*o-s*c+x,r}function oa(r,t,e){var i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=h*a+l*i+o*s-c*n,f=o*a+l*n+c*i-h*s,x=c*a+l*s+h*n-o*i,v=l*a-h*i-o*n-c*s;return rt(r,t,e),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=p*a+v*i+f*s-x*n,r[5]=f*a+v*n+x*i-p*s,r[6]=x*a+v*s+p*n-f*i,r[7]=v*a-p*i-f*n-x*s,r}function ca(r,t,e){var i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=h*a+l*i+o*s-c*n,f=o*a+l*n+c*i-h*s,x=c*a+l*s+h*n-o*i,v=l*a-h*i-o*n-c*s;return tt(r,t,e),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=p*a+v*i+f*s-x*n,r[5]=f*a+v*n+x*i-p*s,r[6]=x*a+v*s+p*n-f*i,r[7]=v*a-p*i-f*n-x*s,r}function la(r,t,e){var i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],l=t[7],p=h*a+l*i+o*s-c*n,f=o*a+l*n+c*i-h*s,x=c*a+l*s+h*n-o*i,v=l*a-h*i-o*n-c*s;return et(r,t,e),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=p*a+v*i+f*s-x*n,r[5]=f*a+v*n+x*i-p*s,r[6]=x*a+v*s+p*n-f*i,r[7]=v*a-p*i-f*n-x*s,r}function fa(r,t,e){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],l=t[3];return r[0]=h*a+l*i+o*s-c*n,r[1]=o*a+l*n+c*i-h*s,r[2]=c*a+l*s+h*n-o*i,r[3]=l*a-h*i-o*n-c*s,h=t[4],o=t[5],c=t[6],l=t[7],r[4]=h*a+l*i+o*s-c*n,r[5]=o*a+l*n+c*i-h*s,r[6]=c*a+l*s+h*n-o*i,r[7]=l*a-h*i-o*n-c*s,r}function pa(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],l=e[3];return r[0]=i*l+a*h+n*c-s*o,r[1]=n*l+a*o+s*h-i*c,r[2]=s*l+a*c+i*o-n*h,r[3]=a*l-i*h-n*o-s*c,h=e[4],o=e[5],c=e[6],l=e[7],r[4]=i*l+a*h+n*c-s*o,r[5]=n*l+a*o+s*h-i*c,r[6]=s*l+a*c+i*o-n*h,r[7]=a*l-i*h-n*o-s*c,r}function xa(r,t,e,i){if(Math.abs(i)<y)return jt(r,t);var n=Math.hypot(e[0],e[1],e[2]);i=i*.5;var s=Math.sin(i),a=s*e[0]/n,h=s*e[1]/n,o=s*e[2]/n,c=Math.cos(i),l=t[0],p=t[1],f=t[2],x=t[3];r[0]=l*c+x*a+p*o-f*h,r[1]=p*c+x*h+f*a-l*o,r[2]=f*c+x*o+l*h-p*a,r[3]=x*c-l*a-p*h-f*o;var v=t[4],g=t[5],m=t[6],d=t[7];return r[4]=v*c+d*a+g*o-m*h,r[5]=g*c+d*h+m*a-v*o,r[6]=m*c+d*o+v*h-g*a,r[7]=d*c-v*a-g*h-m*o,r}function va(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r}function kt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[4],o=e[5],c=e[6],l=e[7],p=t[4],f=t[5],x=t[6],v=t[7],g=e[0],m=e[1],d=e[2],E=e[3];return r[0]=i*E+a*g+n*d-s*m,r[1]=n*E+a*m+s*g-i*d,r[2]=s*E+a*d+i*m-n*g,r[3]=a*E-i*g-n*m-s*d,r[4]=i*l+a*h+n*c-s*o+p*E+v*g+f*d-x*m,r[5]=n*l+a*o+s*h-i*c+f*E+v*m+x*g-p*d,r[6]=s*l+a*c+i*o-n*h+x*E+v*d+p*m-f*g,r[7]=a*l-i*h-n*o-s*c+v*E-p*g-f*m-x*d,r}var ma=kt;function Ma(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r}var Wt=yr;function ga(r,t,e,i){var n=1-i;return Wt(t,e)<0&&(i=-i),r[0]=t[0]*n+e[0]*i,r[1]=t[1]*n+e[1]*i,r[2]=t[2]*n+e[2]*i,r[3]=t[3]*n+e[3]*i,r[4]=t[4]*n+e[4]*i,r[5]=t[5]*n+e[5]*i,r[6]=t[6]*n+e[6]*i,r[7]=t[7]*n+e[7]*i,r}function da(r,t){var e=Pr(t);return r[0]=-t[0]/e,r[1]=-t[1]/e,r[2]=-t[2]/e,r[3]=t[3]/e,r[4]=-t[4]/e,r[5]=-t[5]/e,r[6]=-t[6]/e,r[7]=t[7]/e,r}function ya(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r[4]=-t[4],r[5]=-t[5],r[6]=-t[6],r[7]=t[7],r}var Ht=wr,wa=Ht,Pr=Er,Ea=Pr;function Pa(r,t){var e=Pr(t);if(e>0){e=Math.sqrt(e);var i=t[0]/e,n=t[1]/e,s=t[2]/e,a=t[3]/e,h=t[4],o=t[5],c=t[6],l=t[7],p=i*h+n*o+s*c+a*l;r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=(h-i*p)/e,r[5]=(o-n*p)/e,r[6]=(c-s*p)/e,r[7]=(l-a*p)/e}return r}function Aa(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"}function Ra(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]}function Ta(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],l=t[0],p=t[1],f=t[2],x=t[3],v=t[4],g=t[5],m=t[6],d=t[7];return Math.abs(e-l)<=y*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(i-p)<=y*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-f)<=y*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-x)<=y*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-v)<=y*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-g)<=y*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(o-m)<=y*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(c-d)<=y*Math.max(1,Math.abs(c),Math.abs(d))}var H={};V(H,{add:()=>La,angle:()=>Qa,ceil:()=>Oa,clone:()=>za,copy:()=>ba,create:()=>ut,cross:()=>Ba,dist:()=>s1,distance:()=>Kt,div:()=>n1,divide:()=>Zt,dot:()=>Va,equals:()=>r1,exactEquals:()=>Ja,floor:()=>Ca,forEach:()=>o1,fromValues:()=>Sa,inverse:()=>qa,len:()=>t1,length:()=>re,lerp:()=>Xa,max:()=>Na,min:()=>Da,mul:()=>i1,multiply:()=>Qt,negate:()=>Ua,normalize:()=>Ga,random:()=>ja,rotate:()=>$a,round:()=>_a,scale:()=>Fa,scaleAndAdd:()=>Ya,set:()=>Ia,sqrDist:()=>a1,sqrLen:()=>h1,squaredDistance:()=>Jt,squaredLength:()=>te,str:()=>Ka,sub:()=>e1,subtract:()=>$t,transformMat2:()=>ka,transformMat2d:()=>Wa,transformMat3:()=>Ha,transformMat4:()=>ua,zero:()=>Za});function ut(){var r=new T(2);return T!=Float32Array&&(r[0]=0,r[1]=0),r}function za(r){var t=new T(2);return t[0]=r[0],t[1]=r[1],t}function Sa(r,t){var e=new T(2);return e[0]=r,e[1]=t,e}function ba(r,t){return r[0]=t[0],r[1]=t[1],r}function Ia(r,t,e){return r[0]=t,r[1]=e,r}function La(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function $t(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function Qt(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r}function Zt(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r}function Oa(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r}function Ca(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r}function Da(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r}function Na(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r}function _a(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r}function Fa(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r}function Ya(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r}function Kt(r,t){var e=t[0]-r[0],i=t[1]-r[1];return Math.hypot(e,i)}function Jt(r,t){var e=t[0]-r[0],i=t[1]-r[1];return e*e+i*i}function re(r){var t=r[0],e=r[1];return Math.hypot(t,e)}function te(r){var t=r[0],e=r[1];return t*t+e*e}function Ua(r,t){return r[0]=-t[0],r[1]=-t[1],r}function qa(r,t){return r[0]=1/t[0],r[1]=1/t[1],r}function Ga(r,t){var e=t[0],i=t[1],n=e*e+i*i;return n>0&&(n=1/Math.sqrt(n)),r[0]=t[0]*n,r[1]=t[1]*n,r}function Va(r,t){return r[0]*t[0]+r[1]*t[1]}function Ba(r,t,e){var i=t[0]*e[1]-t[1]*e[0];return r[0]=r[1]=0,r[2]=i,r}function Xa(r,t,e,i){var n=t[0],s=t[1];return r[0]=n+i*(e[0]-n),r[1]=s+i*(e[1]-s),r}function ja(r,t){t=t||1;var e=q()*2*Math.PI;return r[0]=Math.cos(e)*t,r[1]=Math.sin(e)*t,r}function ka(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n,r[1]=e[1]*i+e[3]*n,r}function Wa(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n+e[4],r[1]=e[1]*i+e[3]*n+e[5],r}function Ha(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[3]*n+e[6],r[1]=e[1]*i+e[4]*n+e[7],r}function ua(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[4]*n+e[12],r[1]=e[1]*i+e[5]*n+e[13],r}function $a(r,t,e,i){var n=t[0]-e[0],s=t[1]-e[1],a=Math.sin(i),h=Math.cos(i);return r[0]=n*h-s*a+e[0],r[1]=n*a+s*h+e[1],r}function Qa(r,t){var e=r[0],i=r[1],n=t[0],s=t[1],a=Math.sqrt(e*e+i*i)*Math.sqrt(n*n+s*s),h=a&&(e*n+i*s)/a;return Math.acos(Math.min(Math.max(h,-1),1))}function Za(r){return r[0]=0,r[1]=0,r}function Ka(r){return"vec2("+r[0]+", "+r[1]+")"}function Ja(r,t){return r[0]===t[0]&&r[1]===t[1]}function r1(r,t){var e=r[0],i=r[1],n=t[0],s=t[1];return Math.abs(e-n)<=y*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(i-s)<=y*Math.max(1,Math.abs(i),Math.abs(s))}var t1=re,e1=$t,i1=Qt,n1=Zt,s1=Kt,a1=Jt,h1=te,o1=function(){var r=ut();return function(t,e,i,n,s,a){var h,o;for(e||(e=2),i||(i=0),n?o=Math.min(n*e+i,t.length):o=t.length,h=i;h<o;h+=e)r[0]=t[h],r[1]=t[h+1],s(r,r,a),t[h]=r[0],t[h+1]=r[1];return t}}();var $=class{position=S.fromValues(0,0,-1);direction=S.fromValues(0,0,-1);up=S.fromValues(0,1,0);projectionMatrix=b.create();viewMatrix=b.create();cameraMatrix=b.create();viewportWidth=0;viewportHeight=0;near=1;far=100;tpmVec=S.create();constructor(){}lookAt(...t){if(t.length==1)S.copy(this.tpmVec,t[0]);else if(t.length==3)S.set(this.tpmVec,...t);else throw new Error("required 1 or 3 arguments");S.sub(this.tpmVec,this.tpmVec,this.position),S.normalize(this.tpmVec,this.tpmVec);let e=S.dot(this.tpmVec,this.up);G.equals(e,1)?S.negate(this.up,this.direction):G.equals(e,-1)&&S.copy(this.up,this.direction),S.copy(this.direction,this.tpmVec),S.cross(this.up,this.getRight(),this.direction),S.normalize(this.up,this.up)}getRight(){return S.cross(this.tpmVec,this.direction,this.up)}updateConstants(t){b.lookAt(this.viewMatrix,this.position,S.add(this.tpmVec,this.position,this.direction),this.up),b.invert(this.cameraMatrix,this.viewMatrix),t.projectionMatrix=this.projectionMatrix,t.viewMatrix=this.viewMatrix,t.cameraMatrix=this.cameraMatrix,t.cameraPosition=this.position}};var U=class{buffers=new Map;indexCount=0;options;constructor(t={}){this.options=t,this.onInit()}onInit(){}createBuffer(t,e){let i={size:e,data:[],buffer:null};return this.buffers.set(t,i),i}getBuffer(t){return this.buffers.get(t)}bufferData(t,e,i){this.buffers.set(i,{size:e,data:t,buffer:null})}initBuffer(t){let e=this.buffers.get(t);e.buffer==null&&(e.buffer=M.gl.createBuffer()),t=="index"?(M.gl.bindBuffer(M.gl.ELEMENT_ARRAY_BUFFER,e.buffer),M.gl.bufferData(M.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.data),M.gl.STATIC_DRAW),this.indexCount=e.data.length):(M.gl.bindBuffer(M.gl.ARRAY_BUFFER,e.buffer),M.gl.bufferData(M.gl.ARRAY_BUFFER,new Float32Array(e.data),M.gl.STATIC_DRAW))}bind(t){this.buffers.forEach((e,i)=>{let n=t.shaderData.attribs[i];n!=-1&&(e.buffer==null&&this.initBuffer(i),i=="index"?M.gl.bindBuffer(M.gl.ELEMENT_ARRAY_BUFFER,e.buffer):(M.gl.bindBuffer(M.gl.ARRAY_BUFFER,e.buffer),M.gl.vertexAttribPointer(n,e.size,M.gl.FLOAT,!1,0,0),M.gl.enableVertexAttribArray(n)))})}draw(){M.gl.drawElements(M.gl.TRIANGLES,this.indexCount,M.gl.UNSIGNED_SHORT,0)}unbind(t){this.buffers.forEach((e,i)=>{let n=t.shaderData.attribs[i];n!=-1&&i!="index"&&M.gl.disableVertexAttribArray(n)})}};var k=class{shaderData;uniforms=new Map;constructor(t){this.shaderData=t,this.setUniform("uvOffset",[0,0])}setUniform(t,e){this.uniforms.set(t,e)}activate(){this.shaderData.activate()}bind(t){for(let e of this.shaderData.uniforms){let i=t[e.name];if(this.uniforms.has(e.name)&&(i=this.uniforms.get(e.name)),i&&e.location){let n=e.type,s=e.location;switch(n){case"mat4":M.gl.uniformMatrix4fv(s,!1,i);break;case"mat3":M.gl.uniformMatrix3fv(s,!1,val);break;case"vec4":M.gl.uniform4fv(s,i);break;case"vec3":M.gl.uniform3fv(s,i);break;case"vec2":M.gl.uniform2fv(s,i);break;case"float":M.gl.uniform1f(s,i);break}}}}};var W=class{mesh;shader;texture;position=S.create();rotation=K.create();scale=S.fromValues(1,1,1);parent=null;modelMatrix=b.create();normalMatrix=b.create();matrixAutoUpdate=!0;matrixNeedsUpdate=!0;constructor(t,e,i){this.mesh=t,this.shader=e,this.texture=i}setShader(t){this.shader=t}updateMatrix(){(this.matrixNeedsUpdate||this.matrixAutoUpdate)&&(this.matrixNeedsUpdate=!1,b.fromRotationTranslationScale(this.modelMatrix,this.rotation,this.position,this.scale),u.fromMat4(this.normalMatrix,this.modelMatrix),u.invert(this.normalMatrix,this.normalMatrix),u.transpose(this.normalMatrix,this.normalMatrix))}draw(t){this.shader.activate(),this.texture&&this.texture.bind(),this.updateMatrix();let e=t.viewMatrix,i=b.create();b.multiply(i,e,this.modelMatrix),this.shader.setUniform("modelViewMatrix",i),this.shader.setUniform("modelMatrix",this.modelMatrix),this.shader.setUniform("normalMatrix",this.normalMatrix),this.shader.bind(t),this.mesh.bind(this.shader),this.mesh.draw(),this.mesh.unbind(this.shader)}};var Ar=class extends ${fov;constructor(t,e,i,n,s){super(),this.fov=t,this.viewportWidth=e,this.viewportHeight=i,this.near=n,this.far=s,this.updateProjection()}updateProjection(){let t=this.viewportWidth/this.viewportHeight;b.perspective(this.projectionMatrix,this.fov/180*Math.PI,t,this.near,this.far)}};var st={};V(st,{Cube:()=>Rr,Plane:()=>J,Quad:()=>rr,Sphere:()=>Tr});var Rr=class extends U{onInit(){let t=this.options.width?this.options.width/2:.5,e=this.options.height?this.options.height/2:.5,i=this.options.depth?this.options.depth/2:.5,n=[-t,e,i,t,e,i,t,-e,i,-t,-e,i,-t,e,-i,t,e,-i,t,-e,-i,-t,-e,-i,-t,e,-i,t,e,-i,t,e,i,-t,e,i,-t,-e,i,t,-e,i,t,-e,-i,-t,-e,-i,t,e,i,t,e,-i,t,-e,-i,t,-e,i,-t,e,-i,-t,e,i,-t,-e,i,-t,-e,-i],s=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],a="single";this.options.textureFaces!==void 0&&(a=this.options.textureFaces);let h=[];if(a=="single")for(let p=0;p<6;++p)h.push(0,0,1,0,1,1,0,1);else if(a=="multiple"){let x=(v,g)=>{h.push(v*.25,g*.5,.25*(v+1),g*.5,.25*(v+1),.5*(g+1),v*.25,.5*(g+1))};x(1,0),x(3,0),x(0,1),x(1,1),x(2,0),x(0,0)}else throw new Error("options.textureFaces valid values are single or multiple");let o=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],c=[];if(this.options.colors===void 0)for(let p=0;p<24;++p)c.push(1);else if(this.options.colors.length==1){let p=this.options.colors[0];for(let f=0;f<24;++f)c.push(p[f%4])}else if(this.options.colors.length==6)for(let p=0;p<6;++p){let f=this.options.colors[p];for(let x=0;x<4;++x)c.push(f[x])}else throw new Error("options.colors requires 1 or 6 elements");let l=[];for(let p=0;p<6;++p)for(let f=0;f<4;++f)for(let x=0;x<4;++x)l.push(c[p*4+x]);this.bufferData(n,3,"positions"),this.bufferData(s,3,"normals"),this.bufferData(l,4,"colors"),this.bufferData(h,2,"uvs"),this.bufferData(o,0,"index")}};var J=class extends U{onInit(){let t=this.options.width?this.options.width/2:.5,e=this.options.depth?this.options.depth/2:.5,i=this.options.widthSegments||1,n=this.options.depthSegments||1,s=this.options.heightMap||J.generateHeightMap(i,n),a=[],h=[],o=[],c=[],l=[];for(let p=0;p<n;++p)for(let f=0;f<i;++f){a.push((2*f/i-1)*t,s[p][f],(2*p/n-1)*e,(2*(f+1)/i-1)*t,s[p][f+1],(2*p/n-1)*e,(2*(f+1)/i-1)*t,s[p+1][f+1],(2*(p+1)/n-1)*e,(2*f/i-1)*t,s[p+1][f],(2*(p+1)/n-1)*e),h.push(0,1,0,0,1,0,0,1,0,0,1,0),this.options.textureRepeat===void 0||this.options.textureRepeat===!1?o.push(f/i,p/n,(f+1)/i,p/n,(f+1)/i,(p+1)/n,f/i,(p+1)/n):o.push(0,0,1,0,1,1,0,1);let x=(p*i+f)*4;l.push(x,x+1,x+2,x,x+2,x+3)}if(this.options.colors===void 0)for(let p=0;p<i*n*16;++p)c.push(1);else if(typeof this.options.colors=="function"){let p=this.options.colors,f=[];for(let x=0;x<=n;++x){f.push([]);for(let v=0;v<=i;++v){let g=p(v/i*t*2-t,s[x][v],x/n*e*2-e);f[x].push(g)}}for(let x=0;x<n;++x)for(let v=0;v<i;++v)c.push(...f[x][v],...f[x][v+1],...f[x+1][v+1],...f[x+1][v])}else if(this.options.colors.length==1){let p=this.options.colors[0];for(let f=0;f<i*n*16;++f)c.push(p[f%4])}else throw new Error("options.colors requires 1 elements");this.bufferData(a,3,"positions"),this.bufferData(h,3,"normals"),this.bufferData(c,4,"colors"),this.bufferData(o,2,"uvs"),this.bufferData(l,0,"index")}static generateHeightMap(t,e){return[...new Array(e+1)].map(i=>[...new Array(t+1)].fill(0))}};var rr=class extends U{onInit(){let t=this.options.width?this.options.width/2:.5,e=this.options.height?this.options.height/2:.5,i=[-t,e,0,t,e,0,t,-e,0,-t,-e,0],n=[0,0,1,0,0,1,0,0,1,0,0,1],s=[];if(this.options.colors===void 0)for(let o=0;o<16;++o)s.push(1);else if(this.options.colors.length==1){let o=this.options.colors[0];for(let c=0;c<16;++c)s.push(o[c%4])}else if(this.options.colors.length==4)for(let o=0;o<4;++o){let c=this.options.colors[o];for(let l=0;l<4;++l)s.push(c[l])}else throw new Error("options.colors requires 1 or 4 elements");let a=[0,0,1,0,1,1,0,1],h=[0,1,2,0,2,3];this.bufferData(i,3,"positions"),this.bufferData(n,3,"normals"),this.bufferData(s,4,"colors"),this.bufferData(a,2,"uvs"),this.bufferData(h,0,"index")}};var tr=class{points=[];constructor(t){this.lerp=t}addPoint(t,e){this.points.push([t,e]);for(let i=this.points.length-1;i>0&&!(this.points[i][0]>=this.points[i-1][0]);--i)[this.points[i],this.points[i-1]]=[this.points[i-1],this.points[i]]}getValue(t){let e=0;for(let a=0;a<this.points.length&&!(t<this.points[a][0]);++a)e=a;let i=this.points[e],n=Math.min(e+1,this.points.length-1);if(e==n)return i[1];let s=this.points[n];return this.lerp((t-i[0])/(s[0]-i[0]),i[1],s[1])}};var Tr=class extends U{onInit(){this.options.radius===void 0&&(this.options.radius=.5);let t=this.options.radius,e=this.options.widthSegments||32,i=this.options.heightSegments||16,n=[],s=[],a=[],h=[],o=[],c=[],l=[];for(let f=0;f<=i;++f){let x=f/i*Math.PI,v=Math.sin(x),g=Math.cos(x);for(let m=0;m<=e;++m){let d=m/e*2*Math.PI,E=Math.sin(d),w=Math.cos(d);o.push([v*w*t,g*t,v*E*t]),c.push([1-m/e,f/i])}}if(this.options.colors===void 0)for(let f=0;f<(e+1)*(i+1);++f)l.push([1,1,1,1]);else if(this.options.colors instanceof tr)for(let f=0;f<=i;++f){let x=this.options.colors.getValue(f/i);for(let v=0;v<=e;++v)l.push(x)}else if(this.options.colors.length==1){let f=this.options.colors[0];for(let x=0;x<(e+1)*(i+1);++x)l.push(f)}else throw new Error("options.colors requires 1 elements");let p=0;for(let f=0;f<i;++f)for(let x=0;x<e;++x){let v=f*(e+1)+x,g=v+(e+1),m=[v,v+1,g+1,g];for(let d of m)n.push(...o[d]),s.push(...c[d]),a.push(...l[d]);h.push(p,p+1,p+2,p,p+2,p+3),p+=4}this.bufferData(n,3,"positions"),this.bufferData(a,4,"colors"),this.bufferData(s,2,"uvs"),this.bufferData(h,0,"index")}};var zr=class extends ${zoom=1;constructor(t,e){super(),this.near=0,this.setToOrtho(t,e)}setToOrtho(t,e){this.viewportWidth=t,this.viewportHeight=e,S.set(this.position,this.zoom*t/2,this.zoom*e/2,0),this.updateProjection()}updateProjection(){b.ortho(this.projectionMatrix,this.zoom*-this.viewportWidth/2,this.zoom*this.viewportWidth/2,this.zoom*-this.viewportHeight/2,this.zoom*this.viewportHeight/2,this.near,this.far)}translate(...t){if(t.length==1)S.set(this.position,...t[0],0);else if(t.length==2)S.set(this.position,t[0],t[1],0);else throw new Error("required 1 or 2 arguments")}zoomBy(...t){let e=t[0];if(this.zoom*=1+e,t.length==2||t.length==3){let i=H.create();t.length==2?H.copy(i,t[1]):H.set(i,...t),H.sub(i,i,this.position),H.scale(i,i,e),S.add(this.position,this.position,[...i,0])}}};var Sr=class extends W{regionX;regionY;regionWidth;regionHeight;constructor(...t){let e=t[0],i=0,n=0,s=e.width,a=e.height;t.length==3?(s=t[1],a=t[2]):t.length==5&&(i=t[1],n=t[2],s=t[3],a=t[4]),super(new rr,new k(M.graphics.getShader("texture")),e),this.setRegion(i,n,s,a)}setRegion(t,e,i,n){this.regionX=t,this.regionY=e,this.regionWidth=i,this.regionHeight=n;let s=this.texture.width,a=this.texture.height,h=[t/s,e/a,(t+i)/s,e/a,(t+i)/s,(e+n)/a,t/s,(e+n)/a];this.mesh.bufferData(h,2,"uvs")}setRegionSize(t,e){this.regionWidth=t,this.regionHeight=e;let i=[0,0,t/this.texture.width,0,t/this.texture.width,e/this.texture.height,0,e/this.texture.height];this.mesh.bufferData(i,2,"uvs")}setRegionPosition(t,e){this.regionX=t,this.regionY=e,this.shader.setUniform("uvOffset",[t/this.texture.width,e/this.texture.height])}};var br=class extends W{font;text;rainbow;constructor(t,e="",i=!1){super(new U,new k(M.graphics.getShader("texture")),t.texture),this.font=t,this.text=e,this.rainbow=i,this.updateGeometry()}updateGeometry(){let t=[],e=[],i=[],n=[],s=this.font.charWidth,a=this.font.charHeight,h=this.font.options.charRatio,o=(1-this.text.length)*h*.5;for(let c=0;c<this.text.length;++c){let l=this.text.charCodeAt(c),p=this.font.getCharPosition(l);if(p===null)continue;let[f,x]=p;t.push(-.5*h+o,.5,0,.5*h+o,.5,0,.5*h+o,-.5,0,-.5*h+o,-.5,0),i.push(f/this.texture.width,x/this.texture.height,(f+s)/this.texture.width,x/this.texture.height,(f+s)/this.texture.width,(x+a)/this.texture.height,f/this.texture.width,(x+a)/this.texture.height);let v=c*4;n.push(v,v+1,v+2,v,v+2,v+3),o+=h}if(this.rainbow)for(let c=0;c<4*this.text.length;++c)e.push(Math.random(),Math.random(),Math.random(),1);else for(let c=0;c<4*this.text.length;++c)e.push(1,1,1,1);this.mesh.bufferData(t,3,"positions"),this.mesh.bufferData(e,4,"colors"),this.mesh.bufferData(i,2,"uvs"),this.mesh.bufferData(n,0,"index")}setText(t){this.text=t,this.updateGeometry()}};var Ir=class{position;velocity;color;alpha;size;life;maxLife;constructor(t){this.position=t.position,this.maxLife=t.life,this.life=t.life,this.size=t.size!==void 0?t.size:1,this.velocity=t.velocity||[0,0,0],this.color=t.color||[1,1,1],this.alpha=t.alpha!==void 0?t.alpha:1}update(){this.life-=M.graphics.delta*1e3}},Lr=class{mesh;texture;shader;particles=[];constructor(t){this.mesh=new U,this.texture=t.texture,this.shader=new k(L.create(L.Type.PARTICLE,t.shaderOptions||{})),this.onScreenResize(M.graphics.width,M.graphics.height)}onScreenResize(t,e){this.shader.setUniform("pointMultiplier",e/2*Math.tan(30*Math.PI/180))}addParticles(){}updateParticles(){}updateGeometry(){let t=[],e=[],i=[];for(let n of this.particles)t.push(...n.position),e.push(...n.color,n.alpha),i.push(n.size);this.mesh.bufferData(t,3,"positions"),this.mesh.bufferData(e,4,"colors"),this.mesh.bufferData(i,1,"sizes")}draw(t){this.shader.activate(),this.texture.bind();let e=b.create(),i=t.viewMatrix,n=b.create();b.multiply(n,i,e),this.shader.setUniform("modelViewMatrix",n),this.shader.bind(t),this.mesh.bind(this.shader);let s=this.particles.length;M.gl.drawArrays(M.gl.POINTS,0,s),this.mesh.unbind(this.shader)}update(){this.addParticles(),this.updateParticles(),this.updateGeometry()}};var at=class{mesh=new U;shader;idx=0;texture=null;onCustomProcessPosition=null;constants={projectionMatrix:b.create(),viewMatrix:b.create(),cameraMatrix:b.create(),cameraPosition:S.create()};constructor(t){this.shader=t,t.shaderData.attribs.index!=-1&&this.mesh.createBuffer("index",0),t.shaderData.attribs.positions!=-1&&this.mesh.createBuffer("positions",3),t.shaderData.attribs.uvs!=-1&&this.mesh.createBuffer("uvs",2),t.shaderData.attribs.colors!=-1&&this.mesh.createBuffer("colors",4)}setConstants(t){this.constants={...t}}begin(){this.idx=0,this.mesh.buffers.forEach(t=>{t.data.length=0}),this.texture=null}draw(t){let e=t.mesh.getBuffer("positions").data.length/3;(this.idx+e>at.MAX_COUNT||t.texture!=this.texture)&&this.flush(),this.texture=t.texture,t.updateMatrix(),this.mesh.buffers.forEach((i,n)=>{let s=t.mesh.getBuffer(n).data;switch(n){case"positions":for(let a=0;a<s.length;a+=3){let h=S.fromValues(s[a],s[a+1],s[a+2]);this.onCustomProcessPosition&&this.onCustomProcessPosition(h,t),S.transformMat4(h,h,t.modelMatrix);for(let o=0;o<3;++o)i.data.push(h[o])}break;case"index":for(let a=0;a<s.length;++a)i.data.push(s[a]+this.idx);break;default:for(let a=0;a<s.length;++a)i.data.push(s[a])}}),this.idx+=e}end(){this.flush()}flush(){if(this.idx==0)return;this.mesh.buffers.forEach((s,a)=>{this.mesh.initBuffer(a)}),this.shader.activate(),this.texture&&this.texture.bind();let t=b.create(),e=b.create(),i=this.constants.viewMatrix,n=b.create();b.multiply(n,i,t),this.shader.setUniform("modelViewMatrix",n),this.shader.setUniform("modelMatrix",t),this.shader.setUniform("normalMatrix",e),this.shader.bind(this.constants),this.mesh.bind(this.shader),this.mesh.draw(),this.mesh.unbind(this.shader),this.idx=0,this.mesh.buffers.forEach(s=>{s.data.length=0})}},hr=at;Y(hr,"MAX_COUNT",65536);var Or=class extends W{idx=0;constructor(t,e){super(new U,t,e),t.shaderData.attribs.index!=-1&&this.mesh.createBuffer("index",0),t.shaderData.attribs.positions!=-1&&this.mesh.createBuffer("positions",3),t.shaderData.attribs.uvs!=-1&&this.mesh.createBuffer("uvs",2),t.shaderData.attribs.colors!=-1&&this.mesh.createBuffer("colors",4)}add(t){t.updateMatrix(),this.mesh.buffers.forEach((e,i)=>{let n=t.mesh.getBuffer(i).data;switch(i){case"positions":for(let s=0;s<n.length;s+=3){let a=S.fromValues(n[s],n[s+1],n[s+2]);S.transformMat4(a,a,t.modelMatrix);for(let h=0;h<3;++h)e.data.push(a[h])}break;case"index":for(let s=0;s<n.length;++s)e.data.push(n[s]+this.idx);break;default:for(let s=0;s<n.length;++s)e.data.push(n[s])}}),this.idx+=count}};var ht=class{touchInfo=[];keyInfo={currentlyPressed:new Set,previouslyPressed:new Set,justPressed:new Set};constructor(){for(let t=0;t<ht.MAX_TOUCHES;++t)this.touchInfo[t]={x:null,y:null,isTouched:!1,wasTouched:!1,isJustTouched:!1}}isKeyPressed(t){return this.keyInfo.currentlyPressed.has(t)}isKeyClicked(t){return this.keyInfo.justPressed.has(t)}isTouched(t=0){return this.touchInfo[t].isTouched}isJustTouched(t=0){return this.touchInfo[t].isJustTouched}isMousePressed(){return this.isTouched()}isMouseClicked(){return this.isJustTouched()}getX(t=0){return this.touchInfo[t].x}getY(t=0){return this.touchInfo[t].y}initEvents(){let t=M.graphics.canvas;addEventListener("keydown",e=>this.onKeyDown(e)),addEventListener("keyup",e=>this.onKeyUp(e)),t.addEventListener("touchstart",e=>this.handleTouchEvent(e)),t.addEventListener("touchmove",e=>this.handleTouchEvent(e)),t.addEventListener("touchend",e=>this.handleTouchEvent(e)),t.addEventListener("mousedown",e=>this.handleMouseEvent(e)),t.addEventListener("mousemove",e=>this.handleMouseEvent(e)),t.addEventListener("mouseup",e=>this.handleMouseEvent(e))}handleTouchEvent(t){let e=t.target.getBoundingClientRect();for(let i of t.changedTouches){let n=i.pageX-e.x,s=i.pageY-e.y,a=this.touchInfo[i.identifier];switch(a.x=n,a.y=e.height-s,t.type){case"touchstart":a.isTouched=!0;break;case"touchend":a.isTouched=!1}}}handleMouseEvent(t){let e=t.target.getBoundingClientRect(),i=t.pageX-e.x,n=t.pageY-e.y,s=this.touchInfo[0];switch(s.x=i,s.y=e.height-n,t.type){case"mousedown":s.isTouched=!0;break;case"mouseup":s.isTouched=!1}}onKeyDown(t){this.keyInfo.currentlyPressed.add(t.code)}onKeyUp(t){this.keyInfo.currentlyPressed.delete(t.code)}update(){this.keyInfo.currentlyPressed.forEach(t=>{this.keyInfo.previouslyPressed.has(t)||this.keyInfo.justPressed.add(t)}),this.keyInfo.previouslyPressed=new Set(this.keyInfo.currentlyPressed);for(let t of this.touchInfo)t.isJustTouched=t.isTouched&&!t.wasTouched,t.wasTouched=t.isTouched}},or=ht;Y(or,"MAX_TOUCHES",10);var ne={};V(ne,{LinearSpline:()=>tr,MathUtils:()=>B,Rectangle:()=>er});var er=class{x;y;width;height;constructor(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}setPosition(...t){if(t.length==1)this.x=t[0][0],this.y=t[0][1];else if(t.length==2)this.x=t[0],this.y=t[1];else throw new Error("1 or 2 arguments required");return this}setSize(...t){if(t.length==1)this.width=t[0][0],this.height=t[0][1];else if(t.length==2)this.width=t[0],this.height=t[1];else throw new Error("1 or 2 arguments required");return this}copy(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}clone(){return new er(this.x,this.y,this.width,this.height)}containsPoint(...t){let e,i;if(t.length==2)e=t[0],i=t[1];else if(t.length==1)e=t[0][0],i=t[0][1];else throw new Error("1 or 2 arguments required");return this.x<=e&&this.x+this.width>=e&&this.y<=i&&this.y+this.height>=i}containsRectangle(t){let e=t.x,i=e+t.width,n=t.y,s=n+t.height;return e>this.x&&e<this.x+this.width&&i>this.x&&i<this.x+this.width&&n>this.y&&n<this.y+this.height&&s>this.y&&s<this.y+this.height}overlaps(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}area(){return this.width*this.height}perimeter(){return(this.width+this.height)*2}};var Cr=class{audioContext;bgMusicNode=null;masterGain;bgMusicGain;cueGain;analyser;dataArray;constructor(){this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=1,this.bgMusicGain=this.audioContext.createGain(),this.bgMusicGain.connect(this.masterGain),this.bgMusicGain.gain.value=1,this.cueGain=this.audioContext.createGain(),this.cueGain.connect(this.masterGain),this.cueGain.gain.value=1,this.analyser=this.audioContext.createAnalyser(),this.analyser.connect(this.audioContext.destination),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)}get masterVolume(){return this.masterGain.gain.value}set masterVolume(t){this.masterGain.gain.value=B.sat(t)}get bgMusicVolume(){return this.bgMusicGain.gain.value}set bgMusicVolume(t){this.bgMusicGain.gain.value=B.sat(t)}get cueVolume(){return this.cueGain.gain.value}set cueVolume(t){this.cueGain.gain.value=B.sat(t)}setFrequencyDataSize(t){if(!B.isPowerOf2(t)&&t<16)throw new Error("size must be power of 2 and equal or bigger than 16");this.analyser.fftSize=t*2,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.dataArray),this.dataArray}playBgMusic(t,e={}){let i=e.loop===void 0?!0:e.loop,n=e.time===void 0?0:e.time,s=M.files.get(t);this.stopBgMusic(),this.bgMusicNode=this.audioContext.createBufferSource(),this.bgMusicNode.buffer=s,this.bgMusicNode.loop=i,this.bgMusicNode.start(n),this.bgMusicNode.connect(this.bgMusicGain),this.bgMusicNode.connect(this.analyser)}stopBgMusic(){this.isBgMusicPlaying()&&(this.bgMusicNode.stop(0),this.bgMusicNode=null)}isBgMusicPlaying(){return this.bgMusicNode!==null}playCue(t,e=1){let i=M.files.get(t),n=this.audioContext.createBufferSource();n.buffer=i,n.start(0);let s=this.audioContext.createGain();s.connect(this.cueGain),s.gain.value=B.sat(e),n.connect(s)}onResume(){this.audioContext.state=="suspended"&&this.audioContext.resume()}};var Dr=class{type;constructor(){this.detectDeviceType()}detectDeviceType(){let t=navigator.userAgent;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(t)?this.type="mobile":this.type="desktop"}};var M=class{static async init(t){this.graphics=new lr(t),this.files=new cr,this.input=new or,this.audio=new Cr,this.device=new Dr;for(let e of["mousedown","touchdown","keydown"])addEventListener(e,()=>this.audio.onResume());this.input.initEvents(),this.graphics.compileShaders(),this.graphics.generateFonts(),t.preload(),await this.files.waitForAssetsToLoad(),t.create(),addEventListener("resize",()=>this.graphics.onResize()),this.graphics.onResize(),this.graphics.onResume()}static get gl(){return this.graphics.gl}};Y(M,"graphics"),Y(M,"files"),Y(M,"input"),Y(M,"audio"),Y(M,"device");export{_r as Game,M as Gol,Nr as Screen,ee as glMatrix,ie as graphics,ne as math};
//# sourceMappingURL=goliath.js.map
