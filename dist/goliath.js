var lt=Object.defineProperty;var ae=(r,t,e)=>t in r?lt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var G=(r,t)=>{for(var e in t)lt(r,e,{get:t[e],enumerable:!0})};var Y=(r,t,e)=>(ae(r,typeof t!="symbol"?t+"":t,e),e);var cr=class{assets=new Map;toLoad=0;loadImage(t,e){let i=new Image;i.src=e,i.crossOrigin="Anonymous";let n=new Promise(s=>{i.onload=()=>{s(i)}});return this.addAsync(t,n),n}loadAudio(t,e){let i=fetch(e).then(n=>n.arrayBuffer()).then(n=>M.audio.audioContext.decodeAudioData(n));return this.addAsync(t,i),i}addAsync(t,e){++this.toLoad,e.then(i=>{this.assets.set(t,i),--this.toLoad})}waitForAssetsToLoad(){return new Promise(t=>{let e=()=>{this.toLoad==0?t(this.assets):setTimeout(()=>{e()},250)};e()})}get(t){return this.assets.get(t)}};var Nr=class{constructor(){this.create()}create(){}show(){}hide(){}resize(t,e){}render(t){}dispose(){}};var _r=class{screen=null;constructor(){}preload(){}create(){}resize(t,e){this.screen&&this.screen.resize(t,e)}render(t){this.screen&&this.screen.render(t)}setScreen(t){this.screen&&this.screen.hide(),this.screen=t,this.screen.show()}};var u=class{static lerp(t,e,i){return(i-e)*t+e}static rand(t,e){return Math.random()*(e-t)+t}static randInt(t,e){return Math.floor(this.rand(t,e+1))}static clamp(t,e,i){return Math.min(Math.max(t,e),i)}static sat(t){return this.clamp(t,0,1)}static shuffle(t){for(let e=0;e<t.length;++e){let i=this.randInt(0,t.length-1);[t[e],t[i]]=[t[i],t[e]]}}static choice(t){return t[this.randInt(0,t.length-1)]}static isPowerOf2(t){return(t&t-1)==0}static max(t){return Math.max(...t)}static min(t){return Math.min(...t)}static avg(t){return t.reduce((e,i)=>e+i)/t.length}static step(t,e,i){return(i-t)/(e-t)}static radToDeg(t){return t/Math.PI*180}static degToRad(t){return def/180*Math.PI}};var Z=class{id;data;constructor(t,e={}){this.data=t,this.id=M.gl.createTexture(),M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texImage2D(M.gl.TEXTURE_2D,0,M.gl.RGBA,M.gl.RGBA,M.gl.UNSIGNED_BYTE,t),u.isPowerOf2(t.width)&&u.isPowerOf2(t.height)&&M.gl.generateMipmap(M.gl.TEXTURE_2D),M.gl.bindTexture(M.gl.TEXTURE_2D,null),this.setFilter(e.filter||M.gl.LINEAR),this.setWrap(e.wrap||M.gl.CLAMP_TO_EDGE)}setFilter(t){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_MIN_FILTER,t),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_MAG_FILTER,t==M.gl.NEAREST?M.gl.NEAREST:M.gl.LINEAR),M.gl.bindTexture(M.gl.TEXTURE_2D,null)}setWrap(t){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_WRAP_S,t),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_WRAP_T,t),M.gl.bindTexture(M.gl.TEXTURE_2D,null)}bind(){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id)}dispose(){M.gl.deleteTexture(this.id)}get width(){return this.data.width}get height(){return this.data.height}};var K=class{options;columns=10;charFrom=32;charTo=126;bitmap;texture;charWidth;charHeight;constructor(t){this.options=t,this.charWidth=t.fontSize*t.charRatio,this.charHeight=t.fontSize*1.2,this.bitmap=this.generateBitmap(),this.texture=new Z(this.bitmap,{filter:M.gl.LINEAR_MIPMAP_LINEAR})}generateBitmap(){let t=document.createElement("canvas"),e=this.charTo-this.charFrom+1,i=Math.floor(e/this.columns);t.width=2**Math.ceil(Math.log2(this.columns*this.charWidth)),t.height=2**Math.ceil(Math.log2(i*this.charHeight));let n=t.getContext("2d");n.textBaseline="middle",n.textAlign="center",n.fillStyle="white",n.font=`${this.options.fontSize}px ${this.options.fontFamily}`;for(let s=0;s<e;++s){let a=String.fromCharCode(s+this.charFrom),h=(s%this.columns+.5)*this.charWidth,o=(Math.floor(s/this.columns)+.5)*this.charHeight;n.fillText(a,h,o)}return t}getCharPosition(t){if(t<this.charFrom||t>this.charTo)return null;let e=t-this.charFrom;return[e%this.columns*this.charWidth,Math.floor(e/this.columns)*this.charHeight]}};var B=class{program;constructor(t,e){let i=this.compileShader(t,M.gl.VERTEX_SHADER),n=this.compileShader(e,M.gl.FRAGMENT_SHADER);if(this.program=M.gl.createProgram(),M.gl.attachShader(this.program,i),M.gl.attachShader(this.program,n),M.gl.linkProgram(this.program),!M.gl.getProgramParameter(this.program,M.gl.LINK_STATUS))throw console.log(M.gl.getProgramInfoLog(this.program)),new Error("program unable to link");this.attribs={positions:M.gl.getAttribLocation(this.program,"position"),normals:M.gl.getAttribLocation(this.program,"normal"),colors:M.gl.getAttribLocation(this.program,"color"),uvs:M.gl.getAttribLocation(this.program,"uv"),sizes:M.gl.getAttribLocation(this.program,"size")},this.uniforms=[{name:"projectionMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"projectionMatrix")},{name:"modelViewMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"modelViewMatrix")},{name:"modelMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"modelMatrix")},{name:"normalMatrix",type:"mat3",location:M.gl.getUniformLocation(this.program,"normalMatrix")},{name:"lightColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightColor")},{name:"lightDirection",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightDirection")},{name:"lightPosition",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightPosition")},{name:"cameraPosition",type:"vec3",location:M.gl.getUniformLocation(this.program,"cameraPosition")},{name:"pointMultiplier",type:"float",location:M.gl.getUniformLocation(this.program,"pointMultiplier")},{name:"ambientColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"ambientColor")},{name:"uvOffset",type:"vec2",location:M.gl.getUniformLocation(this.program,"uvOffset")},{name:"fogColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"fogColor")},{name:"fogNear",type:"float",location:M.gl.getUniformLocation(this.program,"fogNear")},{name:"fogFar",type:"float",location:M.gl.getUniformLocation(this.program,"fogFar")},{name:"fogTime",type:"float",location:M.gl.getUniformLocation(this.program,"fogTime")}]}activate(){M.gl.useProgram(this.program)}compileShader(t,e){let i=M.gl.createShader(e);if(M.gl.shaderSource(i,t),M.gl.compileShader(i),!M.gl.getShaderParameter(i,M.gl.COMPILE_STATUS))throw console.log(M.gl.getShaderInfoLog(i)),console.log(t),new Error("shader unable to compile");return i}dispose(){}static create(t,e={}){let i="precision mediump float;",n=x=>x.replace("{{USER}}",e.onCustomProcessPosition===void 0?"":e.onCustomProcessPosition),s=e.useFog===!0?"#define USE_FOG":"",a=Array.isArray(e.uniforms),h="",o="";a&&e.uniforms.forEach(x=>{let p=`	uniform ${x.type} ${x.name};
`;switch(x.shader){case"vert":h+=p;break;case"frag":o+=p;break}});let c,f;switch(t){case this.Type.SIMPLE:{c=[h,s,n(this.SIMPLE_VS)].join(`
`),f=[i,o,s,this.SIMPLE_FS].join(`
`);break}case this.Type.TEXTURE:{c=[h,s,n(this.TEXTURE_VS)].join(`
`),f=[i,o,s,this.TEXTURE_FS].join(`
`);break}case this.Type.PARTICLE:{c=[h,this.PARTICLE_VS].join(`
`),f=[i,o,this.PARTICLE_FS].join(`
`);break}default:throw new Error("Type not found: "+t)}let l=new B(c,f);if(a)for(let x of e.uniforms)l.uniforms.push({name:x.name,type:x.type,location:M.gl.getUniformLocation(l.program,x.name)});return l}},L=B;Y(L,"Type",Object.freeze({SIMPLE:"simple",TEXTURE:"texture",PARTICLE:"particle"})),Y(L,"PROC_POS_FUNC",`
    vec3 proc_pos(vec3 position) {
        {{USER}}
        return position;
    }
    `),Y(L,"FOG_VERT_PARAMS",`
    #ifdef USE_FOG
    varying vec3 vWorldPosition;
    #endif
    `),Y(L,"FOG_VERT",`
    #ifdef USE_FOG
    vWorldPosition = worldPosition.xyz;
    #endif
    `),Y(L,"FOG_FRAG_PARAMS",`
    #ifdef USE_FOG
    varying vec3 vWorldPosition;
    uniform vec3 fogColor;
    uniform float fogNear;
    uniform float fogFar;
    uniform float fogTime;
    #endif
    `),Y(L,"FOG_FRAG",`
    #ifdef USE_FOG
    vec3 fogDirection = normalize(vWorldPosition);
    float fogDepth = length(vWorldPosition);

    float fogFactor = smoothstep(fogNear, fogFar, fogDepth);
    fogFactor = clamp(fogFactor, 0.0, 1.0);

    gl_FragColor = mix( gl_FragColor, vec4(fogColor, fogAlpha), fogFactor);
    #endif
    `),Y(L,"SIMPLE_VS",`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    attribute vec3 position;
    attribute vec4 color;

    varying vec4 vColor;

    ${B.FOG_VERT_PARAMS}

    ${B.PROC_POS_FUNC}

    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(proc_pos(position), 1.0);
        gl_Position = projectionMatrix * worldPosition;
        vColor = color;
        ${B.FOG_VERT}
    }
    `),Y(L,"SIMPLE_FS",`
    varying vec4 vColor;
    uniform vec3 ambientColor;
    uniform vec3 cameraPosition;

    ${B.FOG_FRAG_PARAMS}

    void main(void) {
        gl_FragColor = vec4(vColor.rgb * ambientColor, vColor.a);
        float fogAlpha = 1.0;
        ${B.FOG_FRAG}
    }
    `),Y(L,"TEXTURE_VS",`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    attribute vec3 position;
    attribute vec4 color;
    attribute vec2 uv;

    varying vec4 vColor;
    varying vec2 vUv;
    
    ${B.FOG_VERT_PARAMS}

    ${B.PROC_POS_FUNC}

    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(proc_pos(position), 1.0);
        gl_Position = projectionMatrix * worldPosition;
        vColor = color;
        vUv = uv;
        ${B.FOG_VERT}
    }
    `),Y(L,"TEXTURE_FS",` 
    varying vec4 vColor;
    varying vec2 vUv;

    uniform sampler2D tex;
    uniform vec3 ambientColor;
    uniform vec2 uvOffset;
    uniform vec3 cameraPosition;

    ${B.FOG_FRAG_PARAMS}

    void main(void) {
        vec4 texColor = texture2D(tex, vUv + uvOffset);
        gl_FragColor = vec4(vColor.rgb * texColor.rgb * ambientColor, texColor.a * vColor.a);
        float fogAlpha = texColor.a;
        ${B.FOG_FRAG}
    }
    `),Y(L,"PARTICLE_VS",`
    attribute vec3 position;
    attribute vec4 color;
    attribute float size;
    
    uniform float pointMultiplier;
    uniform mat4 projectionMatrix;
    uniform mat4 modelViewMatrix;
    
    varying vec4 vColor;
    
    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * worldPosition;
        gl_PointSize = size * pointMultiplier / gl_Position.w;
        vColor = color;
    }
    `),Y(L,"PARTICLE_FS",`
    varying vec4 vColor;

    uniform sampler2D tex;
    uniform vec3 ambientColor;
    uniform vec3 cameraPosition;
    
    void main(void) {
        vec4 texColor = texture2D(tex, gl_PointCoord);
        gl_FragColor = vec4(vColor.rgb * texColor.rgb * ambientColor * texColor.a, texColor.a) * vColor.a;
    }
    `);var fr=class{canvas;gl;frameId=null;width;height;delta=0;fps=60;lastFrameTime;frameStart;frames;game;shaders=new Map;fonts=new Map;constructor(t){this.game=t,this.canvas=this.createCanvas(),this.canvas.width=this.width=innerWidth,this.canvas.height=this.height=innerHeight,this.gl=this.canvas.getContext("webgl")}onResume(){this.lastFrameTime=this.frameStart=performance.now(),this.frames=0,this.RAF()}createCanvas(){let t=document.createElement("canvas");return t.oncontextmenu=e=>{e.preventDefault(),e.stopPropagation()},document.body.appendChild(t),t}onResize(){this.canvas.width=this.width=innerWidth,this.canvas.height=this.height=innerHeight,this.game.resize(this.width,this.height)}onDrawFrame(){let t=performance.now();this.delta=(t-this.lastFrameTime)*.001,this.lastFrameTime=t,M.input.update(),this.game.render(this.delta),t-this.frameStart>=1e3&&(this.fps=this.frames,this.frames=0,this.frameStart=t),++this.frames}RAF(){this.frameId=requestAnimationFrame(()=>{this.RAF(),this.onDrawFrame()})}compileShaders(){this.shaders.set("simple",L.create(L.Type.SIMPLE)),this.shaders.set("texture",L.create(L.Type.TEXTURE)),this.shaders.set("particle",L.create(L.Type.PARTICLE))}generateFonts(){this.fonts.set("Consolas",new K({fontFamily:"Consolas",fontSize:48,charRatio:.6}))}getShader(t){return this.shaders.get(t)}getFont(t){return this.fonts.get(t)}};var ne={};G(ne,{Batch:()=>hr,Camera:()=>$,Drawable:()=>k,DrawableGroup:()=>Cr,Font:()=>K,Mesh:()=>U,OrthographicCamera:()=>Sr,Particle:()=>Lr,ParticleSystem:()=>Or,PerspectiveCamera:()=>Ar,Shader:()=>L,ShaderInstance:()=>j,Sprite:()=>br,TextDrawable:()=>Ir,Texture:()=>Z,meshes:()=>at});var ie={};G(ie,{glMatrix:()=>V,mat2:()=>Yr,mat2d:()=>Ur,mat3:()=>H,mat4:()=>b,quat:()=>J,quat2:()=>st,vec2:()=>W,vec3:()=>S,vec4:()=>Mr});var V={};G(V,{ARRAY_TYPE:()=>T,EPSILON:()=>y,RANDOM:()=>q,equals:()=>fe,setMatrixArrayType:()=>he,toRadian:()=>ce});var y=1e-6,T=typeof Float32Array<"u"?Float32Array:Array,q=Math.random;function he(r){T=r}var oe=Math.PI/180;function ce(r){return r*oe}function fe(r,t){return Math.abs(r-t)<=y*Math.max(1,Math.abs(r),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Yr={};G(Yr,{LDU:()=>Se,add:()=>be,adjoint:()=>ye,clone:()=>pe,copy:()=>xe,create:()=>le,determinant:()=>we,equals:()=>Le,exactEquals:()=>Ie,frob:()=>ze,fromRotation:()=>Ae,fromScaling:()=>Re,fromValues:()=>me,identity:()=>ve,invert:()=>ge,mul:()=>De,multiply:()=>pt,multiplyScalar:()=>Oe,multiplyScalarAndAdd:()=>Ce,rotate:()=>Ee,scale:()=>Pe,set:()=>Me,str:()=>Te,sub:()=>Fe,subtract:()=>xt,transpose:()=>de});function le(){var r=new T(4);return T!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r}function pe(r){var t=new T(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function xe(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function ve(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r}function me(r,t,e,i){var n=new T(4);return n[0]=r,n[1]=t,n[2]=e,n[3]=i,n}function Me(r,t,e,i,n){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function de(r,t){if(r===t){var e=t[1];r[1]=t[2],r[2]=e}else r[0]=t[0],r[1]=t[2],r[2]=t[1],r[3]=t[3];return r}function ge(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*s-n*i;return a?(a=1/a,r[0]=s*a,r[1]=-i*a,r[2]=-n*a,r[3]=e*a,r):null}function ye(r,t){var e=t[0];return r[0]=t[3],r[1]=-t[1],r[2]=-t[2],r[3]=e,r}function we(r){return r[0]*r[3]-r[2]*r[1]}function pt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],f=e[3];return r[0]=i*h+s*o,r[1]=n*h+a*o,r[2]=i*c+s*f,r[3]=n*c+a*f,r}function Ee(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o+s*h,r[1]=n*o+a*h,r[2]=i*-h+s*o,r[3]=n*-h+a*o,r}function Pe(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1];return r[0]=i*h,r[1]=n*h,r[2]=s*o,r[3]=a*o,r}function Ae(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=-e,r[3]=i,r}function Re(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=t[1],r}function Te(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function ze(r){return Math.hypot(r[0],r[1],r[2],r[3])}function Se(r,t,e,i){return r[2]=i[2]/i[0],e[0]=i[0],e[1]=i[1],e[3]=i[3]-r[2]*e[1],[r,t,e]}function be(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function xt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}function Ie(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]}function Le(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=t[0],h=t[1],o=t[2],c=t[3];return Math.abs(e-a)<=y*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(i-h)<=y*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=y*Math.max(1,Math.abs(s),Math.abs(c))}function Oe(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function Ce(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r}var De=pt,Fe=xt;var Ur={};G(Ur,{add:()=>Ze,clone:()=>_e,copy:()=>Ye,create:()=>Ne,determinant:()=>ue,equals:()=>ti,exactEquals:()=>ri,frob:()=>Qe,fromRotation:()=>ke,fromScaling:()=>We,fromTranslation:()=>He,fromValues:()=>qe,identity:()=>Ue,invert:()=>Ge,mul:()=>ei,multiply:()=>vt,multiplyScalar:()=>Ke,multiplyScalarAndAdd:()=>Je,rotate:()=>Be,scale:()=>Xe,set:()=>Ve,str:()=>$e,sub:()=>ii,subtract:()=>mt,translate:()=>je});function Ne(){var r=new T(6);return T!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r}function _e(r){var t=new T(6);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t}function Ye(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function Ue(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r}function qe(r,t,e,i,n,s){var a=new T(6);return a[0]=r,a[1]=t,a[2]=e,a[3]=i,a[4]=n,a[5]=s,a}function Ve(r,t,e,i,n,s,a){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r}function Ge(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=e*s-i*n;return o?(o=1/o,r[0]=s*o,r[1]=-i*o,r[2]=-n*o,r[3]=e*o,r[4]=(n*h-s*a)*o,r[5]=(i*a-e*h)*o,r):null}function ue(r){return r[0]*r[3]-r[1]*r[2]}function vt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=e[0],f=e[1],l=e[2],x=e[3],p=e[4],v=e[5];return r[0]=i*c+s*f,r[1]=n*c+a*f,r[2]=i*l+s*x,r[3]=n*l+a*x,r[4]=i*p+s*v+h,r[5]=n*p+a*v+o,r}function Be(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=Math.sin(e),f=Math.cos(e);return r[0]=i*f+s*c,r[1]=n*f+a*c,r[2]=i*-c+s*f,r[3]=n*-c+a*f,r[4]=h,r[5]=o,r}function Xe(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=e[0],f=e[1];return r[0]=i*c,r[1]=n*c,r[2]=s*f,r[3]=a*f,r[4]=h,r[5]=o,r}function je(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=e[0],f=e[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=i*c+s*f+h,r[5]=n*c+a*f+o,r}function ke(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=-e,r[3]=i,r[4]=0,r[5]=0,r}function We(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=t[1],r[4]=0,r[5]=0,r}function He(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=t[0],r[5]=t[1],r}function $e(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"}function Qe(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)}function Ze(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r}function mt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r}function Ke(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r}function Je(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r[4]=t[4]+e[4]*i,r[5]=t[5]+e[5]*i,r}function ri(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]}function ti(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=t[0],c=t[1],f=t[2],l=t[3],x=t[4],p=t[5];return Math.abs(e-o)<=y*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=y*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-l)<=y*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(a-x)<=y*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(h-p)<=y*Math.max(1,Math.abs(h),Math.abs(p))}var ei=vt,ii=mt;var H={};G(H,{add:()=>zi,adjoint:()=>pi,clone:()=>si,copy:()=>ai,create:()=>qr,determinant:()=>xi,equals:()=>Li,exactEquals:()=>Ii,frob:()=>Ti,fromMat2d:()=>wi,fromMat4:()=>ni,fromQuat:()=>Ei,fromRotation:()=>gi,fromScaling:()=>yi,fromTranslation:()=>di,fromValues:()=>hi,identity:()=>ci,invert:()=>li,mul:()=>Oi,multiply:()=>Mt,multiplyScalar:()=>Si,multiplyScalarAndAdd:()=>bi,normalFromMat4:()=>Pi,projection:()=>Ai,rotate:()=>mi,scale:()=>Mi,set:()=>oi,str:()=>Ri,sub:()=>Ci,subtract:()=>dt,translate:()=>vi,transpose:()=>fi});function qr(){var r=new T(9);return T!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ni(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r}function si(r){var t=new T(9);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t}function ai(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function hi(r,t,e,i,n,s,a,h,o){var c=new T(9);return c[0]=r,c[1]=t,c[2]=e,c[3]=i,c[4]=n,c[5]=s,c[6]=a,c[7]=h,c[8]=o,c}function oi(r,t,e,i,n,s,a,h,o,c){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r[8]=c,r}function ci(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function fi(r,t){if(r===t){var e=t[1],i=t[2],n=t[5];r[1]=t[3],r[2]=t[6],r[3]=e,r[5]=t[7],r[6]=i,r[7]=n}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r}function li(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],f=t[8],l=f*a-h*c,x=-f*s+h*o,p=c*s-a*o,v=e*l+i*x+n*p;return v?(v=1/v,r[0]=l*v,r[1]=(-f*i+n*c)*v,r[2]=(h*i-n*a)*v,r[3]=x*v,r[4]=(f*e-n*o)*v,r[5]=(-h*e+n*s)*v,r[6]=p*v,r[7]=(-c*e+i*o)*v,r[8]=(a*e-i*s)*v,r):null}function pi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],f=t[8];return r[0]=a*f-h*c,r[1]=n*c-i*f,r[2]=i*h-n*a,r[3]=h*o-s*f,r[4]=e*f-n*o,r[5]=n*s-e*h,r[6]=s*c-a*o,r[7]=i*o-e*c,r[8]=e*a-i*s,r}function xi(r){var t=r[0],e=r[1],i=r[2],n=r[3],s=r[4],a=r[5],h=r[6],o=r[7],c=r[8];return t*(c*s-a*o)+e*(-c*n+a*h)+i*(o*n-s*h)}function Mt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=t[8],x=e[0],p=e[1],v=e[2],d=e[3],m=e[4],g=e[5],w=e[6],E=e[7],P=e[8];return r[0]=x*i+p*a+v*c,r[1]=x*n+p*h+v*f,r[2]=x*s+p*o+v*l,r[3]=d*i+m*a+g*c,r[4]=d*n+m*h+g*f,r[5]=d*s+m*o+g*l,r[6]=w*i+E*a+P*c,r[7]=w*n+E*h+P*f,r[8]=w*s+E*o+P*l,r}function vi(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=t[8],x=e[0],p=e[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=h,r[5]=o,r[6]=x*i+p*a+c,r[7]=x*n+p*h+f,r[8]=x*s+p*o+l,r}function mi(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=t[8],x=Math.sin(e),p=Math.cos(e);return r[0]=p*i+x*a,r[1]=p*n+x*h,r[2]=p*s+x*o,r[3]=p*a-x*i,r[4]=p*h-x*n,r[5]=p*o-x*s,r[6]=c,r[7]=f,r[8]=l,r}function Mi(r,t,e){var i=e[0],n=e[1];return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=n*t[3],r[4]=n*t[4],r[5]=n*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function di(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r}function gi(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=0,r[3]=-e,r[4]=i,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function yi(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=t[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function wi(r,t){return r[0]=t[0],r[1]=t[1],r[2]=0,r[3]=t[2],r[4]=t[3],r[5]=0,r[6]=t[4],r[7]=t[5],r[8]=1,r}function Ei(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e+e,h=i+i,o=n+n,c=e*a,f=i*a,l=i*h,x=n*a,p=n*h,v=n*o,d=s*a,m=s*h,g=s*o;return r[0]=1-l-v,r[3]=f-g,r[6]=x+m,r[1]=f+g,r[4]=1-c-v,r[7]=p-d,r[2]=x-m,r[5]=p+d,r[8]=1-c-l,r}function Pi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],f=t[8],l=t[9],x=t[10],p=t[11],v=t[12],d=t[13],m=t[14],g=t[15],w=e*h-i*a,E=e*o-n*a,P=e*c-s*a,R=i*o-n*h,A=i*c-s*h,F=n*c-s*o,O=f*d-l*v,C=f*m-x*v,I=f*g-p*v,N=l*m-x*d,D=l*g-p*d,_=x*g-p*m,z=w*_-E*D+P*N+R*I-A*C+F*O;return z?(z=1/z,r[0]=(h*_-o*D+c*N)*z,r[1]=(o*I-a*_-c*C)*z,r[2]=(a*D-h*I+c*O)*z,r[3]=(n*D-i*_-s*N)*z,r[4]=(e*_-n*I+s*C)*z,r[5]=(i*I-e*D-s*O)*z,r[6]=(d*F-m*A+g*R)*z,r[7]=(m*P-v*F-g*E)*z,r[8]=(v*A-d*P+g*w)*z,r):null}function Ai(r,t,e){return r[0]=2/t,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/e,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function Ri(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function Ti(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function zi(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r[8]=t[8]+e[8],r}function dt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r[6]=t[6]-e[6],r[7]=t[7]-e[7],r[8]=t[8]-e[8],r}function Si(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*e,r}function bi(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r[4]=t[4]+e[4]*i,r[5]=t[5]+e[5]*i,r[6]=t[6]+e[6]*i,r[7]=t[7]+e[7]*i,r[8]=t[8]+e[8]*i,r}function Ii(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]}function Li(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],f=r[8],l=t[0],x=t[1],p=t[2],v=t[3],d=t[4],m=t[5],g=t[6],w=t[7],E=t[8];return Math.abs(e-l)<=y*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(i-x)<=y*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(n-p)<=y*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-v)<=y*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-d)<=y*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(h-m)<=y*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(o-g)<=y*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(c-w)<=y*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-E)<=y*Math.max(1,Math.abs(f),Math.abs(E))}var Oi=Mt,Ci=dt;var b={};G(b,{add:()=>mn,adjoint:()=>Vi,clone:()=>Fi,copy:()=>Ni,create:()=>Di,determinant:()=>Gi,equals:()=>yn,exactEquals:()=>gn,frob:()=>vn,fromQuat:()=>nn,fromQuat2:()=>rn,fromRotation:()=>Qi,fromRotationTranslation:()=>wt,fromRotationTranslationScale:()=>tn,fromRotationTranslationScaleOrigin:()=>en,fromScaling:()=>$i,fromTranslation:()=>Hi,fromValues:()=>_i,fromXRotation:()=>Zi,fromYRotation:()=>Ki,fromZRotation:()=>Ji,frustum:()=>sn,getRotation:()=>Gr,getScaling:()=>Et,getTranslation:()=>Vr,identity:()=>gt,invert:()=>qi,lookAt:()=>ln,mul:()=>wn,multiply:()=>yt,multiplyScalar:()=>Mn,multiplyScalarAndAdd:()=>dn,ortho:()=>cn,orthoNO:()=>At,orthoZO:()=>fn,perspective:()=>an,perspectiveFromFieldOfView:()=>on,perspectiveNO:()=>Pt,perspectiveZO:()=>hn,rotate:()=>Xi,rotateX:()=>ji,rotateY:()=>ki,rotateZ:()=>Wi,scale:()=>Bi,set:()=>Yi,str:()=>xn,sub:()=>En,subtract:()=>Rt,targetTo:()=>pn,translate:()=>ui,transpose:()=>Ui});function Di(){var r=new T(16);return T!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Fi(r){var t=new T(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function Ni(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function _i(r,t,e,i,n,s,a,h,o,c,f,l,x,p,v,d){var m=new T(16);return m[0]=r,m[1]=t,m[2]=e,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=h,m[8]=o,m[9]=c,m[10]=f,m[11]=l,m[12]=x,m[13]=p,m[14]=v,m[15]=d,m}function Yi(r,t,e,i,n,s,a,h,o,c,f,l,x,p,v,d,m){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r[8]=c,r[9]=f,r[10]=l,r[11]=x,r[12]=p,r[13]=v,r[14]=d,r[15]=m,r}function gt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ui(r,t){if(r===t){var e=t[1],i=t[2],n=t[3],s=t[6],a=t[7],h=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=i,r[9]=s,r[11]=t[14],r[12]=n,r[13]=a,r[14]=h}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function qi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],f=t[8],l=t[9],x=t[10],p=t[11],v=t[12],d=t[13],m=t[14],g=t[15],w=e*h-i*a,E=e*o-n*a,P=e*c-s*a,R=i*o-n*h,A=i*c-s*h,F=n*c-s*o,O=f*d-l*v,C=f*m-x*v,I=f*g-p*v,N=l*m-x*d,D=l*g-p*d,_=x*g-p*m,z=w*_-E*D+P*N+R*I-A*C+F*O;return z?(z=1/z,r[0]=(h*_-o*D+c*N)*z,r[1]=(n*D-i*_-s*N)*z,r[2]=(d*F-m*A+g*R)*z,r[3]=(x*A-l*F-p*R)*z,r[4]=(o*I-a*_-c*C)*z,r[5]=(e*_-n*I+s*C)*z,r[6]=(m*P-v*F-g*E)*z,r[7]=(f*F-x*P+p*E)*z,r[8]=(a*D-h*I+c*O)*z,r[9]=(i*I-e*D-s*O)*z,r[10]=(v*A-d*P+g*w)*z,r[11]=(l*P-f*A-p*w)*z,r[12]=(h*C-a*N-o*O)*z,r[13]=(e*N-i*C+n*O)*z,r[14]=(d*E-v*R-m*w)*z,r[15]=(f*R-l*E+x*w)*z,r):null}function Vi(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],h=t[5],o=t[6],c=t[7],f=t[8],l=t[9],x=t[10],p=t[11],v=t[12],d=t[13],m=t[14],g=t[15];return r[0]=h*(x*g-p*m)-l*(o*g-c*m)+d*(o*p-c*x),r[1]=-(i*(x*g-p*m)-l*(n*g-s*m)+d*(n*p-s*x)),r[2]=i*(o*g-c*m)-h*(n*g-s*m)+d*(n*c-s*o),r[3]=-(i*(o*p-c*x)-h*(n*p-s*x)+l*(n*c-s*o)),r[4]=-(a*(x*g-p*m)-f*(o*g-c*m)+v*(o*p-c*x)),r[5]=e*(x*g-p*m)-f*(n*g-s*m)+v*(n*p-s*x),r[6]=-(e*(o*g-c*m)-a*(n*g-s*m)+v*(n*c-s*o)),r[7]=e*(o*p-c*x)-a*(n*p-s*x)+f*(n*c-s*o),r[8]=a*(l*g-p*d)-f*(h*g-c*d)+v*(h*p-c*l),r[9]=-(e*(l*g-p*d)-f*(i*g-s*d)+v*(i*p-s*l)),r[10]=e*(h*g-c*d)-a*(i*g-s*d)+v*(i*c-s*h),r[11]=-(e*(h*p-c*l)-a*(i*p-s*l)+f*(i*c-s*h)),r[12]=-(a*(l*m-x*d)-f*(h*m-o*d)+v*(h*x-o*l)),r[13]=e*(l*m-x*d)-f*(i*m-n*d)+v*(i*x-n*l),r[14]=-(e*(h*m-o*d)-a*(i*m-n*d)+v*(i*o-n*h)),r[15]=e*(h*x-o*l)-a*(i*x-n*l)+f*(i*o-n*h),r}function Gi(r){var t=r[0],e=r[1],i=r[2],n=r[3],s=r[4],a=r[5],h=r[6],o=r[7],c=r[8],f=r[9],l=r[10],x=r[11],p=r[12],v=r[13],d=r[14],m=r[15],g=t*a-e*s,w=t*h-i*s,E=t*o-n*s,P=e*h-i*a,R=e*o-n*a,A=i*o-n*h,F=c*v-f*p,O=c*d-l*p,C=c*m-x*p,I=f*d-l*v,N=f*m-x*v,D=l*m-x*d;return g*D-w*N+E*I+P*C-R*O+A*F}function yt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=t[8],x=t[9],p=t[10],v=t[11],d=t[12],m=t[13],g=t[14],w=t[15],E=e[0],P=e[1],R=e[2],A=e[3];return r[0]=E*i+P*h+R*l+A*d,r[1]=E*n+P*o+R*x+A*m,r[2]=E*s+P*c+R*p+A*g,r[3]=E*a+P*f+R*v+A*w,E=e[4],P=e[5],R=e[6],A=e[7],r[4]=E*i+P*h+R*l+A*d,r[5]=E*n+P*o+R*x+A*m,r[6]=E*s+P*c+R*p+A*g,r[7]=E*a+P*f+R*v+A*w,E=e[8],P=e[9],R=e[10],A=e[11],r[8]=E*i+P*h+R*l+A*d,r[9]=E*n+P*o+R*x+A*m,r[10]=E*s+P*c+R*p+A*g,r[11]=E*a+P*f+R*v+A*w,E=e[12],P=e[13],R=e[14],A=e[15],r[12]=E*i+P*h+R*l+A*d,r[13]=E*n+P*o+R*x+A*m,r[14]=E*s+P*c+R*p+A*g,r[15]=E*a+P*f+R*v+A*w,r}function ui(r,t,e){var i=e[0],n=e[1],s=e[2],a,h,o,c,f,l,x,p,v,d,m,g;return t===r?(r[12]=t[0]*i+t[4]*n+t[8]*s+t[12],r[13]=t[1]*i+t[5]*n+t[9]*s+t[13],r[14]=t[2]*i+t[6]*n+t[10]*s+t[14],r[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],h=t[1],o=t[2],c=t[3],f=t[4],l=t[5],x=t[6],p=t[7],v=t[8],d=t[9],m=t[10],g=t[11],r[0]=a,r[1]=h,r[2]=o,r[3]=c,r[4]=f,r[5]=l,r[6]=x,r[7]=p,r[8]=v,r[9]=d,r[10]=m,r[11]=g,r[12]=a*i+f*n+v*s+t[12],r[13]=h*i+l*n+d*s+t[13],r[14]=o*i+x*n+m*s+t[14],r[15]=c*i+p*n+g*s+t[15]),r}function Bi(r,t,e){var i=e[0],n=e[1],s=e[2];return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Xi(r,t,e,i){var n=i[0],s=i[1],a=i[2],h=Math.hypot(n,s,a),o,c,f,l,x,p,v,d,m,g,w,E,P,R,A,F,O,C,I,N,D,_,z,X;return h<y?null:(h=1/h,n*=h,s*=h,a*=h,o=Math.sin(e),c=Math.cos(e),f=1-c,l=t[0],x=t[1],p=t[2],v=t[3],d=t[4],m=t[5],g=t[6],w=t[7],E=t[8],P=t[9],R=t[10],A=t[11],F=n*n*f+c,O=s*n*f+a*o,C=a*n*f-s*o,I=n*s*f-a*o,N=s*s*f+c,D=a*s*f+n*o,_=n*a*f+s*o,z=s*a*f-n*o,X=a*a*f+c,r[0]=l*F+d*O+E*C,r[1]=x*F+m*O+P*C,r[2]=p*F+g*O+R*C,r[3]=v*F+w*O+A*C,r[4]=l*I+d*N+E*D,r[5]=x*I+m*N+P*D,r[6]=p*I+g*N+R*D,r[7]=v*I+w*N+A*D,r[8]=l*_+d*z+E*X,r[9]=x*_+m*z+P*X,r[10]=p*_+g*z+R*X,r[11]=v*_+w*z+A*X,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function ji(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[4],a=t[5],h=t[6],o=t[7],c=t[8],f=t[9],l=t[10],x=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*n+c*i,r[5]=a*n+f*i,r[6]=h*n+l*i,r[7]=o*n+x*i,r[8]=c*n-s*i,r[9]=f*n-a*i,r[10]=l*n-h*i,r[11]=x*n-o*i,r}function ki(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[0],a=t[1],h=t[2],o=t[3],c=t[8],f=t[9],l=t[10],x=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*n-c*i,r[1]=a*n-f*i,r[2]=h*n-l*i,r[3]=o*n-x*i,r[8]=s*i+c*n,r[9]=a*i+f*n,r[10]=h*i+l*n,r[11]=o*i+x*n,r}function Wi(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[0],a=t[1],h=t[2],o=t[3],c=t[4],f=t[5],l=t[6],x=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*n+c*i,r[1]=a*n+f*i,r[2]=h*n+l*i,r[3]=o*n+x*i,r[4]=c*n-s*i,r[5]=f*n-a*i,r[6]=l*n-h*i,r[7]=x*n-o*i,r}function Hi(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function $i(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Qi(r,t,e){var i=e[0],n=e[1],s=e[2],a=Math.hypot(i,n,s),h,o,c;return a<y?null:(a=1/a,i*=a,n*=a,s*=a,h=Math.sin(t),o=Math.cos(t),c=1-o,r[0]=i*i*c+o,r[1]=n*i*c+s*h,r[2]=s*i*c-n*h,r[3]=0,r[4]=i*n*c-s*h,r[5]=n*n*c+o,r[6]=s*n*c+i*h,r[7]=0,r[8]=i*s*c+n*h,r[9]=n*s*c-i*h,r[10]=s*s*c+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Zi(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=e,r[7]=0,r[8]=0,r[9]=-e,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ki(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=0,r[2]=-e,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=e,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ji(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=0,r[3]=0,r[4]=-e,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function wt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=i+i,o=n+n,c=s+s,f=i*h,l=i*o,x=i*c,p=n*o,v=n*c,d=s*c,m=a*h,g=a*o,w=a*c;return r[0]=1-(p+d),r[1]=l+w,r[2]=x-g,r[3]=0,r[4]=l-w,r[5]=1-(f+d),r[6]=v+m,r[7]=0,r[8]=x+g,r[9]=v-m,r[10]=1-(f+p),r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function rn(r,t){var e=new T(3),i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=i*i+n*n+s*s+a*a;return l>0?(e[0]=(h*a+f*i+o*s-c*n)*2/l,e[1]=(o*a+f*n+c*i-h*s)*2/l,e[2]=(c*a+f*s+h*n-o*i)*2/l):(e[0]=(h*a+f*i+o*s-c*n)*2,e[1]=(o*a+f*n+c*i-h*s)*2,e[2]=(c*a+f*s+h*n-o*i)*2),wt(r,t,e),r}function Vr(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function Et(r,t){var e=t[0],i=t[1],n=t[2],s=t[4],a=t[5],h=t[6],o=t[8],c=t[9],f=t[10];return r[0]=Math.hypot(e,i,n),r[1]=Math.hypot(s,a,h),r[2]=Math.hypot(o,c,f),r}function Gr(r,t){var e=new T(3);Et(e,t);var i=1/e[0],n=1/e[1],s=1/e[2],a=t[0]*i,h=t[1]*n,o=t[2]*s,c=t[4]*i,f=t[5]*n,l=t[6]*s,x=t[8]*i,p=t[9]*n,v=t[10]*s,d=a+f+v,m=0;return d>0?(m=Math.sqrt(d+1)*2,r[3]=.25*m,r[0]=(l-p)/m,r[1]=(x-o)/m,r[2]=(h-c)/m):a>f&&a>v?(m=Math.sqrt(1+a-f-v)*2,r[3]=(l-p)/m,r[0]=.25*m,r[1]=(h+c)/m,r[2]=(x+o)/m):f>v?(m=Math.sqrt(1+f-a-v)*2,r[3]=(x-o)/m,r[0]=(h+c)/m,r[1]=.25*m,r[2]=(l+p)/m):(m=Math.sqrt(1+v-a-f)*2,r[3]=(h-c)/m,r[0]=(x+o)/m,r[1]=(l+p)/m,r[2]=.25*m),r}function tn(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=t[3],o=n+n,c=s+s,f=a+a,l=n*o,x=n*c,p=n*f,v=s*c,d=s*f,m=a*f,g=h*o,w=h*c,E=h*f,P=i[0],R=i[1],A=i[2];return r[0]=(1-(v+m))*P,r[1]=(x+E)*P,r[2]=(p-w)*P,r[3]=0,r[4]=(x-E)*R,r[5]=(1-(l+m))*R,r[6]=(d+g)*R,r[7]=0,r[8]=(p+w)*A,r[9]=(d-g)*A,r[10]=(1-(l+v))*A,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function en(r,t,e,i,n){var s=t[0],a=t[1],h=t[2],o=t[3],c=s+s,f=a+a,l=h+h,x=s*c,p=s*f,v=s*l,d=a*f,m=a*l,g=h*l,w=o*c,E=o*f,P=o*l,R=i[0],A=i[1],F=i[2],O=n[0],C=n[1],I=n[2],N=(1-(d+g))*R,D=(p+P)*R,_=(v-E)*R,z=(p-P)*A,X=(1-(x+g))*A,ir=(m+w)*A,nr=(v+E)*F,ct=(m-w)*F,ft=(1-(x+d))*F;return r[0]=N,r[1]=D,r[2]=_,r[3]=0,r[4]=z,r[5]=X,r[6]=ir,r[7]=0,r[8]=nr,r[9]=ct,r[10]=ft,r[11]=0,r[12]=e[0]+O-(N*O+z*C+nr*I),r[13]=e[1]+C-(D*O+X*C+ct*I),r[14]=e[2]+I-(_*O+ir*C+ft*I),r[15]=1,r}function nn(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e+e,h=i+i,o=n+n,c=e*a,f=i*a,l=i*h,x=n*a,p=n*h,v=n*o,d=s*a,m=s*h,g=s*o;return r[0]=1-l-v,r[1]=f+g,r[2]=x-m,r[3]=0,r[4]=f-g,r[5]=1-c-v,r[6]=p+d,r[7]=0,r[8]=x+m,r[9]=p-d,r[10]=1-c-l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function sn(r,t,e,i,n,s,a){var h=1/(e-t),o=1/(n-i),c=1/(s-a);return r[0]=s*2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*o,r[6]=0,r[7]=0,r[8]=(e+t)*h,r[9]=(n+i)*o,r[10]=(a+s)*c,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*c,r[15]=0,r}function Pt(r,t,e,i,n){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=(n+i)*a,r[14]=2*n*i*a):(r[10]=-1,r[14]=-2*i),r}var an=Pt;function hn(r,t,e,i,n){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=n*a,r[14]=n*i*a):(r[10]=-1,r[14]=-i),r}function on(r,t,e,i){var n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),h=Math.tan(t.rightDegrees*Math.PI/180),o=2/(a+h),c=2/(n+s);return r[0]=o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=-((a-h)*o*.5),r[9]=(n-s)*c*.5,r[10]=i/(e-i),r[11]=-1,r[12]=0,r[13]=0,r[14]=i*e/(e-i),r[15]=0,r}function At(r,t,e,i,n,s,a){var h=1/(t-e),o=1/(i-n),c=1/(s-a);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(t+e)*h,r[13]=(n+i)*o,r[14]=(a+s)*c,r[15]=1,r}var cn=At;function fn(r,t,e,i,n,s,a){var h=1/(t-e),o=1/(i-n),c=1/(s-a);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=c,r[11]=0,r[12]=(t+e)*h,r[13]=(n+i)*o,r[14]=s*c,r[15]=1,r}function ln(r,t,e,i){var n,s,a,h,o,c,f,l,x,p,v=t[0],d=t[1],m=t[2],g=i[0],w=i[1],E=i[2],P=e[0],R=e[1],A=e[2];return Math.abs(v-P)<y&&Math.abs(d-R)<y&&Math.abs(m-A)<y?gt(r):(f=v-P,l=d-R,x=m-A,p=1/Math.hypot(f,l,x),f*=p,l*=p,x*=p,n=w*x-E*l,s=E*f-g*x,a=g*l-w*f,p=Math.hypot(n,s,a),p?(p=1/p,n*=p,s*=p,a*=p):(n=0,s=0,a=0),h=l*a-x*s,o=x*n-f*a,c=f*s-l*n,p=Math.hypot(h,o,c),p?(p=1/p,h*=p,o*=p,c*=p):(h=0,o=0,c=0),r[0]=n,r[1]=h,r[2]=f,r[3]=0,r[4]=s,r[5]=o,r[6]=l,r[7]=0,r[8]=a,r[9]=c,r[10]=x,r[11]=0,r[12]=-(n*v+s*d+a*m),r[13]=-(h*v+o*d+c*m),r[14]=-(f*v+l*d+x*m),r[15]=1,r)}function pn(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=i[0],o=i[1],c=i[2],f=n-e[0],l=s-e[1],x=a-e[2],p=f*f+l*l+x*x;p>0&&(p=1/Math.sqrt(p),f*=p,l*=p,x*=p);var v=o*x-c*l,d=c*f-h*x,m=h*l-o*f;return p=v*v+d*d+m*m,p>0&&(p=1/Math.sqrt(p),v*=p,d*=p,m*=p),r[0]=v,r[1]=d,r[2]=m,r[3]=0,r[4]=l*m-x*d,r[5]=x*v-f*m,r[6]=f*d-l*v,r[7]=0,r[8]=f,r[9]=l,r[10]=x,r[11]=0,r[12]=n,r[13]=s,r[14]=a,r[15]=1,r}function xn(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function vn(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function mn(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r[8]=t[8]+e[8],r[9]=t[9]+e[9],r[10]=t[10]+e[10],r[11]=t[11]+e[11],r[12]=t[12]+e[12],r[13]=t[13]+e[13],r[14]=t[14]+e[14],r[15]=t[15]+e[15],r}function Rt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r[6]=t[6]-e[6],r[7]=t[7]-e[7],r[8]=t[8]-e[8],r[9]=t[9]-e[9],r[10]=t[10]-e[10],r[11]=t[11]-e[11],r[12]=t[12]-e[12],r[13]=t[13]-e[13],r[14]=t[14]-e[14],r[15]=t[15]-e[15],r}function Mn(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*e,r[9]=t[9]*e,r[10]=t[10]*e,r[11]=t[11]*e,r[12]=t[12]*e,r[13]=t[13]*e,r[14]=t[14]*e,r[15]=t[15]*e,r}function dn(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r[4]=t[4]+e[4]*i,r[5]=t[5]+e[5]*i,r[6]=t[6]+e[6]*i,r[7]=t[7]+e[7]*i,r[8]=t[8]+e[8]*i,r[9]=t[9]+e[9]*i,r[10]=t[10]+e[10]*i,r[11]=t[11]+e[11]*i,r[12]=t[12]+e[12]*i,r[13]=t[13]+e[13]*i,r[14]=t[14]+e[14]*i,r[15]=t[15]+e[15]*i,r}function gn(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]}function yn(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],f=r[8],l=r[9],x=r[10],p=r[11],v=r[12],d=r[13],m=r[14],g=r[15],w=t[0],E=t[1],P=t[2],R=t[3],A=t[4],F=t[5],O=t[6],C=t[7],I=t[8],N=t[9],D=t[10],_=t[11],z=t[12],X=t[13],ir=t[14],nr=t[15];return Math.abs(e-w)<=y*Math.max(1,Math.abs(e),Math.abs(w))&&Math.abs(i-E)<=y*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(n-P)<=y*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(s-R)<=y*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(a-A)<=y*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(h-F)<=y*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(o-O)<=y*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(c-C)<=y*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(f-I)<=y*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(l-N)<=y*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(x-D)<=y*Math.max(1,Math.abs(x),Math.abs(D))&&Math.abs(p-_)<=y*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(v-z)<=y*Math.max(1,Math.abs(v),Math.abs(z))&&Math.abs(d-X)<=y*Math.max(1,Math.abs(d),Math.abs(X))&&Math.abs(m-ir)<=y*Math.max(1,Math.abs(m),Math.abs(ir))&&Math.abs(g-nr)<=y*Math.max(1,Math.abs(g),Math.abs(nr))}var wn=yt,En=Rt;var J={};G(J,{add:()=>Us,calculateW:()=>bs,clone:()=>Ns,conjugate:()=>Cs,copy:()=>gr,create:()=>ar,dot:()=>yr,equals:()=>Xs,exactEquals:()=>Bs,exp:()=>Vt,fromEuler:()=>Ds,fromMat3:()=>ut,fromValues:()=>_s,getAngle:()=>Ss,getAxisAngle:()=>zs,identity:()=>Ts,invert:()=>Os,len:()=>Gs,length:()=>wr,lerp:()=>Vs,ln:()=>Gt,mul:()=>qs,multiply:()=>qt,normalize:()=>nt,pow:()=>Is,random:()=>Ls,rotateX:()=>tt,rotateY:()=>et,rotateZ:()=>it,rotationTo:()=>js,scale:()=>Bt,set:()=>Ys,setAxes:()=>Ws,setAxisAngle:()=>Ut,slerp:()=>dr,sqlerp:()=>ks,sqrLen:()=>us,squaredLength:()=>Er,str:()=>Fs});var S={};G(S,{add:()=>Tn,angle:()=>jn,bezier:()=>Yn,ceil:()=>zn,clone:()=>Pn,copy:()=>An,create:()=>lr,cross:()=>sr,dist:()=>Jn,distance:()=>It,div:()=>Kn,divide:()=>bt,dot:()=>xr,equals:()=>$n,exactEquals:()=>Hn,floor:()=>Sn,forEach:()=>es,fromValues:()=>pr,hermite:()=>_n,inverse:()=>Fn,len:()=>Br,length:()=>Tt,lerp:()=>Nn,max:()=>In,min:()=>bn,mul:()=>Zn,multiply:()=>St,negate:()=>Dn,normalize:()=>ur,random:()=>Un,rotateX:()=>un,rotateY:()=>Bn,rotateZ:()=>Xn,round:()=>Ln,scale:()=>On,scaleAndAdd:()=>Cn,set:()=>Rn,sqrDist:()=>rs,sqrLen:()=>ts,squaredDistance:()=>Lt,squaredLength:()=>Ot,str:()=>Wn,sub:()=>Qn,subtract:()=>zt,transformMat3:()=>Vn,transformMat4:()=>qn,transformQuat:()=>Gn,zero:()=>kn});function lr(){var r=new T(3);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Pn(r){var t=new T(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function Tt(r){var t=r[0],e=r[1],i=r[2];return Math.hypot(t,e,i)}function pr(r,t,e){var i=new T(3);return i[0]=r,i[1]=t,i[2]=e,i}function An(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function Rn(r,t,e,i){return r[0]=t,r[1]=e,r[2]=i,r}function Tn(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function zt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function St(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function bt(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function zn(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function Sn(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function bn(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function In(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function Ln(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function On(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function Cn(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r}function It(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2];return Math.hypot(e,i,n)}function Lt(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2];return e*e+i*i+n*n}function Ot(r){var t=r[0],e=r[1],i=r[2];return t*t+e*e+i*i}function Dn(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function Fn(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function ur(r,t){var e=t[0],i=t[1],n=t[2],s=e*e+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function xr(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function sr(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[0],h=e[1],o=e[2];return r[0]=n*o-s*h,r[1]=s*a-i*o,r[2]=i*h-n*a,r}function Nn(r,t,e,i){var n=t[0],s=t[1],a=t[2];return r[0]=n+i*(e[0]-n),r[1]=s+i*(e[1]-s),r[2]=a+i*(e[2]-a),r}function _n(r,t,e,i,n,s){var a=s*s,h=a*(2*s-3)+1,o=a*(s-2)+s,c=a*(s-1),f=a*(3-2*s);return r[0]=t[0]*h+e[0]*o+i[0]*c+n[0]*f,r[1]=t[1]*h+e[1]*o+i[1]*c+n[1]*f,r[2]=t[2]*h+e[2]*o+i[2]*c+n[2]*f,r}function Yn(r,t,e,i,n,s){var a=1-s,h=a*a,o=s*s,c=h*a,f=3*s*h,l=3*o*a,x=o*s;return r[0]=t[0]*c+e[0]*f+i[0]*l+n[0]*x,r[1]=t[1]*c+e[1]*f+i[1]*l+n[1]*x,r[2]=t[2]*c+e[2]*f+i[2]*l+n[2]*x,r}function Un(r,t){t=t||1;var e=q()*2*Math.PI,i=q()*2-1,n=Math.sqrt(1-i*i)*t;return r[0]=Math.cos(e)*n,r[1]=Math.sin(e)*n,r[2]=i*t,r}function qn(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[3]*i+e[7]*n+e[11]*s+e[15];return a=a||1,r[0]=(e[0]*i+e[4]*n+e[8]*s+e[12])/a,r[1]=(e[1]*i+e[5]*n+e[9]*s+e[13])/a,r[2]=(e[2]*i+e[6]*n+e[10]*s+e[14])/a,r}function Vn(r,t,e){var i=t[0],n=t[1],s=t[2];return r[0]=i*e[0]+n*e[3]+s*e[6],r[1]=i*e[1]+n*e[4]+s*e[7],r[2]=i*e[2]+n*e[5]+s*e[8],r}function Gn(r,t,e){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],f=n*c-s*o,l=s*h-i*c,x=i*o-n*h,p=n*x-s*l,v=s*f-i*x,d=i*l-n*f,m=a*2;return f*=m,l*=m,x*=m,p*=2,v*=2,d*=2,r[0]=h+f+p,r[1]=o+l+v,r[2]=c+x+d,r}function un(r,t,e,i){var n=[],s=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function Bn(r,t,e,i){var n=[],s=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function Xn(r,t,e,i){var n=[],s=[];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],r[0]=s[0]+e[0],r[1]=s[1]+e[1],r[2]=s[2]+e[2],r}function jn(r,t){var e=r[0],i=r[1],n=r[2],s=t[0],a=t[1],h=t[2],o=Math.sqrt(e*e+i*i+n*n),c=Math.sqrt(s*s+a*a+h*h),f=o*c,l=f&&xr(r,t)/f;return Math.acos(Math.min(Math.max(l,-1),1))}function kn(r){return r[0]=0,r[1]=0,r[2]=0,r}function Wn(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function Hn(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function $n(r,t){var e=r[0],i=r[1],n=r[2],s=t[0],a=t[1],h=t[2];return Math.abs(e-s)<=y*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(i-a)<=y*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=y*Math.max(1,Math.abs(n),Math.abs(h))}var Qn=zt,Zn=St,Kn=bt,Jn=It,rs=Lt,Br=Tt,ts=Ot,es=function(){var r=lr();return function(t,e,i,n,s,a){var h,o;for(e||(e=3),i||(i=0),n?o=Math.min(n*e+i,t.length):o=t.length,h=i;h<o;h+=e)r[0]=t[h],r[1]=t[h+1],r[2]=t[h+2],s(r,r,a),t[h]=r[0],t[h+1]=r[1],t[h+2]=r[2];return t}}();var Mr={};G(Mr,{add:()=>Hr,ceil:()=>is,clone:()=>Xr,copy:()=>kr,create:()=>Ct,cross:()=>ls,dist:()=>ws,distance:()=>_t,div:()=>ys,divide:()=>Nt,dot:()=>Zr,equals:()=>rt,exactEquals:()=>Jr,floor:()=>ns,forEach:()=>Rs,fromValues:()=>jr,inverse:()=>fs,len:()=>Ps,length:()=>vr,lerp:()=>Kr,max:()=>as,min:()=>ss,mul:()=>gs,multiply:()=>Ft,negate:()=>cs,normalize:()=>Qr,random:()=>ps,round:()=>hs,scale:()=>$r,scaleAndAdd:()=>os,set:()=>Wr,sqrDist:()=>Es,sqrLen:()=>As,squaredDistance:()=>Yt,squaredLength:()=>mr,str:()=>Ms,sub:()=>ds,subtract:()=>Dt,transformMat4:()=>xs,transformQuat:()=>vs,zero:()=>ms});function Ct(){var r=new T(4);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Xr(r){var t=new T(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function jr(r,t,e,i){var n=new T(4);return n[0]=r,n[1]=t,n[2]=e,n[3]=i,n}function kr(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Wr(r,t,e,i,n){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r}function Hr(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r}function Dt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r}function Ft(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r[3]=t[3]*e[3],r}function Nt(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r[3]=t[3]/e[3],r}function is(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r[3]=Math.ceil(t[3]),r}function ns(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r[3]=Math.floor(t[3]),r}function ss(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r[3]=Math.min(t[3],e[3]),r}function as(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3]),r}function hs(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r[3]=Math.round(t[3]),r}function $r(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function os(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r[3]=t[3]+e[3]*i,r}function _t(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2],s=t[3]-r[3];return Math.hypot(e,i,n,s)}function Yt(r,t){var e=t[0]-r[0],i=t[1]-r[1],n=t[2]-r[2],s=t[3]-r[3];return e*e+i*i+n*n+s*s}function vr(r){var t=r[0],e=r[1],i=r[2],n=r[3];return Math.hypot(t,e,i,n)}function mr(r){var t=r[0],e=r[1],i=r[2],n=r[3];return t*t+e*e+i*i+n*n}function cs(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r}function fs(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r[3]=1/t[3],r}function Qr(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*e+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=i*a,r[2]=n*a,r[3]=s*a,r}function Zr(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function ls(r,t,e,i){var n=e[0]*i[1]-e[1]*i[0],s=e[0]*i[2]-e[2]*i[0],a=e[0]*i[3]-e[3]*i[0],h=e[1]*i[2]-e[2]*i[1],o=e[1]*i[3]-e[3]*i[1],c=e[2]*i[3]-e[3]*i[2],f=t[0],l=t[1],x=t[2],p=t[3];return r[0]=l*c-x*o+p*h,r[1]=-(f*c)+x*a-p*s,r[2]=f*o-l*a+p*n,r[3]=-(f*h)+l*s-x*n,r}function Kr(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=t[3];return r[0]=n+i*(e[0]-n),r[1]=s+i*(e[1]-s),r[2]=a+i*(e[2]-a),r[3]=h+i*(e[3]-h),r}function ps(r,t){t=t||1;var e,i,n,s,a,h;do e=q()*2-1,i=q()*2-1,a=e*e+i*i;while(a>=1);do n=q()*2-1,s=q()*2-1,h=n*n+s*s;while(h>=1);var o=Math.sqrt((1-a)/h);return r[0]=t*e,r[1]=t*i,r[2]=t*n*o,r[3]=t*s*o,r}function xs(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3];return r[0]=e[0]*i+e[4]*n+e[8]*s+e[12]*a,r[1]=e[1]*i+e[5]*n+e[9]*s+e[13]*a,r[2]=e[2]*i+e[6]*n+e[10]*s+e[14]*a,r[3]=e[3]*i+e[7]*n+e[11]*s+e[15]*a,r}function vs(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[0],h=e[1],o=e[2],c=e[3],f=c*i+h*s-o*n,l=c*n+o*i-a*s,x=c*s+a*n-h*i,p=-a*i-h*n-o*s;return r[0]=f*c+p*-a+l*-o-x*-h,r[1]=l*c+p*-h+x*-a-f*-o,r[2]=x*c+p*-o+f*-h-l*-a,r[3]=t[3],r}function ms(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function Ms(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function Jr(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]}function rt(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=t[0],h=t[1],o=t[2],c=t[3];return Math.abs(e-a)<=y*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(i-h)<=y*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=y*Math.max(1,Math.abs(s),Math.abs(c))}var ds=Dt,gs=Ft,ys=Nt,ws=_t,Es=Yt,Ps=vr,As=mr,Rs=function(){var r=Ct();return function(t,e,i,n,s,a){var h,o;for(e||(e=4),i||(i=0),n?o=Math.min(n*e+i,t.length):o=t.length,h=i;h<o;h+=e)r[0]=t[h],r[1]=t[h+1],r[2]=t[h+2],r[3]=t[h+3],s(r,r,a),t[h]=r[0],t[h+1]=r[1],t[h+2]=r[2],t[h+3]=r[3];return t}}();function ar(){var r=new T(4);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ts(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Ut(r,t,e){e=e*.5;var i=Math.sin(e);return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=Math.cos(e),r}function zs(r,t){var e=Math.acos(t[3])*2,i=Math.sin(e/2);return i>y?(r[0]=t[0]/i,r[1]=t[1]/i,r[2]=t[2]/i):(r[0]=1,r[1]=0,r[2]=0),e}function Ss(r,t){var e=yr(r,t);return Math.acos(2*e*e-1)}function qt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],f=e[3];return r[0]=i*f+a*h+n*c-s*o,r[1]=n*f+a*o+s*h-i*c,r[2]=s*f+a*c+i*o-n*h,r[3]=a*f-i*h-n*o-s*c,r}function tt(r,t,e){e*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o+a*h,r[1]=n*o+s*h,r[2]=s*o-n*h,r[3]=a*o-i*h,r}function et(r,t,e){e*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o-s*h,r[1]=n*o+a*h,r[2]=s*o+i*h,r[3]=a*o-n*h,r}function it(r,t,e){e*=.5;var i=t[0],n=t[1],s=t[2],a=t[3],h=Math.sin(e),o=Math.cos(e);return r[0]=i*o+n*h,r[1]=n*o-i*h,r[2]=s*o+a*h,r[3]=a*o-s*h,r}function bs(r,t){var e=t[0],i=t[1],n=t[2];return r[0]=e,r[1]=i,r[2]=n,r[3]=Math.sqrt(Math.abs(1-e*e-i*i-n*n)),r}function Vt(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=Math.sqrt(e*e+i*i+n*n),h=Math.exp(s),o=a>0?h*Math.sin(a)/a:0;return r[0]=e*o,r[1]=i*o,r[2]=n*o,r[3]=h*Math.cos(a),r}function Gt(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=Math.sqrt(e*e+i*i+n*n),h=a>0?Math.atan2(a,s)/a:0;return r[0]=e*h,r[1]=i*h,r[2]=n*h,r[3]=.5*Math.log(e*e+i*i+n*n+s*s),r}function Is(r,t,e){return Gt(r,t),Bt(r,r,e),Vt(r,r),r}function dr(r,t,e,i){var n=t[0],s=t[1],a=t[2],h=t[3],o=e[0],c=e[1],f=e[2],l=e[3],x,p,v,d,m;return p=n*o+s*c+a*f+h*l,p<0&&(p=-p,o=-o,c=-c,f=-f,l=-l),1-p>y?(x=Math.acos(p),v=Math.sin(x),d=Math.sin((1-i)*x)/v,m=Math.sin(i*x)/v):(d=1-i,m=i),r[0]=d*n+m*o,r[1]=d*s+m*c,r[2]=d*a+m*f,r[3]=d*h+m*l,r}function Ls(r){var t=q(),e=q(),i=q(),n=Math.sqrt(1-t),s=Math.sqrt(t);return r[0]=n*Math.sin(2*Math.PI*e),r[1]=n*Math.cos(2*Math.PI*e),r[2]=s*Math.sin(2*Math.PI*i),r[3]=s*Math.cos(2*Math.PI*i),r}function Os(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*e+i*i+n*n+s*s,h=a?1/a:0;return r[0]=-e*h,r[1]=-i*h,r[2]=-n*h,r[3]=s*h,r}function Cs(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function ut(r,t){var e=t[0]+t[4]+t[8],i;if(e>0)i=Math.sqrt(e+1),r[3]=.5*i,i=.5/i,r[0]=(t[5]-t[7])*i,r[1]=(t[6]-t[2])*i,r[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(t[s*3+a]-t[a*3+s])*i,r[s]=(t[s*3+n]+t[n*3+s])*i,r[a]=(t[a*3+n]+t[n*3+a])*i}return r}function Ds(r,t,e,i){var n=.5*Math.PI/180;t*=n,e*=n,i*=n;var s=Math.sin(t),a=Math.cos(t),h=Math.sin(e),o=Math.cos(e),c=Math.sin(i),f=Math.cos(i);return r[0]=s*o*f-a*h*c,r[1]=a*h*f+s*o*c,r[2]=a*o*c-s*h*f,r[3]=a*o*f+s*h*c,r}function Fs(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var Ns=Xr,_s=jr,gr=kr,Ys=Wr,Us=Hr,qs=qt,Bt=$r,yr=Zr,Vs=Kr,wr=vr,Gs=wr,Er=mr,us=Er,nt=Qr,Bs=Jr,Xs=rt,js=function(){var r=lr(),t=pr(1,0,0),e=pr(0,1,0);return function(i,n,s){var a=xr(n,s);return a<-.999999?(sr(r,t,n),Br(r)<1e-6&&sr(r,e,n),ur(r,r),Ut(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(sr(r,n,s),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,nt(i,i))}}(),ks=function(){var r=ar(),t=ar();return function(e,i,n,s,a,h){return dr(r,i,a,h),dr(t,n,s,h),dr(e,r,t,2*h*(1-h)),e}}(),Ws=function(){var r=qr();return function(t,e,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],nt(t,ut(t,r))}}();var st={};G(st,{add:()=>ma,clone:()=>$s,conjugate:()=>wa,copy:()=>jt,create:()=>Hs,dot:()=>Wt,equals:()=>za,exactEquals:()=>Ta,fromMat4:()=>ra,fromRotation:()=>Js,fromRotationTranslation:()=>Xt,fromRotationTranslationValues:()=>Zs,fromTranslation:()=>Ks,fromValues:()=>Qs,getDual:()=>na,getReal:()=>ia,getTranslation:()=>ha,identity:()=>ta,invert:()=>ya,len:()=>Ea,length:()=>Ht,lerp:()=>ga,mul:()=>Ma,multiply:()=>kt,normalize:()=>Aa,rotateAroundAxis:()=>va,rotateByQuatAppend:()=>pa,rotateByQuatPrepend:()=>xa,rotateX:()=>ca,rotateY:()=>fa,rotateZ:()=>la,scale:()=>da,set:()=>ea,setDual:()=>aa,setReal:()=>sa,sqrLen:()=>Pa,squaredLength:()=>Pr,str:()=>Ra,translate:()=>oa});function Hs(){var r=new T(8);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r}function $s(r){var t=new T(8);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t}function Qs(r,t,e,i,n,s,a,h){var o=new T(8);return o[0]=r,o[1]=t,o[2]=e,o[3]=i,o[4]=n,o[5]=s,o[6]=a,o[7]=h,o}function Zs(r,t,e,i,n,s,a){var h=new T(8);h[0]=r,h[1]=t,h[2]=e,h[3]=i;var o=n*.5,c=s*.5,f=a*.5;return h[4]=o*i+c*e-f*t,h[5]=c*i+f*r-o*e,h[6]=f*i+o*t-c*r,h[7]=-o*r-c*t-f*e,h}function Xt(r,t,e){var i=e[0]*.5,n=e[1]*.5,s=e[2]*.5,a=t[0],h=t[1],o=t[2],c=t[3];return r[0]=a,r[1]=h,r[2]=o,r[3]=c,r[4]=i*c+n*o-s*h,r[5]=n*c+s*a-i*o,r[6]=s*c+i*h-n*a,r[7]=-i*a-n*h-s*o,r}function Ks(r,t){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=t[0]*.5,r[5]=t[1]*.5,r[6]=t[2]*.5,r[7]=0,r}function Js(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r}function ra(r,t){var e=ar();Gr(e,t);var i=new T(3);return Vr(i,t),Xt(r,e,i),r}function jt(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r}function ta(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r}function ea(r,t,e,i,n,s,a,h,o){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r}var ia=gr;function na(r,t){return r[0]=t[4],r[1]=t[5],r[2]=t[6],r[3]=t[7],r}var sa=gr;function aa(r,t){return r[4]=t[0],r[5]=t[1],r[6]=t[2],r[7]=t[3],r}function ha(r,t){var e=t[4],i=t[5],n=t[6],s=t[7],a=-t[0],h=-t[1],o=-t[2],c=t[3];return r[0]=(e*c+s*a+i*o-n*h)*2,r[1]=(i*c+s*h+n*a-e*o)*2,r[2]=(n*c+s*o+e*h-i*a)*2,r}function oa(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0]*.5,o=e[1]*.5,c=e[2]*.5,f=t[4],l=t[5],x=t[6],p=t[7];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=a*h+n*c-s*o+f,r[5]=a*o+s*h-i*c+l,r[6]=a*c+i*o-n*h+x,r[7]=-i*h-n*o-s*c+p,r}function ca(r,t,e){var i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=h*a+f*i+o*s-c*n,x=o*a+f*n+c*i-h*s,p=c*a+f*s+h*n-o*i,v=f*a-h*i-o*n-c*s;return tt(r,t,e),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=l*a+v*i+x*s-p*n,r[5]=x*a+v*n+p*i-l*s,r[6]=p*a+v*s+l*n-x*i,r[7]=v*a-l*i-x*n-p*s,r}function fa(r,t,e){var i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=h*a+f*i+o*s-c*n,x=o*a+f*n+c*i-h*s,p=c*a+f*s+h*n-o*i,v=f*a-h*i-o*n-c*s;return et(r,t,e),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=l*a+v*i+x*s-p*n,r[5]=x*a+v*n+p*i-l*s,r[6]=p*a+v*s+l*n-x*i,r[7]=v*a-l*i-x*n-p*s,r}function la(r,t,e){var i=-t[0],n=-t[1],s=-t[2],a=t[3],h=t[4],o=t[5],c=t[6],f=t[7],l=h*a+f*i+o*s-c*n,x=o*a+f*n+c*i-h*s,p=c*a+f*s+h*n-o*i,v=f*a-h*i-o*n-c*s;return it(r,t,e),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=l*a+v*i+x*s-p*n,r[5]=x*a+v*n+p*i-l*s,r[6]=p*a+v*s+l*n-x*i,r[7]=v*a-l*i-x*n-p*s,r}function pa(r,t,e){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],f=t[3];return r[0]=h*a+f*i+o*s-c*n,r[1]=o*a+f*n+c*i-h*s,r[2]=c*a+f*s+h*n-o*i,r[3]=f*a-h*i-o*n-c*s,h=t[4],o=t[5],c=t[6],f=t[7],r[4]=h*a+f*i+o*s-c*n,r[5]=o*a+f*n+c*i-h*s,r[6]=c*a+f*s+h*n-o*i,r[7]=f*a-h*i-o*n-c*s,r}function xa(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],f=e[3];return r[0]=i*f+a*h+n*c-s*o,r[1]=n*f+a*o+s*h-i*c,r[2]=s*f+a*c+i*o-n*h,r[3]=a*f-i*h-n*o-s*c,h=e[4],o=e[5],c=e[6],f=e[7],r[4]=i*f+a*h+n*c-s*o,r[5]=n*f+a*o+s*h-i*c,r[6]=s*f+a*c+i*o-n*h,r[7]=a*f-i*h-n*o-s*c,r}function va(r,t,e,i){if(Math.abs(i)<y)return jt(r,t);var n=Math.hypot(e[0],e[1],e[2]);i=i*.5;var s=Math.sin(i),a=s*e[0]/n,h=s*e[1]/n,o=s*e[2]/n,c=Math.cos(i),f=t[0],l=t[1],x=t[2],p=t[3];r[0]=f*c+p*a+l*o-x*h,r[1]=l*c+p*h+x*a-f*o,r[2]=x*c+p*o+f*h-l*a,r[3]=p*c-f*a-l*h-x*o;var v=t[4],d=t[5],m=t[6],g=t[7];return r[4]=v*c+g*a+d*o-m*h,r[5]=d*c+g*h+m*a-v*o,r[6]=m*c+g*o+v*h-d*a,r[7]=g*c-v*a-d*h-m*o,r}function ma(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r}function kt(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[4],o=e[5],c=e[6],f=e[7],l=t[4],x=t[5],p=t[6],v=t[7],d=e[0],m=e[1],g=e[2],w=e[3];return r[0]=i*w+a*d+n*g-s*m,r[1]=n*w+a*m+s*d-i*g,r[2]=s*w+a*g+i*m-n*d,r[3]=a*w-i*d-n*m-s*g,r[4]=i*f+a*h+n*c-s*o+l*w+v*d+x*g-p*m,r[5]=n*f+a*o+s*h-i*c+x*w+v*m+p*d-l*g,r[6]=s*f+a*c+i*o-n*h+p*w+v*g+l*m-x*d,r[7]=a*f-i*h-n*o-s*c+v*w-l*d-x*m-p*g,r}var Ma=kt;function da(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r}var Wt=yr;function ga(r,t,e,i){var n=1-i;return Wt(t,e)<0&&(i=-i),r[0]=t[0]*n+e[0]*i,r[1]=t[1]*n+e[1]*i,r[2]=t[2]*n+e[2]*i,r[3]=t[3]*n+e[3]*i,r[4]=t[4]*n+e[4]*i,r[5]=t[5]*n+e[5]*i,r[6]=t[6]*n+e[6]*i,r[7]=t[7]*n+e[7]*i,r}function ya(r,t){var e=Pr(t);return r[0]=-t[0]/e,r[1]=-t[1]/e,r[2]=-t[2]/e,r[3]=t[3]/e,r[4]=-t[4]/e,r[5]=-t[5]/e,r[6]=-t[6]/e,r[7]=t[7]/e,r}function wa(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r[4]=-t[4],r[5]=-t[5],r[6]=-t[6],r[7]=t[7],r}var Ht=wr,Ea=Ht,Pr=Er,Pa=Pr;function Aa(r,t){var e=Pr(t);if(e>0){e=Math.sqrt(e);var i=t[0]/e,n=t[1]/e,s=t[2]/e,a=t[3]/e,h=t[4],o=t[5],c=t[6],f=t[7],l=i*h+n*o+s*c+a*f;r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=(h-i*l)/e,r[5]=(o-n*l)/e,r[6]=(c-s*l)/e,r[7]=(f-a*l)/e}return r}function Ra(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"}function Ta(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]}function za(r,t){var e=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],f=t[0],l=t[1],x=t[2],p=t[3],v=t[4],d=t[5],m=t[6],g=t[7];return Math.abs(e-f)<=y*Math.max(1,Math.abs(e),Math.abs(f))&&Math.abs(i-l)<=y*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-x)<=y*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-p)<=y*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-v)<=y*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-d)<=y*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(o-m)<=y*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(c-g)<=y*Math.max(1,Math.abs(c),Math.abs(g))}var W={};G(W,{add:()=>Oa,angle:()=>Za,ceil:()=>Ca,clone:()=>Sa,copy:()=>Ia,create:()=>$t,cross:()=>Ba,dist:()=>a1,distance:()=>Jt,div:()=>s1,divide:()=>Kt,dot:()=>ua,equals:()=>t1,exactEquals:()=>r1,floor:()=>Da,forEach:()=>c1,fromValues:()=>ba,inverse:()=>Va,len:()=>e1,length:()=>te,lerp:()=>Xa,max:()=>Na,min:()=>Fa,mul:()=>n1,multiply:()=>Zt,negate:()=>qa,normalize:()=>Ga,random:()=>ja,rotate:()=>Qa,round:()=>_a,scale:()=>Ya,scaleAndAdd:()=>Ua,set:()=>La,sqrDist:()=>h1,sqrLen:()=>o1,squaredDistance:()=>re,squaredLength:()=>ee,str:()=>Ja,sub:()=>i1,subtract:()=>Qt,transformMat2:()=>ka,transformMat2d:()=>Wa,transformMat3:()=>Ha,transformMat4:()=>$a,zero:()=>Ka});function $t(){var r=new T(2);return T!=Float32Array&&(r[0]=0,r[1]=0),r}function Sa(r){var t=new T(2);return t[0]=r[0],t[1]=r[1],t}function ba(r,t){var e=new T(2);return e[0]=r,e[1]=t,e}function Ia(r,t){return r[0]=t[0],r[1]=t[1],r}function La(r,t,e){return r[0]=t,r[1]=e,r}function Oa(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function Qt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function Zt(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r}function Kt(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r}function Ca(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r}function Da(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r}function Fa(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r}function Na(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r}function _a(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r}function Ya(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r}function Ua(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r}function Jt(r,t){var e=t[0]-r[0],i=t[1]-r[1];return Math.hypot(e,i)}function re(r,t){var e=t[0]-r[0],i=t[1]-r[1];return e*e+i*i}function te(r){var t=r[0],e=r[1];return Math.hypot(t,e)}function ee(r){var t=r[0],e=r[1];return t*t+e*e}function qa(r,t){return r[0]=-t[0],r[1]=-t[1],r}function Va(r,t){return r[0]=1/t[0],r[1]=1/t[1],r}function Ga(r,t){var e=t[0],i=t[1],n=e*e+i*i;return n>0&&(n=1/Math.sqrt(n)),r[0]=t[0]*n,r[1]=t[1]*n,r}function ua(r,t){return r[0]*t[0]+r[1]*t[1]}function Ba(r,t,e){var i=t[0]*e[1]-t[1]*e[0];return r[0]=r[1]=0,r[2]=i,r}function Xa(r,t,e,i){var n=t[0],s=t[1];return r[0]=n+i*(e[0]-n),r[1]=s+i*(e[1]-s),r}function ja(r,t){t=t||1;var e=q()*2*Math.PI;return r[0]=Math.cos(e)*t,r[1]=Math.sin(e)*t,r}function ka(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n,r[1]=e[1]*i+e[3]*n,r}function Wa(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[2]*n+e[4],r[1]=e[1]*i+e[3]*n+e[5],r}function Ha(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[3]*n+e[6],r[1]=e[1]*i+e[4]*n+e[7],r}function $a(r,t,e){var i=t[0],n=t[1];return r[0]=e[0]*i+e[4]*n+e[12],r[1]=e[1]*i+e[5]*n+e[13],r}function Qa(r,t,e,i){var n=t[0]-e[0],s=t[1]-e[1],a=Math.sin(i),h=Math.cos(i);return r[0]=n*h-s*a+e[0],r[1]=n*a+s*h+e[1],r}function Za(r,t){var e=r[0],i=r[1],n=t[0],s=t[1],a=Math.sqrt(e*e+i*i)*Math.sqrt(n*n+s*s),h=a&&(e*n+i*s)/a;return Math.acos(Math.min(Math.max(h,-1),1))}function Ka(r){return r[0]=0,r[1]=0,r}function Ja(r){return"vec2("+r[0]+", "+r[1]+")"}function r1(r,t){return r[0]===t[0]&&r[1]===t[1]}function t1(r,t){var e=r[0],i=r[1],n=t[0],s=t[1];return Math.abs(e-n)<=y*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(i-s)<=y*Math.max(1,Math.abs(i),Math.abs(s))}var e1=te,i1=Qt,n1=Zt,s1=Kt,a1=Jt,h1=re,o1=ee,c1=function(){var r=$t();return function(t,e,i,n,s,a){var h,o;for(e||(e=2),i||(i=0),n?o=Math.min(n*e+i,t.length):o=t.length,h=i;h<o;h+=e)r[0]=t[h],r[1]=t[h+1],s(r,r,a),t[h]=r[0],t[h+1]=r[1];return t}}();var $=class{position=S.fromValues(0,0,-1);direction=S.fromValues(0,0,-1);up=S.fromValues(0,1,0);projectionMatrix=b.create();viewMatrix=b.create();cameraMatrix=b.create();viewportWidth=0;viewportHeight=0;near=1;far=100;tpmVec=S.create();constructor(){}lookAt(...t){if(t.length==1)S.copy(this.tpmVec,t[0]);else if(t.length==3)S.set(this.tpmVec,...t);else throw new Error("required 1 or 3 arguments");S.sub(this.tpmVec,this.tpmVec,this.position),S.normalize(this.tpmVec,this.tpmVec);let e=S.dot(this.tpmVec,this.up);V.equals(e,1)?S.negate(this.up,this.direction):V.equals(e,-1)&&S.copy(this.up,this.direction),S.copy(this.direction,this.tpmVec),S.cross(this.up,this.getRight(),this.direction),S.normalize(this.up,this.up)}getRight(){return S.cross(this.tpmVec,this.direction,this.up)}updateConstants(t){b.lookAt(this.viewMatrix,this.position,S.add(this.tpmVec,this.position,this.direction),this.up),b.invert(this.cameraMatrix,this.viewMatrix),t.projectionMatrix=this.projectionMatrix,t.viewMatrix=this.viewMatrix,t.cameraMatrix=this.cameraMatrix,t.cameraPosition=this.position}};var U=class{buffers=new Map;indexCount=0;options;constructor(t={}){this.options=t,this.onInit()}onInit(){}createBuffer(t,e){let i={size:e,data:[],buffer:null};return this.buffers.set(t,i),i}getBuffer(t){return this.buffers.get(t)}bufferData(t,e,i){this.buffers.set(i,{size:e,data:t,buffer:null})}initBuffer(t){let e=this.buffers.get(t);e.buffer==null&&(e.buffer=M.gl.createBuffer()),t=="index"?(M.gl.bindBuffer(M.gl.ELEMENT_ARRAY_BUFFER,e.buffer),M.gl.bufferData(M.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.data),M.gl.STATIC_DRAW),this.indexCount=e.data.length):(M.gl.bindBuffer(M.gl.ARRAY_BUFFER,e.buffer),M.gl.bufferData(M.gl.ARRAY_BUFFER,new Float32Array(e.data),M.gl.STATIC_DRAW))}bind(t){this.buffers.forEach((e,i)=>{let n=t.shaderData.attribs[i];n!=-1&&(e.buffer==null&&this.initBuffer(i),i=="index"?M.gl.bindBuffer(M.gl.ELEMENT_ARRAY_BUFFER,e.buffer):(M.gl.bindBuffer(M.gl.ARRAY_BUFFER,e.buffer),M.gl.vertexAttribPointer(n,e.size,M.gl.FLOAT,!1,0,0),M.gl.enableVertexAttribArray(n)))})}draw(){M.gl.drawElements(M.gl.TRIANGLES,this.indexCount,M.gl.UNSIGNED_SHORT,0)}unbind(t){this.buffers.forEach((e,i)=>{let n=t.shaderData.attribs[i];n!=-1&&i!="index"&&M.gl.disableVertexAttribArray(n)})}};var j=class{shaderData;uniforms=new Map;constructor(t){this.shaderData=t,this.setUniform("uvOffset",[0,0])}setUniform(t,e){this.uniforms.set(t,e)}activate(){this.shaderData.activate()}bind(t){for(let e of this.shaderData.uniforms){let i=t[e.name];if(this.uniforms.has(e.name)&&(i=this.uniforms.get(e.name)),i&&e.location){let n=e.type,s=e.location;switch(n){case"mat4":M.gl.uniformMatrix4fv(s,!1,i);break;case"mat3":M.gl.uniformMatrix3fv(s,!1,val);break;case"vec4":M.gl.uniform4fv(s,i);break;case"vec3":M.gl.uniform3fv(s,i);break;case"vec2":M.gl.uniform2fv(s,i);break;case"float":M.gl.uniform1f(s,i);break}}}}};var k=class{mesh;shader;texture;position=S.create();rotation=J.create();scale=S.fromValues(1,1,1);parent=null;modelMatrix=b.create();normalMatrix=b.create();matrixAutoUpdate=!0;matrixNeedsUpdate=!0;constructor(t,e,i){this.mesh=t,this.shader=e,this.texture=i}setShader(t){this.shader=t}updateMatrix(){(this.matrixNeedsUpdate||this.matrixAutoUpdate)&&(this.matrixNeedsUpdate=!1,b.fromRotationTranslationScale(this.modelMatrix,this.rotation,this.position,this.scale),H.fromMat4(this.normalMatrix,this.modelMatrix),H.invert(this.normalMatrix,this.normalMatrix),H.transpose(this.normalMatrix,this.normalMatrix))}draw(t){this.shader.activate(),this.texture&&this.texture.bind(),this.updateMatrix();let e=t.viewMatrix,i=b.create();b.multiply(i,e,this.modelMatrix),this.shader.setUniform("modelViewMatrix",i),this.shader.setUniform("modelMatrix",this.modelMatrix),this.shader.setUniform("normalMatrix",this.normalMatrix),this.shader.bind(t),this.mesh.bind(this.shader),this.mesh.draw(),this.mesh.unbind(this.shader)}};var Ar=class extends ${fov;constructor(t,e,i,n,s){super(),this.fov=t,this.viewportWidth=e,this.viewportHeight=i,this.near=n,this.far=s,this.updateProjection()}updateProjection(){let t=this.viewportWidth/this.viewportHeight;b.perspective(this.projectionMatrix,this.fov/180*Math.PI,t,this.near,this.far)}};var at={};G(at,{Cone:()=>zr,Cube:()=>Rr,Plane:()=>rr,Quad:()=>tr,Sphere:()=>Tr});var Rr=class extends U{onInit(){this.options.width===void 0&&(this.options.width=1),this.options.height===void 0&&(this.options.height=1),this.options.depth===void 0&&(this.options.depth=1);let t=this.options.width/2,e=this.options.height/2,i=this.options.depth/2,n=[-t,e,i,t,e,i,t,-e,i,-t,-e,i,t,e,-i,-t,e,-i,-t,-e,-i,t,-e,-i,-t,e,-i,t,e,-i,t,e,i,-t,e,i,-t,-e,i,t,-e,i,t,-e,-i,-t,-e,-i,t,e,i,t,e,-i,t,-e,-i,t,-e,i,-t,e,-i,-t,e,i,-t,-e,i,-t,-e,-i],s=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],a="single";this.options.textureFaces!==void 0&&(a=this.options.textureFaces);let h=[];if(a=="single")for(let l=0;l<6;++l)h.push(0,0,1,0,1,1,0,1);else if(a=="multiple"){let p=.001;this.options.textureError!==void 0&&(p=this.options.textureError);let v=(d,m)=>{let g=d*.25+p,w=(d+1)*.25-p,E=m*.5+p,P=(m+1)*.5-p;h.push(g,E,w,E,w,P,g,P)};v(1,0),v(3,0),v(0,1),v(1,1),v(2,0),v(0,0)}else if(this.options.textureFaces=="skybox"){let p=.001;this.options.textureError!==void 0&&(p=this.options.textureError);let v=(d,m)=>{let g=d*.25+p,w=(d+1)*.25-p,E=m*.5+p,P=(m+1)*.5-p;h.push(w,E,g,E,g,P,w,P)};v(1,0),v(3,0),v(0,1),v(1,1),v(0,0),v(2,0)}else throw new Error("options.textureFaces valid values are single, multiple or skybox");let o=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],c=[];if(this.options.colors===void 0)for(let l=0;l<6;++l)c.push([1,1,1,1]);else if(this.options.colors.length==1){let l=this.options.colors[0];for(let x=0;x<6;++x)c.push(l)}else if(this.options.colors.length==6)for(let l=0;l<6;++l){let x=this.options.colors[l];c.push(x)}else throw new Error("options.colors requires 1 or 6 elements");let f=[];for(let l=0;l<6;++l)for(let x=0;x<4;++x)f.push(...c[l]);this.bufferData(n,3,"positions"),this.bufferData(s,3,"normals"),this.bufferData(f,4,"colors"),this.bufferData(h,2,"uvs"),this.bufferData(o,0,"index")}};var rr=class extends U{onInit(){this.options.width===void 0&&(this.options.width=1),this.options.depth===void 0&&(this.options.depth=1);let t=this.options.width/2,e=this.options.depth/2,i=this.options.widthSegments||1,n=this.options.depthSegments||1,s=this.options.heightMap||rr.generateHeightMap(i,n),a=[],h=[],o=[],c=[],f=[];for(let l=0;l<n;++l)for(let x=0;x<i;++x){a.push((2*x/i-1)*t,s[l][x],(2*l/n-1)*e,(2*(x+1)/i-1)*t,s[l][x+1],(2*l/n-1)*e,(2*(x+1)/i-1)*t,s[l+1][x+1],(2*(l+1)/n-1)*e,(2*x/i-1)*t,s[l+1][x],(2*(l+1)/n-1)*e),h.push(0,1,0,0,1,0,0,1,0,0,1,0),this.options.textureRepeat===void 0||this.options.textureRepeat===!1?o.push(x/i,l/n,(x+1)/i,l/n,(x+1)/i,(l+1)/n,x/i,(l+1)/n):o.push(0,0,1,0,1,1,0,1);let p=(l*i+x)*4;f.push(p,p+1,p+2,p,p+2,p+3)}if(this.options.colors===void 0)for(let l=0;l<i*n*16;++l)c.push(1);else if(typeof this.options.colors=="function"){let l=this.options.colors,x=[];for(let p=0;p<=n;++p){x.push([]);for(let v=0;v<=i;++v){let d=l(v/i*t*2-t,s[p][v],p/n*e*2-e);x[p].push(d)}}for(let p=0;p<n;++p)for(let v=0;v<i;++v)c.push(...x[p][v],...x[p][v+1],...x[p+1][v+1],...x[p+1][v])}else if(this.options.colors.length==1){let l=this.options.colors[0];for(let x=0;x<i*n*16;++x)c.push(l[x%4])}else throw new Error("options.colors requires 1 elements");this.bufferData(a,3,"positions"),this.bufferData(h,3,"normals"),this.bufferData(c,4,"colors"),this.bufferData(o,2,"uvs"),this.bufferData(f,0,"index")}static generateHeightMap(t,e){return[...new Array(e+1)].map(i=>[...new Array(t+1)].fill(0))}};var tr=class extends U{onInit(){this.options.width===void 0&&(this.options.width=1),this.options.height===void 0&&(this.options.height=1);let t=this.options.width/2,e=this.options.height/2,i=[-t,e,0,t,e,0,t,-e,0,-t,-e,0],n=[0,0,1,0,0,1,0,0,1,0,0,1],s=[];if(this.options.colors===void 0)for(let o=0;o<16;++o)s.push(1);else if(this.options.colors.length==1){let o=this.options.colors[0];for(let c=0;c<16;++c)s.push(o[c%4])}else if(this.options.colors.length==4)for(let o=0;o<4;++o){let c=this.options.colors[o];for(let f=0;f<4;++f)s.push(c[f])}else throw new Error("options.colors requires 1 or 4 elements");let a=[0,0,1,0,1,1,0,1],h=[0,1,2,0,2,3];this.bufferData(i,3,"positions"),this.bufferData(n,3,"normals"),this.bufferData(s,4,"colors"),this.bufferData(a,2,"uvs"),this.bufferData(h,0,"index")}};var Q=class{points=[];constructor(t){this.lerp=t}addPoint(t,e){this.points.push([t,e]);for(let i=this.points.length-1;i>0&&!(this.points[i][0]>=this.points[i-1][0]);--i)[this.points[i],this.points[i-1]]=[this.points[i-1],this.points[i]]}getValue(t){let e=0;for(let a=0;a<this.points.length&&!(t<this.points[a][0]);++a)e=a;let i=this.points[e],n=Math.min(e+1,this.points.length-1);if(e==n)return i[1];let s=this.points[n];return this.lerp((t-i[0])/(s[0]-i[0]),i[1],s[1])}};var Tr=class extends U{onInit(){this.options.radius===void 0&&(this.options.radius=.5);let t=this.options.radius,e=this.options.widthSegments||32,i=this.options.heightSegments||16,n=this.options.textureInvert===!0,s=[],a=[],h=[],o=[],c=[],f=[],l=[];for(let p=0;p<=i;++p){let v=p/i*Math.PI,d=Math.sin(v),m=Math.cos(v);for(let g=0;g<=e;++g){let w=g/e*2*Math.PI,E=Math.sin(w),P=Math.cos(w);c.push([d*P*t,m*t,d*E*t]),f.push([1-g/e,p/i])}}if(n)for(let p=0;p<f.length;p+=2)f[p]=1-f[p];if(this.options.colors===void 0)for(let p=0;p<(e+1)*(i+1);++p)l.push([1,1,1,1]);else if(this.options.colors instanceof Q)for(let p=0;p<=i;++p){let v=this.options.colors.getValue(p/i);for(let d=0;d<=e;++d)l.push(v)}else if(this.options.colors.length==1){let p=this.options.colors[0];for(let v=0;v<(e+1)*(i+1);++v)l.push(p)}else throw new Error("options.colors requires 1 elements");let x=0;for(let p=0;p<i;++p)for(let v=0;v<e;++v){let d=p*(e+1)+v,m=d+(e+1),g=[d,d+1,m+1,m];for(let w of g)s.push(...c[w]),a.push(...f[w]),h.push(...l[w]);o.push(x,x+1,x+2,x,x+2,x+3),x+=4}this.bufferData(s,3,"positions"),this.bufferData(h,4,"colors"),this.bufferData(a,2,"uvs"),this.bufferData(o,0,"index")}};var zr=class extends U{onInit(){this.options.radius===void 0&&(this.options.radius=.5);let t=this.options.radius;this.options.height===void 0&&(this.options.height=1);let e=this.options.height/2,i=this.options.widthSegments||32,n=[],s=[],a=[],h=[],o=[];h.push([0,e,0]);for(let f=0;f<=i;++f){let l=f/i*2*Math.PI,x=Math.sin(l),p=Math.cos(l);h.push([p*t,-e,x*t])}if(this.options.colors===void 0)for(let f=0;f<=i;++f)o.push([1,1,1,1]);else if(this.options.colors instanceof Q)for(let f=0;f<=i;++f){let l=this.options.colors.getValue(f/i);o.push(l)}else if(this.options.colors.length==1){let f=this.options.colors[0];for(let l=0;l<=i;++l)o.push(f)}else throw new Error("");let c=0;for(let f=1;f<=i;++f){let l=[0,f,f+1];for(let x of l)n.push(...h[x]),s.push(...o[f]);a.push(c,c+1,c+2),c+=3,f!=0&&f!=i&&a.push(1,c+1,(c+4)%(i*3))}this.bufferData(n,3,"positions"),this.bufferData(s,4,"colors"),this.bufferData(a,0,"index")}};var Sr=class extends ${zoom=1;constructor(t,e){super(),this.near=0,this.setToOrtho(t,e)}setToOrtho(t,e){this.viewportWidth=t,this.viewportHeight=e,S.set(this.position,this.zoom*t/2,this.zoom*e/2,0),this.updateProjection()}updateProjection(){b.ortho(this.projectionMatrix,this.zoom*-this.viewportWidth/2,this.zoom*this.viewportWidth/2,this.zoom*-this.viewportHeight/2,this.zoom*this.viewportHeight/2,this.near,this.far)}translate(...t){if(t.length==1)S.set(this.position,...t[0],0);else if(t.length==2)S.set(this.position,t[0],t[1],0);else throw new Error("required 1 or 2 arguments")}zoomBy(...t){let e=t[0];if(this.zoom*=1+e,t.length==2||t.length==3){let i=W.create();t.length==2?W.copy(i,t[1]):W.set(i,...t),W.sub(i,i,this.position),W.scale(i,i,e),S.add(this.position,this.position,[...i,0])}}};var br=class extends k{regionX;regionY;regionWidth;regionHeight;constructor(...t){let e=t[0],i=0,n=0,s=e.width,a=e.height;t.length==3?(s=t[1],a=t[2]):t.length==5&&(i=t[1],n=t[2],s=t[3],a=t[4]),super(new tr,new j(M.graphics.getShader("texture")),e),this.setRegion(i,n,s,a)}setRegion(t,e,i,n){this.regionX=t,this.regionY=e,this.regionWidth=i,this.regionHeight=n;let s=this.texture.width,a=this.texture.height,h=[t/s,e/a,(t+i)/s,e/a,(t+i)/s,(e+n)/a,t/s,(e+n)/a];this.mesh.bufferData(h,2,"uvs")}setRegionSize(t,e){this.regionWidth=t,this.regionHeight=e;let i=[0,0,t/this.texture.width,0,t/this.texture.width,e/this.texture.height,0,e/this.texture.height];this.mesh.bufferData(i,2,"uvs")}setRegionPosition(t,e){this.regionX=t,this.regionY=e,this.shader.setUniform("uvOffset",[t/this.texture.width,e/this.texture.height])}};var Ir=class extends k{font;text;rainbow;constructor(t,e="",i=!1){super(new U,new j(M.graphics.getShader("texture")),t.texture),this.font=t,this.text=e,this.rainbow=i,this.updateGeometry()}updateGeometry(){let t=[],e=[],i=[],n=[],s=this.font.charWidth,a=this.font.charHeight,h=this.font.options.charRatio,o=(1-this.text.length)*h*.5;for(let c=0;c<this.text.length;++c){let f=this.text.charCodeAt(c),l=this.font.getCharPosition(f);if(l===null)continue;let[x,p]=l;t.push(-.5*h+o,.5,0,.5*h+o,.5,0,.5*h+o,-.5,0,-.5*h+o,-.5,0),i.push(x/this.texture.width,p/this.texture.height,(x+s)/this.texture.width,p/this.texture.height,(x+s)/this.texture.width,(p+a)/this.texture.height,x/this.texture.width,(p+a)/this.texture.height);let v=c*4;n.push(v,v+1,v+2,v,v+2,v+3),o+=h}if(this.rainbow)for(let c=0;c<4*this.text.length;++c)e.push(Math.random(),Math.random(),Math.random(),1);else for(let c=0;c<4*this.text.length;++c)e.push(1,1,1,1);this.mesh.bufferData(t,3,"positions"),this.mesh.bufferData(e,4,"colors"),this.mesh.bufferData(i,2,"uvs"),this.mesh.bufferData(n,0,"index")}setText(t){this.text=t,this.updateGeometry()}};var Lr=class{position;velocity;color;alpha;size;life;maxLife;constructor(t){this.position=t.position,this.maxLife=t.life,this.life=t.life,this.size=t.size!==void 0?t.size:1,this.velocity=t.velocity||[0,0,0],this.color=t.color||[1,1,1],this.alpha=t.alpha!==void 0?t.alpha:1}update(){this.life-=M.graphics.delta*1e3}},Or=class{mesh;texture;shader;particles=[];constructor(t){this.mesh=new U,this.texture=t.texture,this.shader=new j(L.create(L.Type.PARTICLE,t.shaderOptions||{})),this.onScreenResize(M.graphics.width,M.graphics.height)}onScreenResize(t,e){this.shader.setUniform("pointMultiplier",e/2*Math.tan(30*Math.PI/180))}addParticles(){}updateParticles(){}updateGeometry(){let t=[],e=[],i=[];for(let n of this.particles)t.push(...n.position),e.push(...n.color,n.alpha),i.push(n.size);this.mesh.bufferData(t,3,"positions"),this.mesh.bufferData(e,4,"colors"),this.mesh.bufferData(i,1,"sizes")}draw(t){this.shader.activate(),this.texture.bind();let e=b.create(),i=t.viewMatrix,n=b.create();b.multiply(n,i,e),this.shader.setUniform("modelViewMatrix",n),this.shader.bind(t),this.mesh.bind(this.shader);let s=this.particles.length;M.gl.drawArrays(M.gl.POINTS,0,s),this.mesh.unbind(this.shader)}update(){this.addParticles(),this.updateParticles(),this.updateGeometry()}};var ht=class{mesh=new U;shader;idx=0;texture=null;onCustomProcessPosition=null;constants={projectionMatrix:b.create(),viewMatrix:b.create(),cameraMatrix:b.create(),cameraPosition:S.create()};constructor(t){this.shader=t,t.shaderData.attribs.index!=-1&&this.mesh.createBuffer("index",0),t.shaderData.attribs.positions!=-1&&this.mesh.createBuffer("positions",3),t.shaderData.attribs.uvs!=-1&&this.mesh.createBuffer("uvs",2),t.shaderData.attribs.colors!=-1&&this.mesh.createBuffer("colors",4)}setConstants(t){this.constants={...t}}begin(){this.idx=0,this.mesh.buffers.forEach(t=>{t.data.length=0}),this.texture=null}draw(t){let e=t.mesh.getBuffer("positions").data.length/3;(this.idx+e>ht.MAX_COUNT||t.texture!=this.texture)&&this.flush(),this.texture=t.texture,t.updateMatrix(),this.mesh.buffers.forEach((i,n)=>{let s=t.mesh.getBuffer(n).data;switch(n){case"positions":for(let a=0;a<s.length;a+=3){let h=S.fromValues(s[a],s[a+1],s[a+2]);this.onCustomProcessPosition&&this.onCustomProcessPosition(h,t),S.transformMat4(h,h,t.modelMatrix);for(let o=0;o<3;++o)i.data.push(h[o])}break;case"index":for(let a=0;a<s.length;++a)i.data.push(s[a]+this.idx);break;default:for(let a=0;a<s.length;++a)i.data.push(s[a])}}),this.idx+=e}end(){this.flush()}flush(){if(this.idx==0)return;this.mesh.buffers.forEach((s,a)=>{this.mesh.initBuffer(a)}),this.shader.activate(),this.texture&&this.texture.bind();let t=b.create(),e=b.create(),i=this.constants.viewMatrix,n=b.create();b.multiply(n,i,t),this.shader.setUniform("modelViewMatrix",n),this.shader.setUniform("modelMatrix",t),this.shader.setUniform("normalMatrix",e),this.shader.bind(this.constants),this.mesh.bind(this.shader),this.mesh.draw(),this.mesh.unbind(this.shader),this.idx=0,this.mesh.buffers.forEach(s=>{s.data.length=0})}},hr=ht;Y(hr,"MAX_COUNT",65536);var Cr=class extends k{idx=0;constructor(t,e){super(new U,t,e),t.shaderData.attribs.index!=-1&&this.mesh.createBuffer("index",0),t.shaderData.attribs.positions!=-1&&this.mesh.createBuffer("positions",3),t.shaderData.attribs.uvs!=-1&&this.mesh.createBuffer("uvs",2),t.shaderData.attribs.colors!=-1&&this.mesh.createBuffer("colors",4)}add(t){t.updateMatrix(),this.mesh.buffers.forEach((e,i)=>{let n=t.mesh.getBuffer(i).data;switch(i){case"positions":for(let s=0;s<n.length;s+=3){let a=S.fromValues(n[s],n[s+1],n[s+2]);S.transformMat4(a,a,t.modelMatrix);for(let h=0;h<3;++h)e.data.push(a[h])}break;case"index":for(let s=0;s<n.length;++s)e.data.push(n[s]+this.idx);break;default:for(let s=0;s<n.length;++s)e.data.push(n[s])}}),this.idx+=count}};var ot=class{touchInfo=[];keyInfo={currentlyPressed:new Set,previouslyPressed:new Set,justPressed:new Set};constructor(){for(let t=0;t<ot.MAX_TOUCHES;++t)this.touchInfo[t]={x:null,y:null,isTouched:!1,wasTouched:!1,isJustTouched:!1}}isKeyPressed(t){return this.keyInfo.currentlyPressed.has(t)}isKeyClicked(t){return this.keyInfo.justPressed.has(t)}isTouched(t=0){return this.touchInfo[t].isTouched}isJustTouched(t=0){return this.touchInfo[t].isJustTouched}isMousePressed(){return this.isTouched()}isMouseClicked(){return this.isJustTouched()}getX(t=0){return this.touchInfo[t].x}getY(t=0){return this.touchInfo[t].y}initEvents(){let t=M.graphics.canvas;addEventListener("keydown",e=>this.onKeyDown(e)),addEventListener("keyup",e=>this.onKeyUp(e)),t.addEventListener("touchstart",e=>this.handleTouchEvent(e)),t.addEventListener("touchmove",e=>this.handleTouchEvent(e)),t.addEventListener("touchend",e=>this.handleTouchEvent(e)),t.addEventListener("mousedown",e=>this.handleMouseEvent(e)),t.addEventListener("mousemove",e=>this.handleMouseEvent(e)),t.addEventListener("mouseup",e=>this.handleMouseEvent(e))}handleTouchEvent(t){let e=t.target.getBoundingClientRect();for(let i of t.changedTouches){let n=i.pageX-e.x,s=i.pageY-e.y,a=this.touchInfo[i.identifier];switch(a.x=n,a.y=e.height-s,t.type){case"touchstart":a.isTouched=!0;break;case"touchend":a.isTouched=!1}}}handleMouseEvent(t){let e=t.target.getBoundingClientRect(),i=t.pageX-e.x,n=t.pageY-e.y,s=this.touchInfo[0];switch(s.x=i,s.y=e.height-n,t.type){case"mousedown":s.isTouched=!0;break;case"mouseup":s.isTouched=!1}}onKeyDown(t){this.keyInfo.currentlyPressed.add(t.code)}onKeyUp(t){this.keyInfo.currentlyPressed.delete(t.code)}update(){this.keyInfo.currentlyPressed.forEach(t=>{this.keyInfo.previouslyPressed.has(t)||this.keyInfo.justPressed.add(t)}),this.keyInfo.previouslyPressed=new Set(this.keyInfo.currentlyPressed);for(let t of this.touchInfo)t.isJustTouched=t.isTouched&&!t.wasTouched,t.wasTouched=t.isTouched}},or=ot;Y(or,"MAX_TOUCHES",10);var se={};G(se,{LinearSpline:()=>Q,MathUtils:()=>u,Rectangle:()=>er});var er=class{x;y;width;height;constructor(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}setPosition(...t){if(t.length==1)this.x=t[0][0],this.y=t[0][1];else if(t.length==2)this.x=t[0],this.y=t[1];else throw new Error("1 or 2 arguments required");return this}setSize(...t){if(t.length==1)this.width=t[0][0],this.height=t[0][1];else if(t.length==2)this.width=t[0],this.height=t[1];else throw new Error("1 or 2 arguments required");return this}copy(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}clone(){return new er(this.x,this.y,this.width,this.height)}containsPoint(...t){let e,i;if(t.length==2)e=t[0],i=t[1];else if(t.length==1)e=t[0][0],i=t[0][1];else throw new Error("1 or 2 arguments required");return this.x<=e&&this.x+this.width>=e&&this.y<=i&&this.y+this.height>=i}containsRectangle(t){let e=t.x,i=e+t.width,n=t.y,s=n+t.height;return e>this.x&&e<this.x+this.width&&i>this.x&&i<this.x+this.width&&n>this.y&&n<this.y+this.height&&s>this.y&&s<this.y+this.height}overlaps(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}area(){return this.width*this.height}perimeter(){return(this.width+this.height)*2}};var Dr=class{audioContext;bgMusicNode=null;masterGain;bgMusicGain;cueGain;analyser;dataArray;constructor(){this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=1,this.bgMusicGain=this.audioContext.createGain(),this.bgMusicGain.connect(this.masterGain),this.bgMusicGain.gain.value=1,this.cueGain=this.audioContext.createGain(),this.cueGain.connect(this.masterGain),this.cueGain.gain.value=1,this.analyser=this.audioContext.createAnalyser(),this.analyser.connect(this.audioContext.destination),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)}get masterVolume(){return this.masterGain.gain.value}set masterVolume(t){this.masterGain.gain.value=u.sat(t)}get bgMusicVolume(){return this.bgMusicGain.gain.value}set bgMusicVolume(t){this.bgMusicGain.gain.value=u.sat(t)}get cueVolume(){return this.cueGain.gain.value}set cueVolume(t){this.cueGain.gain.value=u.sat(t)}setFrequencyDataSize(t){if(!u.isPowerOf2(t)&&t<16)throw new Error("size must be power of 2 and equal or bigger than 16");this.analyser.fftSize=t*2,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.dataArray),this.dataArray}playBgMusic(t,e={}){let i=e.loop===void 0?!0:e.loop,n=e.time===void 0?0:e.time,s=M.files.get(t);this.stopBgMusic(),this.bgMusicNode=this.audioContext.createBufferSource(),this.bgMusicNode.buffer=s,this.bgMusicNode.loop=i,this.bgMusicNode.start(n),this.bgMusicNode.connect(this.bgMusicGain),this.bgMusicNode.connect(this.analyser)}stopBgMusic(){this.isBgMusicPlaying()&&(this.bgMusicNode.stop(0),this.bgMusicNode=null)}isBgMusicPlaying(){return this.bgMusicNode!==null}playCue(t,e=1){let i=M.files.get(t),n=this.audioContext.createBufferSource();n.buffer=i,n.start(0);let s=this.audioContext.createGain();s.connect(this.cueGain),s.gain.value=u.sat(e),n.connect(s)}onResume(){this.audioContext.state=="suspended"&&this.audioContext.resume()}};var Fr=class{type;constructor(){this.detectDeviceType()}detectDeviceType(){let t=navigator.userAgent;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(t)?this.type="mobile":this.type="desktop"}};var M=class{static async init(t){this.graphics=new fr(t),this.files=new cr,this.input=new or,this.audio=new Dr,this.device=new Fr;for(let e of["mousedown","touchdown","keydown"])addEventListener(e,()=>this.audio.onResume());this.input.initEvents(),this.graphics.compileShaders(),this.graphics.generateFonts(),t.preload(),await this.files.waitForAssetsToLoad(),t.create(),addEventListener("resize",()=>this.graphics.onResize()),this.graphics.onResize(),this.graphics.onResume()}static get gl(){return this.graphics.gl}};Y(M,"graphics"),Y(M,"files"),Y(M,"input"),Y(M,"audio"),Y(M,"device");export{_r as Game,M as Gol,Nr as Screen,ie as glMatrix,ne as graphics,se as math};
//# sourceMappingURL=goliath.js.map
