var le=Object.defineProperty;var st=(r,e,t)=>e in r?le(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var G=(r,e)=>{for(var t in e)le(r,t,{get:e[t],enumerable:!0})};var U=(r,e,t)=>(st(r,typeof e!="symbol"?e+"":e,t),t);var cr=class{assets=new Map;toLoad=0;loadImage(e,t){let i=new Image;i.src=t,i.crossOrigin="Anonymous";let n=new Promise(s=>{i.onload=()=>{s(i)}});return this.addAsync(e,n),n}loadAudio(e,t){let i=fetch(t).then(n=>n.arrayBuffer()).then(n=>M.audio.audioContext.decodeAudioData(n));return this.addAsync(e,i),i}addAsync(e,t){++this.toLoad,t.then(i=>{this.assets.set(e,i),--this.toLoad})}waitForAssetsToLoad(){return new Promise(e=>{let t=()=>{this.toLoad==0?e(this.assets):setTimeout(()=>{t()},250)};t()})}get(e){return this.assets.get(e)}};var Cr=class{constructor(){this.create()}create(){}show(){}hide(){}resize(e,t){}render(e){}dispose(){}};var _r=class{screen=null;constructor(){}preload(){}create(){}resize(e,t){this.screen&&this.screen.resize(e,t)}render(e){this.screen&&this.screen.render(e)}setScreen(e){this.screen&&this.screen.hide(),this.screen=e,this.screen.show()}};var B=class{static lerp(e,t,i){return(i-t)*e+t}static rand(e,t){return Math.random()*(t-e)+e}static randInt(e,t){return Math.floor(this.rand(e,t+1))}static clamp(e,t,i){return Math.min(Math.max(e,t),i)}static sat(e){return this.clamp(e,0,1)}static shuffle(e){for(let t=0;t<e.length;++t){let i=this.randInt(0,e.length-1);[e[t],e[i]]=[e[i],e[t]]}}static choice(e){return e[this.randInt(0,e.length-1)]}static isPowerOf2(e){return(e&e-1)==0}};var Z=class{id;data;constructor(e,t={}){this.data=e,this.id=M.gl.createTexture(),M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texImage2D(M.gl.TEXTURE_2D,0,M.gl.RGBA,M.gl.RGBA,M.gl.UNSIGNED_BYTE,e),B.isPowerOf2(e.width)&&B.isPowerOf2(e.height)&&M.gl.generateMipmap(M.gl.TEXTURE_2D),M.gl.bindTexture(M.gl.TEXTURE_2D,null),this.setFilter(t.filter||M.gl.LINEAR),this.setWrap(t.wrap||M.gl.CLAMP_TO_EDGE)}setFilter(e){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_MIN_FILTER,e),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_MAG_FILTER,e==M.gl.NEAREST?M.gl.NEAREST:M.gl.LINEAR),M.gl.bindTexture(M.gl.TEXTURE_2D,null)}setWrap(e){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_WRAP_S,e),M.gl.texParameteri(M.gl.TEXTURE_2D,M.gl.TEXTURE_WRAP_T,e),M.gl.bindTexture(M.gl.TEXTURE_2D,null)}bind(){M.gl.bindTexture(M.gl.TEXTURE_2D,this.id)}dispose(){M.gl.deleteTexture(this.id)}get width(){return this.data.width}get height(){return this.data.height}};var K=class{options;columns=10;charFrom=32;charTo=126;bitmap;texture;charWidth;charHeight;constructor(e){this.options=e,this.charWidth=e.fontSize*e.charRatio,this.charHeight=e.fontSize*1.2,this.bitmap=this.generateBitmap(),this.texture=new Z(this.bitmap,{filter:M.gl.LINEAR_MIPMAP_LINEAR})}generateBitmap(){let e=document.createElement("canvas"),t=this.charTo-this.charFrom+1,i=Math.floor(t/this.columns);e.width=2**Math.ceil(Math.log2(this.columns*this.charWidth)),e.height=2**Math.ceil(Math.log2(i*this.charHeight));let n=e.getContext("2d");n.textBaseline="middle",n.textAlign="center",n.fillStyle="white",n.font=`${this.options.fontSize}px ${this.options.fontFamily}`;for(let s=0;s<t;++s){let a=String.fromCharCode(s+this.charFrom),h=(s%this.columns+.5)*this.charWidth,o=(Math.floor(s/this.columns)+.5)*this.charHeight;n.fillText(a,h,o)}return e}getCharPosition(e){if(e<this.charFrom||e>this.charTo)return null;let t=e-this.charFrom;return[t%this.columns*this.charWidth,Math.floor(t/this.columns)*this.charHeight]}};var nr=class{program;constructor(e,t){let i=this.compileShader(e,M.gl.VERTEX_SHADER),n=this.compileShader(t,M.gl.FRAGMENT_SHADER);if(this.program=M.gl.createProgram(),M.gl.attachShader(this.program,i),M.gl.attachShader(this.program,n),M.gl.linkProgram(this.program),!M.gl.getProgramParameter(this.program,M.gl.LINK_STATUS))throw console.log(M.gl.getProgramInfoLog(this.program)),new Error("program unable to link");this.attribs={positions:M.gl.getAttribLocation(this.program,"position"),normals:M.gl.getAttribLocation(this.program,"normal"),colors:M.gl.getAttribLocation(this.program,"color"),uvs:M.gl.getAttribLocation(this.program,"uv"),sizes:M.gl.getAttribLocation(this.program,"size")},this.uniforms=[{name:"projectionMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"projectionMatrix")},{name:"modelViewMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"modelViewMatrix")},{name:"modelMatrix",type:"mat4",location:M.gl.getUniformLocation(this.program,"modelMatrix")},{name:"normalMatrix",type:"mat3",location:M.gl.getUniformLocation(this.program,"normalMatrix")},{name:"lightColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightColor")},{name:"lightDirection",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightDirection")},{name:"lightPosition",type:"vec3",location:M.gl.getUniformLocation(this.program,"lightPosition")},{name:"cameraPosition",type:"vec3",location:M.gl.getUniformLocation(this.program,"cameraPosition")},{name:"pointMultiplier",type:"float",location:M.gl.getUniformLocation(this.program,"pointMultiplier")},{name:"ambientColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"ambientColor")},{name:"uvOffset",type:"vec2",location:M.gl.getUniformLocation(this.program,"uvOffset")},{name:"fogColor",type:"vec3",location:M.gl.getUniformLocation(this.program,"fogColor")},{name:"fogNear",type:"float",location:M.gl.getUniformLocation(this.program,"fogNear")},{name:"fogFar",type:"float",location:M.gl.getUniformLocation(this.program,"fogFar")}]}activate(){M.gl.useProgram(this.program)}compileShader(e,t){let i=M.gl.createShader(t);if(M.gl.shaderSource(i,e),M.gl.compileShader(i),!M.gl.getShaderParameter(i,M.gl.COMPILE_STATUS))throw console.log(M.gl.getShaderInfoLog(i)),new Error("shader unable to compile");return i}dispose(){}static create(e,t={}){switch(e){case this.Type.SIMPLE:{let i=[this.SIMPLE_VS].join(`
`),n=[t.useFog===!0?"#define USE_FOG":"",this.SIMPLE_FS].join(`
`);return new nr(i,n)}case this.Type.TEXTURE:{let i=[this.TEXTURE_VS].join(`
`),n=[t.useFog===!0?"#define USE_FOG":"",this.TEXTURE_FS].join(`
`);return new nr(i,n)}case this.Type.PARTICLE:return new nr(this.PARTICLE_VS,this.PARTICLE_FS);default:throw new Error("Type not found: "+e)}}},Y=nr;U(Y,"Type",Object.freeze({SIMPLE:1,TEXTURE:2,PARTICLE:3})),U(Y,"SIMPLE_VS",`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    attribute vec3 position;
    attribute vec4 color;

    varying vec4 vColor;
    varying vec3 vPosition;

    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * worldPosition;
        vColor = color;
        vPosition = worldPosition.xyz;
    }
    `),U(Y,"SIMPLE_FS",`
    precision mediump float;

    varying vec4 vColor;
    varying vec3 vPosition;

    uniform vec3 ambientColor;
    uniform vec3 fogColor;
    uniform float fogNear;
    uniform float fogFar;

    void main(void) {
        vec4 color = vec4(vColor.rgb * ambientColor, vColor.a);
        #ifdef USE_FOG
        float fogDistance = length(vPosition);
        float fogAmount = smoothstep(fogNear, fogFar, fogDistance);
        color = mix(color, vec4(fogColor, 1.0), fogAmount);
        #endif
        gl_FragColor = color;
    }
    `),U(Y,"TEXTURE_VS",`
    uniform mat4 modelViewMatrix;
    uniform mat4 projectionMatrix;

    attribute vec3 position;
    attribute vec4 color;
    attribute vec2 uv;

    varying vec4 vColor;
    varying vec2 vUv;
    varying vec3 vPosition;

    void main(void) {
        vec4 worldPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * worldPosition;
        vColor = color;
        vUv = uv;
        vPosition = worldPosition.xyz;
    }
    `),U(Y,"TEXTURE_FS",` 
    precision mediump float;

    varying vec4 vColor;
    varying vec2 vUv;
    varying vec3 vPosition;

    uniform sampler2D tex;
    uniform vec3 ambientColor;
    uniform vec2 uvOffset;
    uniform vec3 fogColor;
    uniform float fogNear;
    uniform float fogFar;

    void main(void) {
        vec4 texColor = texture2D(tex, vUv + uvOffset);
        vec4 color = vec4(vColor.rgb * texColor.rgb * ambientColor, texColor.a * vColor.a);
        #ifdef USE_FOG
        float fogDistance = length(vPosition);
        float fogAmount = smoothstep(fogNear, fogFar, fogDistance);
        color = mix(color, vec4(fogColor, texColor.a), fogAmount);
        #endif
        gl_FragColor = color;
    }
    `),U(Y,"PARTICLE_VS",`
    attribute vec3 position;
    attribute vec4 color;
    attribute float size;
    
    uniform float pointMultiplier;
    uniform mat4 projectionMatrix;
    uniform mat4 modelViewMatrix;
    
    varying vec4 vColor;
    
    void main(void) {
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        gl_PointSize = size * pointMultiplier / gl_Position.w;
        vColor = color;
    }
    `),U(Y,"PARTICLE_FS",`
    precision mediump float;
    
    varying vec4 vColor;

    uniform sampler2D tex;
    uniform vec3 ambientColor;
    
    void main(void) {
        vec4 texColor = texture2D(tex, gl_PointCoord);
        gl_FragColor = vec4(vColor.rgb * texColor.rgb * ambientColor * texColor.a, texColor.a);
        gl_FragColor *= vColor.a;
    }
    `);var lr=class{canvas;gl;frameId=null;width;height;delta=0;fps=60;lastFrameTime;frameStart;frames;game;shaders=new Map;fonts=new Map;constructor(e){this.game=e,this.canvas=this.createCanvas(),this.canvas.width=this.width=innerWidth,this.canvas.height=this.height=innerHeight,this.gl=this.canvas.getContext("webgl")}onResume(){this.lastFrameTime=this.frameStart=performance.now(),this.frames=0,this.RAF()}createCanvas(){let e=document.createElement("canvas");return e.oncontextmenu=t=>{t.preventDefault(),t.stopPropagation()},document.body.appendChild(e),e}onResize(){this.canvas.width=this.width=innerWidth,this.canvas.height=this.height=innerHeight,this.game.resize(this.width,this.height)}onDrawFrame(){let e=performance.now();this.delta=(e-this.lastFrameTime)*.001,this.lastFrameTime=e,M.input.update(),this.game.render(this.delta),e-this.frameStart>=1e3&&(this.fps=this.frames,this.frames=0,this.frameStart=e),++this.frames}RAF(){this.frameId=requestAnimationFrame(()=>{this.RAF(),this.onDrawFrame()})}compileShaders(){this.shaders.set("simple",new Y(Y.SIMPLE_VS,Y.SIMPLE_FS)),this.shaders.set("texture",new Y(Y.TEXTURE_VS,Y.TEXTURE_FS)),this.shaders.set("particle",new Y(Y.PARTICLE_VS,Y.PARTICLE_FS))}generateFonts(){this.fonts.set("Consolas",new K({fontFamily:"Consolas",fontSize:48,charRatio:.6}))}getShader(e){return this.shaders.get(e)}getFont(e){return this.fonts.get(e)}};var it={};G(it,{Batch:()=>hr,Camera:()=>Q,Drawable:()=>k,DrawableGroup:()=>Dr,Font:()=>K,Mesh:()=>F,OrthographicCamera:()=>Sr,Particle:()=>br,ParticleSystem:()=>Lr,PerspectiveCamera:()=>Ar,Shader:()=>Y,ShaderInstance:()=>j,Sprite:()=>zr,TextDrawable:()=>Ir,Texture:()=>Z,meshes:()=>se});var tt={};G(tt,{glMatrix:()=>V,mat2:()=>Yr,mat2d:()=>Fr,mat3:()=>H,mat4:()=>I,quat:()=>J,quat2:()=>ne,vec2:()=>W,vec3:()=>z,vec4:()=>Mr});var V={};G(V,{ARRAY_TYPE:()=>T,EPSILON:()=>y,RANDOM:()=>q,equals:()=>ct,setMatrixArrayType:()=>at,toRadian:()=>ot});var y=1e-6,T=typeof Float32Array<"u"?Float32Array:Array,q=Math.random;function at(r){T=r}var ht=Math.PI/180;function ot(r){return r*ht}function ct(r,e){return Math.abs(r-e)<=y*Math.max(1,Math.abs(r),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Yr={};G(Yr,{LDU:()=>St,add:()=>zt,adjoint:()=>dt,clone:()=>ft,copy:()=>pt,create:()=>lt,determinant:()=>yt,equals:()=>bt,exactEquals:()=>It,frob:()=>Tt,fromRotation:()=>Pt,fromScaling:()=>At,fromValues:()=>vt,identity:()=>xt,invert:()=>gt,mul:()=>Nt,multiply:()=>fe,multiplyScalar:()=>Lt,multiplyScalarAndAdd:()=>Dt,rotate:()=>wt,scale:()=>Et,set:()=>mt,str:()=>Rt,sub:()=>Ot,subtract:()=>pe,transpose:()=>Mt});function lt(){var r=new T(4);return T!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r}function ft(r){var e=new T(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function pt(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function xt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r}function vt(r,e,t,i){var n=new T(4);return n[0]=r,n[1]=e,n[2]=t,n[3]=i,n}function mt(r,e,t,i,n){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function Mt(r,e){if(r===e){var t=e[1];r[1]=e[2],r[2]=t}else r[0]=e[0],r[1]=e[2],r[2]=e[1],r[3]=e[3];return r}function gt(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t*s-n*i;return a?(a=1/a,r[0]=s*a,r[1]=-i*a,r[2]=-n*a,r[3]=t*a,r):null}function dt(r,e){var t=e[0];return r[0]=e[3],r[1]=-e[1],r[2]=-e[2],r[3]=t,r}function yt(r){return r[0]*r[3]-r[2]*r[1]}function fe(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],l=t[3];return r[0]=i*h+s*o,r[1]=n*h+a*o,r[2]=i*c+s*l,r[3]=n*c+a*l,r}function wt(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=Math.sin(t),o=Math.cos(t);return r[0]=i*o+s*h,r[1]=n*o+a*h,r[2]=i*-h+s*o,r[3]=n*-h+a*o,r}function Et(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1];return r[0]=i*h,r[1]=n*h,r[2]=s*o,r[3]=a*o,r}function Pt(r,e){var t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=t,r[2]=-t,r[3]=i,r}function At(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=e[1],r}function Rt(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function Tt(r){return Math.hypot(r[0],r[1],r[2],r[3])}function St(r,e,t,i){return r[2]=i[2]/i[0],t[0]=i[0],t[1]=i[1],t[3]=i[3]-r[2]*t[1],[r,e,t]}function zt(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function pe(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}function It(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}function bt(r,e){var t=r[0],i=r[1],n=r[2],s=r[3],a=e[0],h=e[1],o=e[2],c=e[3];return Math.abs(t-a)<=y*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(i-h)<=y*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=y*Math.max(1,Math.abs(s),Math.abs(c))}function Lt(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Dt(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r}var Nt=fe,Ot=pe;var Fr={};G(Fr,{add:()=>Kt,clone:()=>_t,copy:()=>Yt,create:()=>Ct,determinant:()=>Gt,equals:()=>ri,exactEquals:()=>ut,frob:()=>Zt,fromRotation:()=>kt,fromScaling:()=>Wt,fromTranslation:()=>Ht,fromValues:()=>Ut,identity:()=>Ft,invert:()=>Vt,mul:()=>ei,multiply:()=>xe,multiplyScalar:()=>Jt,multiplyScalarAndAdd:()=>$t,rotate:()=>Bt,scale:()=>Xt,set:()=>qt,str:()=>Qt,sub:()=>ti,subtract:()=>ve,translate:()=>jt});function Ct(){var r=new T(6);return T!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r}function _t(r){var e=new T(6);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e}function Yt(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r}function Ft(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r}function Ut(r,e,t,i,n,s){var a=new T(6);return a[0]=r,a[1]=e,a[2]=t,a[3]=i,a[4]=n,a[5]=s,a}function qt(r,e,t,i,n,s,a){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r}function Vt(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],h=e[5],o=t*s-i*n;return o?(o=1/o,r[0]=s*o,r[1]=-i*o,r[2]=-n*o,r[3]=t*o,r[4]=(n*h-s*a)*o,r[5]=(i*a-t*h)*o,r):null}function Gt(r){return r[0]*r[3]-r[1]*r[2]}function xe(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=t[0],l=t[1],p=t[2],f=t[3],x=t[4],v=t[5];return r[0]=i*c+s*l,r[1]=n*c+a*l,r[2]=i*p+s*f,r[3]=n*p+a*f,r[4]=i*x+s*v+h,r[5]=n*x+a*v+o,r}function Bt(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=Math.sin(t),l=Math.cos(t);return r[0]=i*l+s*c,r[1]=n*l+a*c,r[2]=i*-c+s*l,r[3]=n*-c+a*l,r[4]=h,r[5]=o,r}function Xt(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=t[0],l=t[1];return r[0]=i*c,r[1]=n*c,r[2]=s*l,r[3]=a*l,r[4]=h,r[5]=o,r}function jt(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=t[0],l=t[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=i*c+s*l+h,r[5]=n*c+a*l+o,r}function kt(r,e){var t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=t,r[2]=-t,r[3]=i,r[4]=0,r[5]=0,r}function Wt(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=e[1],r[4]=0,r[5]=0,r}function Ht(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=e[0],r[5]=e[1],r}function Qt(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"}function Zt(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)}function Kt(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r}function ve(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r}function Jt(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r}function $t(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r[4]=e[4]+t[4]*i,r[5]=e[5]+t[5]*i,r}function ut(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]}function ri(r,e){var t=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=e[0],c=e[1],l=e[2],p=e[3],f=e[4],x=e[5];return Math.abs(t-o)<=y*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(i-c)<=y*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-l)<=y*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-p)<=y*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-f)<=y*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(h-x)<=y*Math.max(1,Math.abs(h),Math.abs(x))}var ei=xe,ti=ve;var H={};G(H,{add:()=>Ti,adjoint:()=>fi,clone:()=>ni,copy:()=>si,create:()=>Ur,determinant:()=>pi,equals:()=>bi,exactEquals:()=>Ii,frob:()=>Ri,fromMat2d:()=>yi,fromMat4:()=>ii,fromQuat:()=>wi,fromRotation:()=>gi,fromScaling:()=>di,fromTranslation:()=>Mi,fromValues:()=>ai,identity:()=>oi,invert:()=>li,mul:()=>Li,multiply:()=>me,multiplyScalar:()=>Si,multiplyScalarAndAdd:()=>zi,normalFromMat4:()=>Ei,projection:()=>Pi,rotate:()=>vi,scale:()=>mi,set:()=>hi,str:()=>Ai,sub:()=>Di,subtract:()=>Me,translate:()=>xi,transpose:()=>ci});function Ur(){var r=new T(9);return T!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ii(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r}function ni(r){var e=new T(9);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e}function si(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function ai(r,e,t,i,n,s,a,h,o){var c=new T(9);return c[0]=r,c[1]=e,c[2]=t,c[3]=i,c[4]=n,c[5]=s,c[6]=a,c[7]=h,c[8]=o,c}function hi(r,e,t,i,n,s,a,h,o,c){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r[8]=c,r}function oi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function ci(r,e){if(r===e){var t=e[1],i=e[2],n=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=i,r[7]=n}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function li(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8],p=l*a-h*c,f=-l*s+h*o,x=c*s-a*o,v=t*p+i*f+n*x;return v?(v=1/v,r[0]=p*v,r[1]=(-l*i+n*c)*v,r[2]=(h*i-n*a)*v,r[3]=f*v,r[4]=(l*t-n*o)*v,r[5]=(-h*t+n*s)*v,r[6]=x*v,r[7]=(-c*t+i*o)*v,r[8]=(a*t-i*s)*v,r):null}function fi(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8];return r[0]=a*l-h*c,r[1]=n*c-i*l,r[2]=i*h-n*a,r[3]=h*o-s*l,r[4]=t*l-n*o,r[5]=n*s-t*h,r[6]=s*c-a*o,r[7]=i*o-t*c,r[8]=t*a-i*s,r}function pi(r){var e=r[0],t=r[1],i=r[2],n=r[3],s=r[4],a=r[5],h=r[6],o=r[7],c=r[8];return e*(c*s-a*o)+t*(-c*n+a*h)+i*(o*n-s*h)}function me(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=e[8],f=t[0],x=t[1],v=t[2],g=t[3],m=t[4],d=t[5],E=t[6],w=t[7],P=t[8];return r[0]=f*i+x*a+v*c,r[1]=f*n+x*h+v*l,r[2]=f*s+x*o+v*p,r[3]=g*i+m*a+d*c,r[4]=g*n+m*h+d*l,r[5]=g*s+m*o+d*p,r[6]=E*i+w*a+P*c,r[7]=E*n+w*h+P*l,r[8]=E*s+w*o+P*p,r}function xi(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=e[8],f=t[0],x=t[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=h,r[5]=o,r[6]=f*i+x*a+c,r[7]=f*n+x*h+l,r[8]=f*s+x*o+p,r}function vi(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=e[8],f=Math.sin(t),x=Math.cos(t);return r[0]=x*i+f*a,r[1]=x*n+f*h,r[2]=x*s+f*o,r[3]=x*a-f*i,r[4]=x*h-f*n,r[5]=x*o-f*s,r[6]=c,r[7]=l,r[8]=p,r}function mi(r,e,t){var i=t[0],n=t[1];return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=n*e[3],r[4]=n*e[4],r[5]=n*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function Mi(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=e[0],r[7]=e[1],r[8]=1,r}function gi(r,e){var t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=t,r[2]=0,r[3]=-t,r[4]=i,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function di(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=e[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function yi(r,e){return r[0]=e[0],r[1]=e[1],r[2]=0,r[3]=e[2],r[4]=e[3],r[5]=0,r[6]=e[4],r[7]=e[5],r[8]=1,r}function wi(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t+t,h=i+i,o=n+n,c=t*a,l=i*a,p=i*h,f=n*a,x=n*h,v=n*o,g=s*a,m=s*h,d=s*o;return r[0]=1-p-v,r[3]=l-d,r[6]=f+m,r[1]=l+d,r[4]=1-c-v,r[7]=x-g,r[2]=f-m,r[5]=x+g,r[8]=1-c-p,r}function Ei(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8],p=e[9],f=e[10],x=e[11],v=e[12],g=e[13],m=e[14],d=e[15],E=t*h-i*a,w=t*o-n*a,P=t*c-s*a,R=i*o-n*h,A=i*c-s*h,O=n*c-s*o,L=l*g-p*v,D=l*m-f*v,b=l*d-x*v,C=p*m-f*g,N=p*d-x*g,_=f*d-x*m,S=E*_-w*N+P*C+R*b-A*D+O*L;return S?(S=1/S,r[0]=(h*_-o*N+c*C)*S,r[1]=(o*b-a*_-c*D)*S,r[2]=(a*N-h*b+c*L)*S,r[3]=(n*N-i*_-s*C)*S,r[4]=(t*_-n*b+s*D)*S,r[5]=(i*b-t*N-s*L)*S,r[6]=(g*O-m*A+d*R)*S,r[7]=(m*P-v*O-d*w)*S,r[8]=(v*A-g*P+d*E)*S,r):null}function Pi(r,e,t){return r[0]=2/e,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/t,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}function Ai(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"}function Ri(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}function Ti(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r}function Me(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r}function Si(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r}function zi(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r[4]=e[4]+t[4]*i,r[5]=e[5]+t[5]*i,r[6]=e[6]+t[6]*i,r[7]=e[7]+t[7]*i,r[8]=e[8]+t[8]*i,r}function Ii(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]}function bi(r,e){var t=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],l=r[8],p=e[0],f=e[1],x=e[2],v=e[3],g=e[4],m=e[5],d=e[6],E=e[7],w=e[8];return Math.abs(t-p)<=y*Math.max(1,Math.abs(t),Math.abs(p))&&Math.abs(i-f)<=y*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-x)<=y*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-v)<=y*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-g)<=y*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(h-m)<=y*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(o-d)<=y*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(c-E)<=y*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-w)<=y*Math.max(1,Math.abs(l),Math.abs(w))}var Li=me,Di=Me;var I={};G(I,{add:()=>vn,adjoint:()=>qi,clone:()=>Oi,copy:()=>Ci,create:()=>Ni,determinant:()=>Vi,equals:()=>dn,exactEquals:()=>gn,frob:()=>xn,fromQuat:()=>tn,fromQuat2:()=>ui,fromRotation:()=>Zi,fromRotationTranslation:()=>ye,fromRotationTranslationScale:()=>rn,fromRotationTranslationScaleOrigin:()=>en,fromScaling:()=>Qi,fromTranslation:()=>Hi,fromValues:()=>_i,fromXRotation:()=>Ki,fromYRotation:()=>Ji,fromZRotation:()=>$i,frustum:()=>nn,getRotation:()=>Vr,getScaling:()=>we,getTranslation:()=>qr,identity:()=>ge,invert:()=>Ui,lookAt:()=>ln,mul:()=>yn,multiply:()=>de,multiplyScalar:()=>mn,multiplyScalarAndAdd:()=>Mn,ortho:()=>on,orthoNO:()=>Pe,orthoZO:()=>cn,perspective:()=>sn,perspectiveFromFieldOfView:()=>hn,perspectiveNO:()=>Ee,perspectiveZO:()=>an,rotate:()=>Xi,rotateX:()=>ji,rotateY:()=>ki,rotateZ:()=>Wi,scale:()=>Bi,set:()=>Yi,str:()=>pn,sub:()=>wn,subtract:()=>Ae,targetTo:()=>fn,translate:()=>Gi,transpose:()=>Fi});function Ni(){var r=new T(16);return T!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Oi(r){var e=new T(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Ci(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function _i(r,e,t,i,n,s,a,h,o,c,l,p,f,x,v,g){var m=new T(16);return m[0]=r,m[1]=e,m[2]=t,m[3]=i,m[4]=n,m[5]=s,m[6]=a,m[7]=h,m[8]=o,m[9]=c,m[10]=l,m[11]=p,m[12]=f,m[13]=x,m[14]=v,m[15]=g,m}function Yi(r,e,t,i,n,s,a,h,o,c,l,p,f,x,v,g,m){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r[8]=c,r[9]=l,r[10]=p,r[11]=f,r[12]=x,r[13]=v,r[14]=g,r[15]=m,r}function ge(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Fi(r,e){if(r===e){var t=e[1],i=e[2],n=e[3],s=e[6],a=e[7],h=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=i,r[9]=s,r[11]=e[14],r[12]=n,r[13]=a,r[14]=h}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function Ui(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8],p=e[9],f=e[10],x=e[11],v=e[12],g=e[13],m=e[14],d=e[15],E=t*h-i*a,w=t*o-n*a,P=t*c-s*a,R=i*o-n*h,A=i*c-s*h,O=n*c-s*o,L=l*g-p*v,D=l*m-f*v,b=l*d-x*v,C=p*m-f*g,N=p*d-x*g,_=f*d-x*m,S=E*_-w*N+P*C+R*b-A*D+O*L;return S?(S=1/S,r[0]=(h*_-o*N+c*C)*S,r[1]=(n*N-i*_-s*C)*S,r[2]=(g*O-m*A+d*R)*S,r[3]=(f*A-p*O-x*R)*S,r[4]=(o*b-a*_-c*D)*S,r[5]=(t*_-n*b+s*D)*S,r[6]=(m*P-v*O-d*w)*S,r[7]=(l*O-f*P+x*w)*S,r[8]=(a*N-h*b+c*L)*S,r[9]=(i*b-t*N-s*L)*S,r[10]=(v*A-g*P+d*E)*S,r[11]=(p*P-l*A-x*E)*S,r[12]=(h*D-a*C-o*L)*S,r[13]=(t*C-i*D+n*L)*S,r[14]=(g*w-v*R-m*E)*S,r[15]=(l*R-p*w+f*E)*S,r):null}function qi(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],h=e[5],o=e[6],c=e[7],l=e[8],p=e[9],f=e[10],x=e[11],v=e[12],g=e[13],m=e[14],d=e[15];return r[0]=h*(f*d-x*m)-p*(o*d-c*m)+g*(o*x-c*f),r[1]=-(i*(f*d-x*m)-p*(n*d-s*m)+g*(n*x-s*f)),r[2]=i*(o*d-c*m)-h*(n*d-s*m)+g*(n*c-s*o),r[3]=-(i*(o*x-c*f)-h*(n*x-s*f)+p*(n*c-s*o)),r[4]=-(a*(f*d-x*m)-l*(o*d-c*m)+v*(o*x-c*f)),r[5]=t*(f*d-x*m)-l*(n*d-s*m)+v*(n*x-s*f),r[6]=-(t*(o*d-c*m)-a*(n*d-s*m)+v*(n*c-s*o)),r[7]=t*(o*x-c*f)-a*(n*x-s*f)+l*(n*c-s*o),r[8]=a*(p*d-x*g)-l*(h*d-c*g)+v*(h*x-c*p),r[9]=-(t*(p*d-x*g)-l*(i*d-s*g)+v*(i*x-s*p)),r[10]=t*(h*d-c*g)-a*(i*d-s*g)+v*(i*c-s*h),r[11]=-(t*(h*x-c*p)-a*(i*x-s*p)+l*(i*c-s*h)),r[12]=-(a*(p*m-f*g)-l*(h*m-o*g)+v*(h*f-o*p)),r[13]=t*(p*m-f*g)-l*(i*m-n*g)+v*(i*f-n*p),r[14]=-(t*(h*m-o*g)-a*(i*m-n*g)+v*(i*o-n*h)),r[15]=t*(h*f-o*p)-a*(i*f-n*p)+l*(i*o-n*h),r}function Vi(r){var e=r[0],t=r[1],i=r[2],n=r[3],s=r[4],a=r[5],h=r[6],o=r[7],c=r[8],l=r[9],p=r[10],f=r[11],x=r[12],v=r[13],g=r[14],m=r[15],d=e*a-t*s,E=e*h-i*s,w=e*o-n*s,P=t*h-i*a,R=t*o-n*a,A=i*o-n*h,O=c*v-l*x,L=c*g-p*x,D=c*m-f*x,b=l*g-p*v,C=l*m-f*v,N=p*m-f*g;return d*N-E*C+w*b+P*D-R*L+A*O}function de(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=e[8],f=e[9],x=e[10],v=e[11],g=e[12],m=e[13],d=e[14],E=e[15],w=t[0],P=t[1],R=t[2],A=t[3];return r[0]=w*i+P*h+R*p+A*g,r[1]=w*n+P*o+R*f+A*m,r[2]=w*s+P*c+R*x+A*d,r[3]=w*a+P*l+R*v+A*E,w=t[4],P=t[5],R=t[6],A=t[7],r[4]=w*i+P*h+R*p+A*g,r[5]=w*n+P*o+R*f+A*m,r[6]=w*s+P*c+R*x+A*d,r[7]=w*a+P*l+R*v+A*E,w=t[8],P=t[9],R=t[10],A=t[11],r[8]=w*i+P*h+R*p+A*g,r[9]=w*n+P*o+R*f+A*m,r[10]=w*s+P*c+R*x+A*d,r[11]=w*a+P*l+R*v+A*E,w=t[12],P=t[13],R=t[14],A=t[15],r[12]=w*i+P*h+R*p+A*g,r[13]=w*n+P*o+R*f+A*m,r[14]=w*s+P*c+R*x+A*d,r[15]=w*a+P*l+R*v+A*E,r}function Gi(r,e,t){var i=t[0],n=t[1],s=t[2],a,h,o,c,l,p,f,x,v,g,m,d;return e===r?(r[12]=e[0]*i+e[4]*n+e[8]*s+e[12],r[13]=e[1]*i+e[5]*n+e[9]*s+e[13],r[14]=e[2]*i+e[6]*n+e[10]*s+e[14],r[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(a=e[0],h=e[1],o=e[2],c=e[3],l=e[4],p=e[5],f=e[6],x=e[7],v=e[8],g=e[9],m=e[10],d=e[11],r[0]=a,r[1]=h,r[2]=o,r[3]=c,r[4]=l,r[5]=p,r[6]=f,r[7]=x,r[8]=v,r[9]=g,r[10]=m,r[11]=d,r[12]=a*i+l*n+v*s+e[12],r[13]=h*i+p*n+g*s+e[13],r[14]=o*i+f*n+m*s+e[14],r[15]=c*i+x*n+d*s+e[15]),r}function Bi(r,e,t){var i=t[0],n=t[1],s=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Xi(r,e,t,i){var n=i[0],s=i[1],a=i[2],h=Math.hypot(n,s,a),o,c,l,p,f,x,v,g,m,d,E,w,P,R,A,O,L,D,b,C,N,_,S,X;return h<y?null:(h=1/h,n*=h,s*=h,a*=h,o=Math.sin(t),c=Math.cos(t),l=1-c,p=e[0],f=e[1],x=e[2],v=e[3],g=e[4],m=e[5],d=e[6],E=e[7],w=e[8],P=e[9],R=e[10],A=e[11],O=n*n*l+c,L=s*n*l+a*o,D=a*n*l-s*o,b=n*s*l-a*o,C=s*s*l+c,N=a*s*l+n*o,_=n*a*l+s*o,S=s*a*l-n*o,X=a*a*l+c,r[0]=p*O+g*L+w*D,r[1]=f*O+m*L+P*D,r[2]=x*O+d*L+R*D,r[3]=v*O+E*L+A*D,r[4]=p*b+g*C+w*N,r[5]=f*b+m*C+P*N,r[6]=x*b+d*C+R*N,r[7]=v*b+E*C+A*N,r[8]=p*_+g*S+w*X,r[9]=f*_+m*S+P*X,r[10]=x*_+d*S+R*X,r[11]=v*_+E*S+A*X,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function ji(r,e,t){var i=Math.sin(t),n=Math.cos(t),s=e[4],a=e[5],h=e[6],o=e[7],c=e[8],l=e[9],p=e[10],f=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*n+c*i,r[5]=a*n+l*i,r[6]=h*n+p*i,r[7]=o*n+f*i,r[8]=c*n-s*i,r[9]=l*n-a*i,r[10]=p*n-h*i,r[11]=f*n-o*i,r}function ki(r,e,t){var i=Math.sin(t),n=Math.cos(t),s=e[0],a=e[1],h=e[2],o=e[3],c=e[8],l=e[9],p=e[10],f=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*n-c*i,r[1]=a*n-l*i,r[2]=h*n-p*i,r[3]=o*n-f*i,r[8]=s*i+c*n,r[9]=a*i+l*n,r[10]=h*i+p*n,r[11]=o*i+f*n,r}function Wi(r,e,t){var i=Math.sin(t),n=Math.cos(t),s=e[0],a=e[1],h=e[2],o=e[3],c=e[4],l=e[5],p=e[6],f=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*n+c*i,r[1]=a*n+l*i,r[2]=h*n+p*i,r[3]=o*n+f*i,r[4]=c*n-s*i,r[5]=l*n-a*i,r[6]=p*n-h*i,r[7]=f*n-o*i,r}function Hi(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Qi(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zi(r,e,t){var i=t[0],n=t[1],s=t[2],a=Math.hypot(i,n,s),h,o,c;return a<y?null:(a=1/a,i*=a,n*=a,s*=a,h=Math.sin(e),o=Math.cos(e),c=1-o,r[0]=i*i*c+o,r[1]=n*i*c+s*h,r[2]=s*i*c-n*h,r[3]=0,r[4]=i*n*c-s*h,r[5]=n*n*c+o,r[6]=s*n*c+i*h,r[7]=0,r[8]=i*s*c+n*h,r[9]=n*s*c-i*h,r[10]=s*s*c+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Ki(r,e){var t=Math.sin(e),i=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ji(r,e){var t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function $i(r,e){var t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ye(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=i+i,o=n+n,c=s+s,l=i*h,p=i*o,f=i*c,x=n*o,v=n*c,g=s*c,m=a*h,d=a*o,E=a*c;return r[0]=1-(x+g),r[1]=p+E,r[2]=f-d,r[3]=0,r[4]=p-E,r[5]=1-(l+g),r[6]=v+m,r[7]=0,r[8]=f+d,r[9]=v-m,r[10]=1-(l+x),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function ui(r,e){var t=new T(3),i=-e[0],n=-e[1],s=-e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=i*i+n*n+s*s+a*a;return p>0?(t[0]=(h*a+l*i+o*s-c*n)*2/p,t[1]=(o*a+l*n+c*i-h*s)*2/p,t[2]=(c*a+l*s+h*n-o*i)*2/p):(t[0]=(h*a+l*i+o*s-c*n)*2,t[1]=(o*a+l*n+c*i-h*s)*2,t[2]=(c*a+l*s+h*n-o*i)*2),ye(r,e,t),r}function qr(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function we(r,e){var t=e[0],i=e[1],n=e[2],s=e[4],a=e[5],h=e[6],o=e[8],c=e[9],l=e[10];return r[0]=Math.hypot(t,i,n),r[1]=Math.hypot(s,a,h),r[2]=Math.hypot(o,c,l),r}function Vr(r,e){var t=new T(3);we(t,e);var i=1/t[0],n=1/t[1],s=1/t[2],a=e[0]*i,h=e[1]*n,o=e[2]*s,c=e[4]*i,l=e[5]*n,p=e[6]*s,f=e[8]*i,x=e[9]*n,v=e[10]*s,g=a+l+v,m=0;return g>0?(m=Math.sqrt(g+1)*2,r[3]=.25*m,r[0]=(p-x)/m,r[1]=(f-o)/m,r[2]=(h-c)/m):a>l&&a>v?(m=Math.sqrt(1+a-l-v)*2,r[3]=(p-x)/m,r[0]=.25*m,r[1]=(h+c)/m,r[2]=(f+o)/m):l>v?(m=Math.sqrt(1+l-a-v)*2,r[3]=(f-o)/m,r[0]=(h+c)/m,r[1]=.25*m,r[2]=(p+x)/m):(m=Math.sqrt(1+v-a-l)*2,r[3]=(h-c)/m,r[0]=(f+o)/m,r[1]=(p+x)/m,r[2]=.25*m),r}function rn(r,e,t,i){var n=e[0],s=e[1],a=e[2],h=e[3],o=n+n,c=s+s,l=a+a,p=n*o,f=n*c,x=n*l,v=s*c,g=s*l,m=a*l,d=h*o,E=h*c,w=h*l,P=i[0],R=i[1],A=i[2];return r[0]=(1-(v+m))*P,r[1]=(f+w)*P,r[2]=(x-E)*P,r[3]=0,r[4]=(f-w)*R,r[5]=(1-(p+m))*R,r[6]=(g+d)*R,r[7]=0,r[8]=(x+E)*A,r[9]=(g-d)*A,r[10]=(1-(p+v))*A,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function en(r,e,t,i,n){var s=e[0],a=e[1],h=e[2],o=e[3],c=s+s,l=a+a,p=h+h,f=s*c,x=s*l,v=s*p,g=a*l,m=a*p,d=h*p,E=o*c,w=o*l,P=o*p,R=i[0],A=i[1],O=i[2],L=n[0],D=n[1],b=n[2],C=(1-(g+d))*R,N=(x+P)*R,_=(v-w)*R,S=(x-P)*A,X=(1-(f+d))*A,tr=(m+E)*A,ir=(v+w)*O,oe=(m-E)*O,ce=(1-(f+g))*O;return r[0]=C,r[1]=N,r[2]=_,r[3]=0,r[4]=S,r[5]=X,r[6]=tr,r[7]=0,r[8]=ir,r[9]=oe,r[10]=ce,r[11]=0,r[12]=t[0]+L-(C*L+S*D+ir*b),r[13]=t[1]+D-(N*L+X*D+oe*b),r[14]=t[2]+b-(_*L+tr*D+ce*b),r[15]=1,r}function tn(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t+t,h=i+i,o=n+n,c=t*a,l=i*a,p=i*h,f=n*a,x=n*h,v=n*o,g=s*a,m=s*h,d=s*o;return r[0]=1-p-v,r[1]=l+d,r[2]=f-m,r[3]=0,r[4]=l-d,r[5]=1-c-v,r[6]=x+g,r[7]=0,r[8]=f+m,r[9]=x-g,r[10]=1-c-p,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function nn(r,e,t,i,n,s,a){var h=1/(t-e),o=1/(n-i),c=1/(s-a);return r[0]=s*2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*o,r[6]=0,r[7]=0,r[8]=(t+e)*h,r[9]=(n+i)*o,r[10]=(a+s)*c,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*c,r[15]=0,r}function Ee(r,e,t,i,n){var s=1/Math.tan(e/2),a;return r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=(n+i)*a,r[14]=2*n*i*a):(r[10]=-1,r[14]=-2*i),r}var sn=Ee;function an(r,e,t,i,n){var s=1/Math.tan(e/2),a;return r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=n*a,r[14]=n*i*a):(r[10]=-1,r[14]=-i),r}function hn(r,e,t,i){var n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),o=2/(a+h),c=2/(n+s);return r[0]=o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=-((a-h)*o*.5),r[9]=(n-s)*c*.5,r[10]=i/(t-i),r[11]=-1,r[12]=0,r[13]=0,r[14]=i*t/(t-i),r[15]=0,r}function Pe(r,e,t,i,n,s,a){var h=1/(e-t),o=1/(i-n),c=1/(s-a);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(e+t)*h,r[13]=(n+i)*o,r[14]=(a+s)*c,r[15]=1,r}var on=Pe;function cn(r,e,t,i,n,s,a){var h=1/(e-t),o=1/(i-n),c=1/(s-a);return r[0]=-2*h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=c,r[11]=0,r[12]=(e+t)*h,r[13]=(n+i)*o,r[14]=s*c,r[15]=1,r}function ln(r,e,t,i){var n,s,a,h,o,c,l,p,f,x,v=e[0],g=e[1],m=e[2],d=i[0],E=i[1],w=i[2],P=t[0],R=t[1],A=t[2];return Math.abs(v-P)<y&&Math.abs(g-R)<y&&Math.abs(m-A)<y?ge(r):(l=v-P,p=g-R,f=m-A,x=1/Math.hypot(l,p,f),l*=x,p*=x,f*=x,n=E*f-w*p,s=w*l-d*f,a=d*p-E*l,x=Math.hypot(n,s,a),x?(x=1/x,n*=x,s*=x,a*=x):(n=0,s=0,a=0),h=p*a-f*s,o=f*n-l*a,c=l*s-p*n,x=Math.hypot(h,o,c),x?(x=1/x,h*=x,o*=x,c*=x):(h=0,o=0,c=0),r[0]=n,r[1]=h,r[2]=l,r[3]=0,r[4]=s,r[5]=o,r[6]=p,r[7]=0,r[8]=a,r[9]=c,r[10]=f,r[11]=0,r[12]=-(n*v+s*g+a*m),r[13]=-(h*v+o*g+c*m),r[14]=-(l*v+p*g+f*m),r[15]=1,r)}function fn(r,e,t,i){var n=e[0],s=e[1],a=e[2],h=i[0],o=i[1],c=i[2],l=n-t[0],p=s-t[1],f=a-t[2],x=l*l+p*p+f*f;x>0&&(x=1/Math.sqrt(x),l*=x,p*=x,f*=x);var v=o*f-c*p,g=c*l-h*f,m=h*p-o*l;return x=v*v+g*g+m*m,x>0&&(x=1/Math.sqrt(x),v*=x,g*=x,m*=x),r[0]=v,r[1]=g,r[2]=m,r[3]=0,r[4]=p*m-f*g,r[5]=f*v-l*m,r[6]=l*g-p*v,r[7]=0,r[8]=l,r[9]=p,r[10]=f,r[11]=0,r[12]=n,r[13]=s,r[14]=a,r[15]=1,r}function pn(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function xn(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}function vn(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r}function Ae(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r}function mn(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r}function Mn(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r[4]=e[4]+t[4]*i,r[5]=e[5]+t[5]*i,r[6]=e[6]+t[6]*i,r[7]=e[7]+t[7]*i,r[8]=e[8]+t[8]*i,r[9]=e[9]+t[9]*i,r[10]=e[10]+t[10]*i,r[11]=e[11]+t[11]*i,r[12]=e[12]+t[12]*i,r[13]=e[13]+t[13]*i,r[14]=e[14]+t[14]*i,r[15]=e[15]+t[15]*i,r}function gn(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function dn(r,e){var t=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],l=r[8],p=r[9],f=r[10],x=r[11],v=r[12],g=r[13],m=r[14],d=r[15],E=e[0],w=e[1],P=e[2],R=e[3],A=e[4],O=e[5],L=e[6],D=e[7],b=e[8],C=e[9],N=e[10],_=e[11],S=e[12],X=e[13],tr=e[14],ir=e[15];return Math.abs(t-E)<=y*Math.max(1,Math.abs(t),Math.abs(E))&&Math.abs(i-w)<=y*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(n-P)<=y*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(s-R)<=y*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(a-A)<=y*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(h-O)<=y*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(o-L)<=y*Math.max(1,Math.abs(o),Math.abs(L))&&Math.abs(c-D)<=y*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(l-b)<=y*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(p-C)<=y*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-N)<=y*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(x-_)<=y*Math.max(1,Math.abs(x),Math.abs(_))&&Math.abs(v-S)<=y*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(g-X)<=y*Math.max(1,Math.abs(g),Math.abs(X))&&Math.abs(m-tr)<=y*Math.max(1,Math.abs(m),Math.abs(tr))&&Math.abs(d-ir)<=y*Math.max(1,Math.abs(d),Math.abs(ir))}var yn=de,wn=Ae;var J={};G(J,{add:()=>Fs,calculateW:()=>zs,clone:()=>Cs,conjugate:()=>Ds,copy:()=>dr,create:()=>ar,dot:()=>yr,equals:()=>Xs,exactEquals:()=>Bs,exp:()=>qe,fromEuler:()=>Ns,fromMat3:()=>Ge,fromValues:()=>_s,getAngle:()=>Ss,getAxisAngle:()=>Ts,identity:()=>Rs,invert:()=>Ls,len:()=>Vs,length:()=>wr,lerp:()=>qs,ln:()=>Ve,mul:()=>Us,multiply:()=>Ue,normalize:()=>ie,pow:()=>Is,random:()=>bs,rotateX:()=>re,rotateY:()=>ee,rotateZ:()=>te,rotationTo:()=>js,scale:()=>Be,set:()=>Ys,setAxes:()=>Ws,setAxisAngle:()=>Fe,slerp:()=>gr,sqlerp:()=>ks,sqrLen:()=>Gs,squaredLength:()=>Er,str:()=>Os});var z={};G(z,{add:()=>Rn,angle:()=>jn,bezier:()=>Yn,ceil:()=>Tn,clone:()=>En,copy:()=>Pn,create:()=>fr,cross:()=>sr,dist:()=>$n,distance:()=>Ie,div:()=>Jn,divide:()=>ze,dot:()=>xr,equals:()=>Qn,exactEquals:()=>Hn,floor:()=>Sn,forEach:()=>es,fromValues:()=>pr,hermite:()=>_n,inverse:()=>On,len:()=>Br,length:()=>Re,lerp:()=>Cn,max:()=>In,min:()=>zn,mul:()=>Kn,multiply:()=>Se,negate:()=>Nn,normalize:()=>Gr,random:()=>Fn,rotateX:()=>Gn,rotateY:()=>Bn,rotateZ:()=>Xn,round:()=>bn,scale:()=>Ln,scaleAndAdd:()=>Dn,set:()=>An,sqrDist:()=>un,sqrLen:()=>rs,squaredDistance:()=>be,squaredLength:()=>Le,str:()=>Wn,sub:()=>Zn,subtract:()=>Te,transformMat3:()=>qn,transformMat4:()=>Un,transformQuat:()=>Vn,zero:()=>kn});function fr(){var r=new T(3);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function En(r){var e=new T(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Re(r){var e=r[0],t=r[1],i=r[2];return Math.hypot(e,t,i)}function pr(r,e,t){var i=new T(3);return i[0]=r,i[1]=e,i[2]=t,i}function Pn(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function An(r,e,t,i){return r[0]=e,r[1]=t,r[2]=i,r}function Rn(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function Te(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function Se(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function ze(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}function Tn(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r}function Sn(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r}function zn(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function In(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function bn(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r}function Ln(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function Dn(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r}function Ie(r,e){var t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return Math.hypot(t,i,n)}function be(r,e){var t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return t*t+i*i+n*n}function Le(r){var e=r[0],t=r[1],i=r[2];return e*e+t*t+i*i}function Nn(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function On(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function Gr(r,e){var t=e[0],i=e[1],n=e[2],s=t*t+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function xr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function sr(r,e,t){var i=e[0],n=e[1],s=e[2],a=t[0],h=t[1],o=t[2];return r[0]=n*o-s*h,r[1]=s*a-i*o,r[2]=i*h-n*a,r}function Cn(r,e,t,i){var n=e[0],s=e[1],a=e[2];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r[2]=a+i*(t[2]-a),r}function _n(r,e,t,i,n,s){var a=s*s,h=a*(2*s-3)+1,o=a*(s-2)+s,c=a*(s-1),l=a*(3-2*s);return r[0]=e[0]*h+t[0]*o+i[0]*c+n[0]*l,r[1]=e[1]*h+t[1]*o+i[1]*c+n[1]*l,r[2]=e[2]*h+t[2]*o+i[2]*c+n[2]*l,r}function Yn(r,e,t,i,n,s){var a=1-s,h=a*a,o=s*s,c=h*a,l=3*s*h,p=3*o*a,f=o*s;return r[0]=e[0]*c+t[0]*l+i[0]*p+n[0]*f,r[1]=e[1]*c+t[1]*l+i[1]*p+n[1]*f,r[2]=e[2]*c+t[2]*l+i[2]*p+n[2]*f,r}function Fn(r,e){e=e||1;var t=q()*2*Math.PI,i=q()*2-1,n=Math.sqrt(1-i*i)*e;return r[0]=Math.cos(t)*n,r[1]=Math.sin(t)*n,r[2]=i*e,r}function Un(r,e,t){var i=e[0],n=e[1],s=e[2],a=t[3]*i+t[7]*n+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*i+t[4]*n+t[8]*s+t[12])/a,r[1]=(t[1]*i+t[5]*n+t[9]*s+t[13])/a,r[2]=(t[2]*i+t[6]*n+t[10]*s+t[14])/a,r}function qn(r,e,t){var i=e[0],n=e[1],s=e[2];return r[0]=i*t[0]+n*t[3]+s*t[6],r[1]=i*t[1]+n*t[4]+s*t[7],r[2]=i*t[2]+n*t[5]+s*t[8],r}function Vn(r,e,t){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],l=n*c-s*o,p=s*h-i*c,f=i*o-n*h,x=n*f-s*p,v=s*l-i*f,g=i*p-n*l,m=a*2;return l*=m,p*=m,f*=m,x*=2,v*=2,g*=2,r[0]=h+l+x,r[1]=o+p+v,r[2]=c+f+g,r}function Gn(r,e,t,i){var n=[],s=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Bn(r,e,t,i){var n=[],s=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function Xn(r,e,t,i){var n=[],s=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function jn(r,e){var t=r[0],i=r[1],n=r[2],s=e[0],a=e[1],h=e[2],o=Math.sqrt(t*t+i*i+n*n),c=Math.sqrt(s*s+a*a+h*h),l=o*c,p=l&&xr(r,e)/l;return Math.acos(Math.min(Math.max(p,-1),1))}function kn(r){return r[0]=0,r[1]=0,r[2]=0,r}function Wn(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function Hn(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function Qn(r,e){var t=r[0],i=r[1],n=r[2],s=e[0],a=e[1],h=e[2];return Math.abs(t-s)<=y*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(i-a)<=y*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=y*Math.max(1,Math.abs(n),Math.abs(h))}var Zn=Te,Kn=Se,Jn=ze,$n=Ie,un=be,Br=Re,rs=Le,es=function(){var r=fr();return function(e,t,i,n,s,a){var h,o;for(t||(t=3),i||(i=0),n?o=Math.min(n*t+i,e.length):o=e.length,h=i;h<o;h+=t)r[0]=e[h],r[1]=e[h+1],r[2]=e[h+2],s(r,r,a),e[h]=r[0],e[h+1]=r[1],e[h+2]=r[2];return e}}();var Mr={};G(Mr,{add:()=>Hr,ceil:()=>ts,clone:()=>Xr,copy:()=>kr,create:()=>De,cross:()=>ls,dist:()=>ys,distance:()=>_e,div:()=>ds,divide:()=>Ce,dot:()=>Kr,equals:()=>ur,exactEquals:()=>$r,floor:()=>is,forEach:()=>As,fromValues:()=>jr,inverse:()=>cs,len:()=>Es,length:()=>vr,lerp:()=>Jr,max:()=>ss,min:()=>ns,mul:()=>gs,multiply:()=>Oe,negate:()=>os,normalize:()=>Zr,random:()=>fs,round:()=>as,scale:()=>Qr,scaleAndAdd:()=>hs,set:()=>Wr,sqrDist:()=>ws,sqrLen:()=>Ps,squaredDistance:()=>Ye,squaredLength:()=>mr,str:()=>ms,sub:()=>Ms,subtract:()=>Ne,transformMat4:()=>ps,transformQuat:()=>xs,zero:()=>vs});function De(){var r=new T(4);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Xr(r){var e=new T(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function jr(r,e,t,i){var n=new T(4);return n[0]=r,n[1]=e,n[2]=t,n[3]=i,n}function kr(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function Wr(r,e,t,i,n){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function Hr(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function Ne(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}function Oe(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r}function Ce(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r}function ts(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r}function is(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r}function ns(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.min(e[3],t[3]),r}function ss(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r}function as(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r[3]=Math.round(e[3]),r}function Qr(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function hs(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r}function _e(r,e){var t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2],s=e[3]-r[3];return Math.hypot(t,i,n,s)}function Ye(r,e){var t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2],s=e[3]-r[3];return t*t+i*i+n*n+s*s}function vr(r){var e=r[0],t=r[1],i=r[2],n=r[3];return Math.hypot(e,t,i,n)}function mr(r){var e=r[0],t=r[1],i=r[2],n=r[3];return e*e+t*t+i*i+n*n}function os(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r}function cs(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r}function Zr(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t*t+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=i*a,r[2]=n*a,r[3]=s*a,r}function Kr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function ls(r,e,t,i){var n=t[0]*i[1]-t[1]*i[0],s=t[0]*i[2]-t[2]*i[0],a=t[0]*i[3]-t[3]*i[0],h=t[1]*i[2]-t[2]*i[1],o=t[1]*i[3]-t[3]*i[1],c=t[2]*i[3]-t[3]*i[2],l=e[0],p=e[1],f=e[2],x=e[3];return r[0]=p*c-f*o+x*h,r[1]=-(l*c)+f*a-x*s,r[2]=l*o-p*a+x*n,r[3]=-(l*h)+p*s-f*n,r}function Jr(r,e,t,i){var n=e[0],s=e[1],a=e[2],h=e[3];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r[2]=a+i*(t[2]-a),r[3]=h+i*(t[3]-h),r}function fs(r,e){e=e||1;var t,i,n,s,a,h;do t=q()*2-1,i=q()*2-1,a=t*t+i*i;while(a>=1);do n=q()*2-1,s=q()*2-1,h=n*n+s*s;while(h>=1);var o=Math.sqrt((1-a)/h);return r[0]=e*t,r[1]=e*i,r[2]=e*n*o,r[3]=e*s*o,r}function ps(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3];return r[0]=t[0]*i+t[4]*n+t[8]*s+t[12]*a,r[1]=t[1]*i+t[5]*n+t[9]*s+t[13]*a,r[2]=t[2]*i+t[6]*n+t[10]*s+t[14]*a,r[3]=t[3]*i+t[7]*n+t[11]*s+t[15]*a,r}function xs(r,e,t){var i=e[0],n=e[1],s=e[2],a=t[0],h=t[1],o=t[2],c=t[3],l=c*i+h*s-o*n,p=c*n+o*i-a*s,f=c*s+a*n-h*i,x=-a*i-h*n-o*s;return r[0]=l*c+x*-a+p*-o-f*-h,r[1]=p*c+x*-h+f*-a-l*-o,r[2]=f*c+x*-o+l*-h-p*-a,r[3]=e[3],r}function vs(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function ms(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function $r(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}function ur(r,e){var t=r[0],i=r[1],n=r[2],s=r[3],a=e[0],h=e[1],o=e[2],c=e[3];return Math.abs(t-a)<=y*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(i-h)<=y*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-o)<=y*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=y*Math.max(1,Math.abs(s),Math.abs(c))}var Ms=Ne,gs=Oe,ds=Ce,ys=_e,ws=Ye,Es=vr,Ps=mr,As=function(){var r=De();return function(e,t,i,n,s,a){var h,o;for(t||(t=4),i||(i=0),n?o=Math.min(n*t+i,e.length):o=e.length,h=i;h<o;h+=t)r[0]=e[h],r[1]=e[h+1],r[2]=e[h+2],r[3]=e[h+3],s(r,r,a),e[h]=r[0],e[h+1]=r[1],e[h+2]=r[2],e[h+3]=r[3];return e}}();function ar(){var r=new T(4);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Rs(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Fe(r,e,t){t=t*.5;var i=Math.sin(t);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r}function Ts(r,e){var t=Math.acos(e[3])*2,i=Math.sin(t/2);return i>y?(r[0]=e[0]/i,r[1]=e[1]/i,r[2]=e[2]/i):(r[0]=1,r[1]=0,r[2]=0),t}function Ss(r,e){var t=yr(r,e);return Math.acos(2*t*t-1)}function Ue(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],l=t[3];return r[0]=i*l+a*h+n*c-s*o,r[1]=n*l+a*o+s*h-i*c,r[2]=s*l+a*c+i*o-n*h,r[3]=a*l-i*h-n*o-s*c,r}function re(r,e,t){t*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],h=Math.sin(t),o=Math.cos(t);return r[0]=i*o+a*h,r[1]=n*o+s*h,r[2]=s*o-n*h,r[3]=a*o-i*h,r}function ee(r,e,t){t*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],h=Math.sin(t),o=Math.cos(t);return r[0]=i*o-s*h,r[1]=n*o+a*h,r[2]=s*o+i*h,r[3]=a*o-n*h,r}function te(r,e,t){t*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],h=Math.sin(t),o=Math.cos(t);return r[0]=i*o+n*h,r[1]=n*o-i*h,r[2]=s*o+a*h,r[3]=a*o-s*h,r}function zs(r,e){var t=e[0],i=e[1],n=e[2];return r[0]=t,r[1]=i,r[2]=n,r[3]=Math.sqrt(Math.abs(1-t*t-i*i-n*n)),r}function qe(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=Math.sqrt(t*t+i*i+n*n),h=Math.exp(s),o=a>0?h*Math.sin(a)/a:0;return r[0]=t*o,r[1]=i*o,r[2]=n*o,r[3]=h*Math.cos(a),r}function Ve(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=Math.sqrt(t*t+i*i+n*n),h=a>0?Math.atan2(a,s)/a:0;return r[0]=t*h,r[1]=i*h,r[2]=n*h,r[3]=.5*Math.log(t*t+i*i+n*n+s*s),r}function Is(r,e,t){return Ve(r,e),Be(r,r,t),qe(r,r),r}function gr(r,e,t,i){var n=e[0],s=e[1],a=e[2],h=e[3],o=t[0],c=t[1],l=t[2],p=t[3],f,x,v,g,m;return x=n*o+s*c+a*l+h*p,x<0&&(x=-x,o=-o,c=-c,l=-l,p=-p),1-x>y?(f=Math.acos(x),v=Math.sin(f),g=Math.sin((1-i)*f)/v,m=Math.sin(i*f)/v):(g=1-i,m=i),r[0]=g*n+m*o,r[1]=g*s+m*c,r[2]=g*a+m*l,r[3]=g*h+m*p,r}function bs(r){var e=q(),t=q(),i=q(),n=Math.sqrt(1-e),s=Math.sqrt(e);return r[0]=n*Math.sin(2*Math.PI*t),r[1]=n*Math.cos(2*Math.PI*t),r[2]=s*Math.sin(2*Math.PI*i),r[3]=s*Math.cos(2*Math.PI*i),r}function Ls(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t*t+i*i+n*n+s*s,h=a?1/a:0;return r[0]=-t*h,r[1]=-i*h,r[2]=-n*h,r[3]=s*h,r}function Ds(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function Ge(r,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),r[3]=.5*i,i=.5/i,r[0]=(e[5]-e[7])*i,r[1]=(e[6]-e[2])*i,r[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[s*3+s]-e[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(e[s*3+a]-e[a*3+s])*i,r[s]=(e[s*3+n]+e[n*3+s])*i,r[a]=(e[a*3+n]+e[n*3+a])*i}return r}function Ns(r,e,t,i){var n=.5*Math.PI/180;e*=n,t*=n,i*=n;var s=Math.sin(e),a=Math.cos(e),h=Math.sin(t),o=Math.cos(t),c=Math.sin(i),l=Math.cos(i);return r[0]=s*o*l-a*h*c,r[1]=a*h*l+s*o*c,r[2]=a*o*c-s*h*l,r[3]=a*o*l+s*h*c,r}function Os(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}var Cs=Xr,_s=jr,dr=kr,Ys=Wr,Fs=Hr,Us=Ue,Be=Qr,yr=Kr,qs=Jr,wr=vr,Vs=wr,Er=mr,Gs=Er,ie=Zr,Bs=$r,Xs=ur,js=function(){var r=fr(),e=pr(1,0,0),t=pr(0,1,0);return function(i,n,s){var a=xr(n,s);return a<-.999999?(sr(r,e,n),Br(r)<1e-6&&sr(r,t,n),Gr(r,r),Fe(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(sr(r,n,s),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,ie(i,i))}}(),ks=function(){var r=ar(),e=ar();return function(t,i,n,s,a,h){return gr(r,i,a,h),gr(e,n,s,h),gr(t,r,e,2*h*(1-h)),t}}(),Ws=function(){var r=Ur();return function(e,t,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],ie(e,Ge(e,r))}}();var ne={};G(ne,{add:()=>va,clone:()=>Qs,conjugate:()=>ya,copy:()=>je,create:()=>Hs,dot:()=>We,equals:()=>Ta,exactEquals:()=>Ra,fromMat4:()=>us,fromRotation:()=>$s,fromRotationTranslation:()=>Xe,fromRotationTranslationValues:()=>Ks,fromTranslation:()=>Js,fromValues:()=>Zs,getDual:()=>ia,getReal:()=>ta,getTranslation:()=>aa,identity:()=>ra,invert:()=>da,len:()=>wa,length:()=>He,lerp:()=>ga,mul:()=>ma,multiply:()=>ke,normalize:()=>Pa,rotateAroundAxis:()=>xa,rotateByQuatAppend:()=>fa,rotateByQuatPrepend:()=>pa,rotateX:()=>oa,rotateY:()=>ca,rotateZ:()=>la,scale:()=>Ma,set:()=>ea,setDual:()=>sa,setReal:()=>na,sqrLen:()=>Ea,squaredLength:()=>Pr,str:()=>Aa,translate:()=>ha});function Hs(){var r=new T(8);return T!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r}function Qs(r){var e=new T(8);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e}function Zs(r,e,t,i,n,s,a,h){var o=new T(8);return o[0]=r,o[1]=e,o[2]=t,o[3]=i,o[4]=n,o[5]=s,o[6]=a,o[7]=h,o}function Ks(r,e,t,i,n,s,a){var h=new T(8);h[0]=r,h[1]=e,h[2]=t,h[3]=i;var o=n*.5,c=s*.5,l=a*.5;return h[4]=o*i+c*t-l*e,h[5]=c*i+l*r-o*t,h[6]=l*i+o*e-c*r,h[7]=-o*r-c*e-l*t,h}function Xe(r,e,t){var i=t[0]*.5,n=t[1]*.5,s=t[2]*.5,a=e[0],h=e[1],o=e[2],c=e[3];return r[0]=a,r[1]=h,r[2]=o,r[3]=c,r[4]=i*c+n*o-s*h,r[5]=n*c+s*a-i*o,r[6]=s*c+i*h-n*a,r[7]=-i*a-n*h-s*o,r}function Js(r,e){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=e[0]*.5,r[5]=e[1]*.5,r[6]=e[2]*.5,r[7]=0,r}function $s(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r}function us(r,e){var t=ar();Vr(t,e);var i=new T(3);return qr(i,e),Xe(r,t,i),r}function je(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r}function ra(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r}function ea(r,e,t,i,n,s,a,h,o){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=h,r[7]=o,r}var ta=dr;function ia(r,e){return r[0]=e[4],r[1]=e[5],r[2]=e[6],r[3]=e[7],r}var na=dr;function sa(r,e){return r[4]=e[0],r[5]=e[1],r[6]=e[2],r[7]=e[3],r}function aa(r,e){var t=e[4],i=e[5],n=e[6],s=e[7],a=-e[0],h=-e[1],o=-e[2],c=e[3];return r[0]=(t*c+s*a+i*o-n*h)*2,r[1]=(i*c+s*h+n*a-t*o)*2,r[2]=(n*c+s*o+t*h-i*a)*2,r}function ha(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0]*.5,o=t[1]*.5,c=t[2]*.5,l=e[4],p=e[5],f=e[6],x=e[7];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=a*h+n*c-s*o+l,r[5]=a*o+s*h-i*c+p,r[6]=a*c+i*o-n*h+f,r[7]=-i*h-n*o-s*c+x,r}function oa(r,e,t){var i=-e[0],n=-e[1],s=-e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=h*a+l*i+o*s-c*n,f=o*a+l*n+c*i-h*s,x=c*a+l*s+h*n-o*i,v=l*a-h*i-o*n-c*s;return re(r,e,t),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=p*a+v*i+f*s-x*n,r[5]=f*a+v*n+x*i-p*s,r[6]=x*a+v*s+p*n-f*i,r[7]=v*a-p*i-f*n-x*s,r}function ca(r,e,t){var i=-e[0],n=-e[1],s=-e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=h*a+l*i+o*s-c*n,f=o*a+l*n+c*i-h*s,x=c*a+l*s+h*n-o*i,v=l*a-h*i-o*n-c*s;return ee(r,e,t),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=p*a+v*i+f*s-x*n,r[5]=f*a+v*n+x*i-p*s,r[6]=x*a+v*s+p*n-f*i,r[7]=v*a-p*i-f*n-x*s,r}function la(r,e,t){var i=-e[0],n=-e[1],s=-e[2],a=e[3],h=e[4],o=e[5],c=e[6],l=e[7],p=h*a+l*i+o*s-c*n,f=o*a+l*n+c*i-h*s,x=c*a+l*s+h*n-o*i,v=l*a-h*i-o*n-c*s;return te(r,e,t),i=r[0],n=r[1],s=r[2],a=r[3],r[4]=p*a+v*i+f*s-x*n,r[5]=f*a+v*n+x*i-p*s,r[6]=x*a+v*s+p*n-f*i,r[7]=v*a-p*i-f*n-x*s,r}function fa(r,e,t){var i=t[0],n=t[1],s=t[2],a=t[3],h=e[0],o=e[1],c=e[2],l=e[3];return r[0]=h*a+l*i+o*s-c*n,r[1]=o*a+l*n+c*i-h*s,r[2]=c*a+l*s+h*n-o*i,r[3]=l*a-h*i-o*n-c*s,h=e[4],o=e[5],c=e[6],l=e[7],r[4]=h*a+l*i+o*s-c*n,r[5]=o*a+l*n+c*i-h*s,r[6]=c*a+l*s+h*n-o*i,r[7]=l*a-h*i-o*n-c*s,r}function pa(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[0],o=t[1],c=t[2],l=t[3];return r[0]=i*l+a*h+n*c-s*o,r[1]=n*l+a*o+s*h-i*c,r[2]=s*l+a*c+i*o-n*h,r[3]=a*l-i*h-n*o-s*c,h=t[4],o=t[5],c=t[6],l=t[7],r[4]=i*l+a*h+n*c-s*o,r[5]=n*l+a*o+s*h-i*c,r[6]=s*l+a*c+i*o-n*h,r[7]=a*l-i*h-n*o-s*c,r}function xa(r,e,t,i){if(Math.abs(i)<y)return je(r,e);var n=Math.hypot(t[0],t[1],t[2]);i=i*.5;var s=Math.sin(i),a=s*t[0]/n,h=s*t[1]/n,o=s*t[2]/n,c=Math.cos(i),l=e[0],p=e[1],f=e[2],x=e[3];r[0]=l*c+x*a+p*o-f*h,r[1]=p*c+x*h+f*a-l*o,r[2]=f*c+x*o+l*h-p*a,r[3]=x*c-l*a-p*h-f*o;var v=e[4],g=e[5],m=e[6],d=e[7];return r[4]=v*c+d*a+g*o-m*h,r[5]=g*c+d*h+m*a-v*o,r[6]=m*c+d*o+v*h-g*a,r[7]=d*c-v*a-g*h-m*o,r}function va(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r}function ke(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],h=t[4],o=t[5],c=t[6],l=t[7],p=e[4],f=e[5],x=e[6],v=e[7],g=t[0],m=t[1],d=t[2],E=t[3];return r[0]=i*E+a*g+n*d-s*m,r[1]=n*E+a*m+s*g-i*d,r[2]=s*E+a*d+i*m-n*g,r[3]=a*E-i*g-n*m-s*d,r[4]=i*l+a*h+n*c-s*o+p*E+v*g+f*d-x*m,r[5]=n*l+a*o+s*h-i*c+f*E+v*m+x*g-p*d,r[6]=s*l+a*c+i*o-n*h+x*E+v*d+p*m-f*g,r[7]=a*l-i*h-n*o-s*c+v*E-p*g-f*m-x*d,r}var ma=ke;function Ma(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r}var We=yr;function ga(r,e,t,i){var n=1-i;return We(e,t)<0&&(i=-i),r[0]=e[0]*n+t[0]*i,r[1]=e[1]*n+t[1]*i,r[2]=e[2]*n+t[2]*i,r[3]=e[3]*n+t[3]*i,r[4]=e[4]*n+t[4]*i,r[5]=e[5]*n+t[5]*i,r[6]=e[6]*n+t[6]*i,r[7]=e[7]*n+t[7]*i,r}function da(r,e){var t=Pr(e);return r[0]=-e[0]/t,r[1]=-e[1]/t,r[2]=-e[2]/t,r[3]=e[3]/t,r[4]=-e[4]/t,r[5]=-e[5]/t,r[6]=-e[6]/t,r[7]=e[7]/t,r}function ya(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[7]=e[7],r}var He=wr,wa=He,Pr=Er,Ea=Pr;function Pa(r,e){var t=Pr(e);if(t>0){t=Math.sqrt(t);var i=e[0]/t,n=e[1]/t,s=e[2]/t,a=e[3]/t,h=e[4],o=e[5],c=e[6],l=e[7],p=i*h+n*o+s*c+a*l;r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=(h-i*p)/t,r[5]=(o-n*p)/t,r[6]=(c-s*p)/t,r[7]=(l-a*p)/t}return r}function Aa(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"}function Ra(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]}function Ta(r,e){var t=r[0],i=r[1],n=r[2],s=r[3],a=r[4],h=r[5],o=r[6],c=r[7],l=e[0],p=e[1],f=e[2],x=e[3],v=e[4],g=e[5],m=e[6],d=e[7];return Math.abs(t-l)<=y*Math.max(1,Math.abs(t),Math.abs(l))&&Math.abs(i-p)<=y*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-f)<=y*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-x)<=y*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-v)<=y*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-g)<=y*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(o-m)<=y*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(c-d)<=y*Math.max(1,Math.abs(c),Math.abs(d))}var W={};G(W,{add:()=>La,angle:()=>Ka,ceil:()=>Da,clone:()=>Sa,copy:()=>Ia,create:()=>Qe,cross:()=>Ba,dist:()=>s1,distance:()=>$e,div:()=>n1,divide:()=>Je,dot:()=>Ga,equals:()=>r1,exactEquals:()=>ua,floor:()=>Na,forEach:()=>o1,fromValues:()=>za,inverse:()=>qa,len:()=>e1,length:()=>rt,lerp:()=>Xa,max:()=>Ca,min:()=>Oa,mul:()=>i1,multiply:()=>Ke,negate:()=>Ua,normalize:()=>Va,random:()=>ja,rotate:()=>Za,round:()=>_a,scale:()=>Ya,scaleAndAdd:()=>Fa,set:()=>ba,sqrDist:()=>a1,sqrLen:()=>h1,squaredDistance:()=>ue,squaredLength:()=>et,str:()=>$a,sub:()=>t1,subtract:()=>Ze,transformMat2:()=>ka,transformMat2d:()=>Wa,transformMat3:()=>Ha,transformMat4:()=>Qa,zero:()=>Ja});function Qe(){var r=new T(2);return T!=Float32Array&&(r[0]=0,r[1]=0),r}function Sa(r){var e=new T(2);return e[0]=r[0],e[1]=r[1],e}function za(r,e){var t=new T(2);return t[0]=r,t[1]=e,t}function Ia(r,e){return r[0]=e[0],r[1]=e[1],r}function ba(r,e,t){return r[0]=e,r[1]=t,r}function La(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function Ze(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r}function Ke(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r}function Je(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r}function Da(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r}function Na(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r}function Oa(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r}function Ca(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r}function _a(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r}function Ya(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r}function Fa(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r}function $e(r,e){var t=e[0]-r[0],i=e[1]-r[1];return Math.hypot(t,i)}function ue(r,e){var t=e[0]-r[0],i=e[1]-r[1];return t*t+i*i}function rt(r){var e=r[0],t=r[1];return Math.hypot(e,t)}function et(r){var e=r[0],t=r[1];return e*e+t*t}function Ua(r,e){return r[0]=-e[0],r[1]=-e[1],r}function qa(r,e){return r[0]=1/e[0],r[1]=1/e[1],r}function Va(r,e){var t=e[0],i=e[1],n=t*t+i*i;return n>0&&(n=1/Math.sqrt(n)),r[0]=e[0]*n,r[1]=e[1]*n,r}function Ga(r,e){return r[0]*e[0]+r[1]*e[1]}function Ba(r,e,t){var i=e[0]*t[1]-e[1]*t[0];return r[0]=r[1]=0,r[2]=i,r}function Xa(r,e,t,i){var n=e[0],s=e[1];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r}function ja(r,e){e=e||1;var t=q()*2*Math.PI;return r[0]=Math.cos(t)*e,r[1]=Math.sin(t)*e,r}function ka(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r}function Wa(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n+t[4],r[1]=t[1]*i+t[3]*n+t[5],r}function Ha(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[3]*n+t[6],r[1]=t[1]*i+t[4]*n+t[7],r}function Qa(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[4]*n+t[12],r[1]=t[1]*i+t[5]*n+t[13],r}function Za(r,e,t,i){var n=e[0]-t[0],s=e[1]-t[1],a=Math.sin(i),h=Math.cos(i);return r[0]=n*h-s*a+t[0],r[1]=n*a+s*h+t[1],r}function Ka(r,e){var t=r[0],i=r[1],n=e[0],s=e[1],a=Math.sqrt(t*t+i*i)*Math.sqrt(n*n+s*s),h=a&&(t*n+i*s)/a;return Math.acos(Math.min(Math.max(h,-1),1))}function Ja(r){return r[0]=0,r[1]=0,r}function $a(r){return"vec2("+r[0]+", "+r[1]+")"}function ua(r,e){return r[0]===e[0]&&r[1]===e[1]}function r1(r,e){var t=r[0],i=r[1],n=e[0],s=e[1];return Math.abs(t-n)<=y*Math.max(1,Math.abs(t),Math.abs(n))&&Math.abs(i-s)<=y*Math.max(1,Math.abs(i),Math.abs(s))}var e1=rt,t1=Ze,i1=Ke,n1=Je,s1=$e,a1=ue,h1=et,o1=function(){var r=Qe();return function(e,t,i,n,s,a){var h,o;for(t||(t=2),i||(i=0),n?o=Math.min(n*t+i,e.length):o=e.length,h=i;h<o;h+=t)r[0]=e[h],r[1]=e[h+1],s(r,r,a),e[h]=r[0],e[h+1]=r[1];return e}}();var Q=class{position=z.fromValues(0,0,-1);direction=z.fromValues(0,0,-1);up=z.fromValues(0,1,0);projectionMatrix=I.create();viewMatrix=I.create();cameraMatrix=I.create();viewportWidth=0;viewportHeight=0;near=1;far=100;tpmVec=z.create();constructor(){}lookAt(...e){if(e.length==1)z.copy(this.tpmVec,e[0]);else if(e.length==3)z.set(this.tpmVec,...e);else throw new Error("required 1 or 3 arguments");z.sub(this.tpmVec,this.tpmVec,this.position),z.normalize(this.tpmVec,this.tpmVec);let t=z.dot(this.tpmVec,this.up);V.equals(t,1)?z.negate(this.up,this.direction):V.equals(t,-1)&&z.copy(this.up,this.direction),z.copy(this.direction,this.tpmVec),z.cross(this.up,this.getRight(),this.direction),z.normalize(this.up,this.up)}getRight(){return z.cross(this.tpmVec,this.direction,this.up)}updateConstants(e){I.lookAt(this.viewMatrix,this.position,z.add(this.tpmVec,this.position,this.direction),this.up),I.invert(this.cameraMatrix,this.viewMatrix),e.projectionMatrix=this.projectionMatrix,e.viewMatrix=this.viewMatrix,e.cameraMatrix=this.cameraMatrix,e.cameraPosition=this.position}};var F=class{buffers=new Map;indexCount=0;options;constructor(e={}){this.options=e,this.onInit()}onInit(){}createBuffer(e,t){let i={size:t,data:[],buffer:null};return this.buffers.set(e,i),i}getBuffer(e){return this.buffers.get(e)}bufferData(e,t,i){this.buffers.set(i,{size:t,data:e,buffer:null})}initBuffer(e){let t=this.buffers.get(e);t.buffer==null&&(t.buffer=M.gl.createBuffer()),e=="index"?(M.gl.bindBuffer(M.gl.ELEMENT_ARRAY_BUFFER,t.buffer),M.gl.bufferData(M.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.data),M.gl.STATIC_DRAW),this.indexCount=t.data.length):(M.gl.bindBuffer(M.gl.ARRAY_BUFFER,t.buffer),M.gl.bufferData(M.gl.ARRAY_BUFFER,new Float32Array(t.data),M.gl.STATIC_DRAW))}bind(e){this.buffers.forEach((t,i)=>{let n=e.shaderData.attribs[i];n!=-1&&(t.buffer==null&&this.initBuffer(i),i=="index"?M.gl.bindBuffer(M.gl.ELEMENT_ARRAY_BUFFER,t.buffer):(M.gl.bindBuffer(M.gl.ARRAY_BUFFER,t.buffer),M.gl.vertexAttribPointer(n,t.size,M.gl.FLOAT,!1,0,0),M.gl.enableVertexAttribArray(n)))})}draw(){M.gl.drawElements(M.gl.TRIANGLES,this.indexCount,M.gl.UNSIGNED_SHORT,0)}unbind(e){this.buffers.forEach((t,i)=>{let n=e.shaderData.attribs[i];n!=-1&&i!="index"&&M.gl.disableVertexAttribArray(n)})}};var j=class{shaderData;uniforms=new Map;constructor(e){this.shaderData=e,this.setUniform("uvOffset",[0,0])}setUniform(e,t){this.uniforms.set(e,t)}activate(){this.shaderData.activate()}bind(e){for(let t of this.shaderData.uniforms){let i=e[t.name];if(this.uniforms.has(t.name)&&(i=this.uniforms.get(t.name)),i&&t.location){let n=t.type,s=t.location;switch(n){case"mat4":M.gl.uniformMatrix4fv(s,!1,i);break;case"mat3":M.gl.uniformMatrix3fv(s,!1,val);break;case"vec4":M.gl.uniform4fv(s,i);break;case"vec3":M.gl.uniform3fv(s,i);break;case"vec2":M.gl.uniform2fv(s,i);break;case"float":M.gl.uniform1f(s,i);break}}}}};var k=class{mesh;shader;texture;position=z.create();rotation=J.create();scale=z.fromValues(1,1,1);parent=null;modelMatrix=I.create();normalMatrix=I.create();matrixAutoUpdate=!0;matrixNeedsUpdate=!0;constructor(e,t,i){this.mesh=e,this.shader=t,this.texture=i}updateMatrix(){(this.matrixNeedsUpdate||this.matrixAutoUpdate)&&(this.matrixNeedsUpdate=!1,I.fromRotationTranslationScale(this.modelMatrix,this.rotation,this.position,this.scale),H.fromMat4(this.normalMatrix,this.modelMatrix),H.invert(this.normalMatrix,this.normalMatrix),H.transpose(this.normalMatrix,this.normalMatrix))}draw(e){this.shader.activate(),this.texture&&this.texture.bind(),this.updateMatrix();let t=e.viewMatrix,i=I.create();I.multiply(i,t,this.modelMatrix),this.shader.setUniform("modelViewMatrix",i),this.shader.setUniform("modelMatrix",this.modelMatrix),this.shader.setUniform("normalMatrix",this.normalMatrix),this.shader.bind(e),this.mesh.bind(this.shader),this.mesh.draw(),this.mesh.unbind(this.shader)}};var Ar=class extends Q{fov;constructor(e,t,i,n,s){super(),this.fov=e,this.viewportWidth=t,this.viewportHeight=i,this.near=n,this.far=s,this.updateProjection()}updateProjection(){let e=this.viewportWidth/this.viewportHeight;I.perspective(this.projectionMatrix,this.fov/180*Math.PI,e,this.near,this.far)}};var se={};G(se,{Cube:()=>Rr,Plane:()=>$,Quad:()=>u,Sphere:()=>Tr});var Rr=class extends F{onInit(){let e=this.options.width?this.options.width/2:.5,t=this.options.height?this.options.height/2:.5,i=this.options.depth?this.options.depth/2:.5,n=[-e,t,i,e,t,i,e,-t,i,-e,-t,i,-e,t,-i,e,t,-i,e,-t,-i,-e,-t,-i,-e,t,-i,e,t,-i,e,t,i,-e,t,i,-e,-t,i,e,-t,i,e,-t,-i,-e,-t,-i,e,t,i,e,t,-i,e,-t,-i,e,-t,i,-e,t,-i,-e,t,i,-e,-t,i,-e,-t,-i],s=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],a="single";this.options.textureFaces!==void 0&&(a=this.options.textureFaces);let h=[];if(a=="single")for(let p=0;p<6;++p)h.push(0,0,1,0,1,1,0,1);else if(a=="multiple"){let x=(v,g)=>{h.push(v*.25,g*.5,.25*(v+1),g*.5,.25*(v+1),.5*(g+1),v*.25,.5*(g+1))};x(1,0),x(3,0),x(0,1),x(1,1),x(2,0),x(0,0)}else throw new Error("options.textureFaces valid values are single or multiple");let o=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],c=[];if(this.options.colors===void 0)for(let p=0;p<24;++p)c.push(1);else if(this.options.colors.length==1){let p=this.options.colors[0];for(let f=0;f<24;++f)c.push(p[f%4])}else if(this.options.colors.length==6)for(let p=0;p<6;++p){let f=this.options.colors[p];for(let x=0;x<4;++x)c.push(f[x])}else throw new Error("options.colors requires 1 or 6 elements");let l=[];for(let p=0;p<6;++p)for(let f=0;f<4;++f)for(let x=0;x<4;++x)l.push(c[p*4+x]);this.bufferData(n,3,"positions"),this.bufferData(s,3,"normals"),this.bufferData(l,4,"colors"),this.bufferData(h,2,"uvs"),this.bufferData(o,0,"index")}};var $=class extends F{onInit(){let e=this.options.width?this.options.width/2:.5,t=this.options.depth?this.options.depth/2:.5,i=this.options.widthSegments||1,n=this.options.depthSegments||1,s=this.options.heightMap||$.generateHeightMap(i,n),a=[],h=[],o=[],c=[],l=[];for(let p=0;p<n;++p)for(let f=0;f<i;++f){a.push((2*f/i-1)*e,s[p][f],(2*p/n-1)*t,(2*(f+1)/i-1)*e,s[p][f+1],(2*p/n-1)*t,(2*(f+1)/i-1)*e,s[p+1][f+1],(2*(p+1)/n-1)*t,(2*f/i-1)*e,s[p+1][f],(2*(p+1)/n-1)*t),h.push(0,1,0,0,1,0,0,1,0,0,1,0),this.options.textureRepeat===void 0||this.options.textureRepeat===!1?o.push(f/i,p/n,(f+1)/i,p/n,(f+1)/i,(p+1)/n,f/i,(p+1)/n):o.push(0,0,1,0,1,1,0,1);let x=(p*i+f)*4;l.push(x,x+1,x+2,x,x+2,x+3)}if(this.options.colors===void 0)for(let p=0;p<i*n*16;++p)c.push(1);else if(typeof this.options.colors=="function"){let p=this.options.colors,f=[];for(let x=0;x<=n;++x){f.push([]);for(let v=0;v<=i;++v){let g=p(v/i*e*2-e,s[x][v],x/n*t*2-t);f[x].push(g)}}for(let x=0;x<n;++x)for(let v=0;v<i;++v)c.push(...f[x][v],...f[x][v+1],...f[x+1][v+1],...f[x+1][v])}else if(this.options.colors.length==1){let p=this.options.colors[0];for(let f=0;f<i*n*16;++f)c.push(p[f%4])}else throw new Error("options.colors requires 1 elements");this.bufferData(a,3,"positions"),this.bufferData(h,3,"normals"),this.bufferData(c,4,"colors"),this.bufferData(o,2,"uvs"),this.bufferData(l,0,"index")}static generateHeightMap(e,t){return[...new Array(t+1)].map(i=>[...new Array(e+1)].fill(0))}};var u=class extends F{onInit(){let e=this.options.width?this.options.width/2:.5,t=this.options.height?this.options.height/2:.5,i=[-e,t,0,e,t,0,e,-t,0,-e,-t,0],n=[0,0,1,0,0,1,0,0,1,0,0,1],s=[];if(this.options.colors===void 0)for(let o=0;o<16;++o)s.push(1);else if(this.options.colors.length==1){let o=this.options.colors[0];for(let c=0;c<16;++c)s.push(o[c%4])}else if(this.options.colors.length==4)for(let o=0;o<4;++o){let c=this.options.colors[o];for(let l=0;l<4;++l)s.push(c[l])}else throw new Error("options.colors requires 1 or 4 elements");let a=[0,0,1,0,1,1,0,1],h=[0,1,2,0,2,3];this.bufferData(i,3,"positions"),this.bufferData(n,3,"normals"),this.bufferData(s,4,"colors"),this.bufferData(a,2,"uvs"),this.bufferData(h,0,"index")}};var rr=class{points=[];constructor(e){this.lerp=e}addPoint(e,t){this.points.push([e,t]);for(let i=this.points.length-1;i>0&&!(this.points[i][0]>=this.points[i-1][0]);--i)[this.points[i],this.points[i-1]]=[this.points[i-1],this.points[i]]}getValue(e){let t=0;for(let a=0;a<this.points.length&&!(e<this.points[a][0]);++a)t=a;let i=this.points[t],n=Math.min(t+1,this.points.length-1);if(t==n)return i[1];let s=this.points[n];return this.lerp((e-i[0])/(s[0]-i[0]),i[1],s[1])}};var Tr=class extends F{onInit(){let e=this.options.radius||.5,t=this.options.widthSegments||32,i=this.options.heightSegments||16,n=[],s=[],a=[],h=[],o=[],c=[],l=[];for(let f=0;f<=i;++f){let x=f/i*Math.PI,v=Math.sin(x),g=Math.cos(x);for(let m=0;m<=t;++m){let d=m/t*2*Math.PI,E=Math.sin(d),w=Math.cos(d);o.push([v*w*e,g*e,v*E*e]),c.push([1-m/t,f/i])}}if(this.options.colors===void 0)for(let f=0;f<(t+1)*(i+1);++f)l.push([1,1,1,1]);else if(this.options.colors instanceof rr)for(let f=0;f<=i;++f){let x=this.options.colors.getValue(f/i);for(let v=0;v<=t;++v)l.push(x)}else if(this.options.colors.length==1){let f=this.options.colors[0];for(let x=0;x<(t+1)*(i+1);++x)l.push(f)}else throw new Error("options.colors requires 1 elements");let p=0;for(let f=0;f<i;++f)for(let x=0;x<t;++x){let v=f*(t+1)+x,g=v+(t+1),m=[v,v+1,g+1,g];for(let d of m)n.push(...o[d]),s.push(...c[d]),a.push(...l[d]);h.push(p,p+1,p+2,p,p+2,p+3),p+=4}this.bufferData(n,3,"positions"),this.bufferData(a,4,"colors"),this.bufferData(s,2,"uvs"),this.bufferData(h,0,"index")}};var Sr=class extends Q{zoom=1;constructor(e,t){super(),this.near=0,this.setToOrtho(e,t)}setToOrtho(e,t){this.viewportWidth=e,this.viewportHeight=t,z.set(this.position,this.zoom*e/2,this.zoom*t/2,0),this.updateProjection()}updateProjection(){I.ortho(this.projectionMatrix,this.zoom*-this.viewportWidth/2,this.zoom*this.viewportWidth/2,this.zoom*-this.viewportHeight/2,this.zoom*this.viewportHeight/2,this.near,this.far)}translate(...e){if(e.length==1)z.set(this.position,...e[0],0);else if(e.length==2)z.set(this.position,e[0],e[1],0);else throw new Error("required 1 or 2 arguments")}zoomBy(...e){let t=e[0];if(this.zoom*=1+t,e.length==2||e.length==3){let i=W.create();e.length==2?W.copy(i,e[1]):W.set(i,...e),W.sub(i,i,this.position),W.scale(i,i,t),z.add(this.position,this.position,[...i,0])}}};var zr=class extends k{regionX;regionY;regionWidth;regionHeight;constructor(...e){let t=e[0],i=0,n=0,s=t.width,a=t.height;e.length==3?(s=e[1],a=e[2]):e.length==5&&(i=e[1],n=e[2],s=e[3],a=e[4]),super(new u,new j(M.graphics.getShader("texture")),t),this.setRegion(i,n,s,a)}setRegion(e,t,i,n){this.regionX=e,this.regionY=t,this.regionWidth=i,this.regionHeight=n;let s=this.texture.width,a=this.texture.height,h=[e/s,t/a,(e+i)/s,t/a,(e+i)/s,(t+n)/a,e/s,(t+n)/a];this.mesh.bufferData(h,2,"uvs")}setRegionSize(e,t){this.regionWidth=e,this.regionHeight=t;let i=[0,0,e/this.texture.width,0,e/this.texture.width,t/this.texture.height,0,t/this.texture.height];this.mesh.bufferData(i,2,"uvs")}setRegionPosition(e,t){this.regionX=e,this.regionY=t,this.shader.setUniform("uvOffset",[e/this.texture.width,t/this.texture.height])}};var Ir=class extends k{font;text;rainbow;constructor(e,t="",i=!1){super(new F,new j(M.graphics.getShader("texture")),e.texture),this.font=e,this.text=t,this.rainbow=i,this.updateGeometry()}updateGeometry(){let e=[],t=[],i=[],n=[],s=this.font.charWidth,a=this.font.charHeight,h=this.font.options.charRatio,o=(1-this.text.length)*h*.5;for(let c=0;c<this.text.length;++c){let l=this.text.charCodeAt(c),p=this.font.getCharPosition(l);if(p===null)continue;let[f,x]=p;e.push(-.5*h+o,.5,0,.5*h+o,.5,0,.5*h+o,-.5,0,-.5*h+o,-.5,0),i.push(f/this.texture.width,x/this.texture.height,(f+s)/this.texture.width,x/this.texture.height,(f+s)/this.texture.width,(x+a)/this.texture.height,f/this.texture.width,(x+a)/this.texture.height);let v=c*4;n.push(v,v+1,v+2,v,v+2,v+3),o+=h}if(this.rainbow)for(let c=0;c<4*this.text.length;++c)t.push(Math.random(),Math.random(),Math.random(),1);else for(let c=0;c<4*this.text.length;++c)t.push(1,1,1,1);this.mesh.bufferData(e,3,"positions"),this.mesh.bufferData(t,4,"colors"),this.mesh.bufferData(i,2,"uvs"),this.mesh.bufferData(n,0,"index")}setText(e){this.text=e,this.updateGeometry()}};var br=class{position;velocity;color;alpha;size;life;maxLife;constructor(e){this.position=e.position,this.maxLife=e.life,this.life=e.life,this.size=e.size!==void 0?e.size:1,this.velocity=e.velocity||[0,0,0],this.color=e.color||[1,1,1],this.alpha=e.alpha!==void 0?e.alpha:1}update(){this.life-=M.graphics.delta*1e3}},Lr=class{mesh;texture;shader;particles=[];constructor(e){this.mesh=new F,this.texture=e.texture,this.shader=new j(M.graphics.getShader("particle")),this.onScreenResize(M.graphics.width,M.graphics.height)}onScreenResize(e,t){this.shader.setUniform("pointMultiplier",t/2*Math.tan(30*Math.PI/180))}addParticles(){}updateParticles(){}updateGeometry(){let e=[],t=[],i=[];for(let n of this.particles)e.push(...n.position),t.push(...n.color,n.alpha),i.push(n.size);this.mesh.bufferData(e,3,"positions"),this.mesh.bufferData(t,4,"colors"),this.mesh.bufferData(i,1,"sizes")}draw(e){this.shader.activate(),this.texture.bind();let t=I.create(),i=e.viewMatrix,n=I.create();I.multiply(n,i,t),this.shader.setUniform("modelViewMatrix",n),this.shader.bind(e),this.mesh.bind(this.shader);let s=this.particles.length;M.gl.drawArrays(M.gl.POINTS,0,s),this.mesh.unbind(this.shader)}update(){this.addParticles(),this.updateParticles(),this.updateGeometry()}};var ae=class{mesh=new F;shader;idx=0;texture=null;constants={projectionMatrix:I.create(),viewMatrix:I.create(),cameraMatrix:I.create(),cameraPosition:z.create()};constructor(e){this.shader=e,e.shaderData.attribs.index!=-1&&this.mesh.createBuffer("index",0),e.shaderData.attribs.positions!=-1&&this.mesh.createBuffer("positions",3),e.shaderData.attribs.uvs!=-1&&this.mesh.createBuffer("uvs",2),e.shaderData.attribs.colors!=-1&&this.mesh.createBuffer("colors",4)}setConstants(e){this.constants={...e}}begin(){this.idx=0,this.mesh.buffers.forEach(e=>{e.data.length=0}),this.texture=null}draw(e){let t=e.mesh.getBuffer("positions").data.length/3;(this.idx+t>ae.MAX_COUNT||e.texture!=this.texture)&&this.flush(),this.texture=e.texture,e.updateMatrix(),this.mesh.buffers.forEach((i,n)=>{let s=e.mesh.getBuffer(n).data;switch(n){case"positions":for(let a=0;a<s.length;a+=3){let h=z.fromValues(s[a],s[a+1],s[a+2]);z.transformMat4(h,h,e.modelMatrix);for(let o=0;o<3;++o)i.data.push(h[o])}break;case"index":for(let a=0;a<s.length;++a)i.data.push(s[a]+this.idx);break;default:for(let a=0;a<s.length;++a)i.data.push(s[a])}}),this.idx+=t}end(){this.flush()}flush(){if(this.idx==0)return;this.mesh.buffers.forEach((s,a)=>{this.mesh.initBuffer(a)}),this.shader.activate(),this.texture&&this.texture.bind();let e=I.create(),t=I.create(),i=this.constants.viewMatrix,n=I.create();I.multiply(n,i,e),this.shader.setUniform("modelViewMatrix",n),this.shader.setUniform("modelMatrix",e),this.shader.setUniform("normalMatrix",t),this.shader.bind(this.constants),this.mesh.bind(this.shader),this.mesh.draw(),this.mesh.unbind(this.shader),this.idx=0,this.mesh.buffers.forEach(s=>{s.data.length=0})}},hr=ae;U(hr,"MAX_COUNT",65536);var Dr=class extends k{idx=0;constructor(e,t){super(new F,e,t),e.shaderData.attribs.index!=-1&&this.mesh.createBuffer("index",0),e.shaderData.attribs.positions!=-1&&this.mesh.createBuffer("positions",3),e.shaderData.attribs.uvs!=-1&&this.mesh.createBuffer("uvs",2),e.shaderData.attribs.colors!=-1&&this.mesh.createBuffer("colors",4)}add(e){e.updateMatrix(),this.mesh.buffers.forEach((t,i)=>{let n=e.mesh.getBuffer(i).data;switch(i){case"positions":for(let s=0;s<n.length;s+=3){let a=z.fromValues(n[s],n[s+1],n[s+2]);z.transformMat4(a,a,e.modelMatrix);for(let h=0;h<3;++h)t.data.push(a[h])}break;case"index":for(let s=0;s<n.length;++s)t.data.push(n[s]+this.idx);break;default:for(let s=0;s<n.length;++s)t.data.push(n[s])}}),this.idx+=count}};var he=class{touchInfo=[];keyInfo={currentlyPressed:new Set,previouslyPressed:new Set,justPressed:new Set};constructor(){for(let e=0;e<he.MAX_TOUCHES;++e)this.touchInfo[e]={x:null,y:null,isTouched:!1,wasTouched:!1,isJustTouched:!1}}isKeyPressed(e){return this.keyInfo.currentlyPressed.has(e)}isKeyClicked(e){return this.keyInfo.justPressed.has(e)}isTouched(e=0){return this.touchInfo[e].isTouched}isJustTouched(e=0){return this.touchInfo[e].isJustTouched}isMousePressed(){return this.isTouched()}isMouseClicked(){return this.isJustTouched()}getX(e=0){return this.touchInfo[e].x}getY(e=0){return this.touchInfo[e].y}initEvents(){let e=M.graphics.canvas;addEventListener("keydown",t=>this.onKeyDown(t)),addEventListener("keyup",t=>this.onKeyUp(t)),e.addEventListener("touchstart",t=>this.handleTouchEvent(t)),e.addEventListener("touchmove",t=>this.handleTouchEvent(t)),e.addEventListener("touchend",t=>this.handleTouchEvent(t)),e.addEventListener("mousedown",t=>this.handleMouseEvent(t)),e.addEventListener("mousemove",t=>this.handleMouseEvent(t)),e.addEventListener("mouseup",t=>this.handleMouseEvent(t))}handleTouchEvent(e){let t=e.target.getBoundingClientRect();for(let i of e.changedTouches){let n=i.pageX-t.x,s=i.pageY-t.y,a=this.touchInfo[i.identifier];switch(a.x=n,a.y=t.height-s,e.type){case"touchstart":a.isTouched=!0;break;case"touchend":a.isTouched=!1}}}handleMouseEvent(e){let t=e.target.getBoundingClientRect(),i=e.pageX-t.x,n=e.pageY-t.y,s=this.touchInfo[0];switch(s.x=i,s.y=t.height-n,e.type){case"mousedown":s.isTouched=!0;break;case"mouseup":s.isTouched=!1}}onKeyDown(e){this.keyInfo.currentlyPressed.add(e.code)}onKeyUp(e){this.keyInfo.currentlyPressed.delete(e.code)}update(){this.keyInfo.currentlyPressed.forEach(e=>{this.keyInfo.previouslyPressed.has(e)||this.keyInfo.justPressed.add(e)}),this.keyInfo.previouslyPressed=new Set(this.keyInfo.currentlyPressed);for(let e of this.touchInfo)e.isJustTouched=e.isTouched&&!e.wasTouched,e.wasTouched=e.isTouched}},or=he;U(or,"MAX_TOUCHES",10);var nt={};G(nt,{LinearSpline:()=>rr,MathUtils:()=>B,Rectangle:()=>er});var er=class{x;y;width;height;constructor(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}setPosition(...e){if(e.length==1)this.x=e[0][0],this.y=e[0][1];else if(e.length==2)this.x=e[0],this.y=e[1];else throw new Error("1 or 2 arguments required");return this}setSize(...e){if(e.length==1)this.width=e[0][0],this.height=e[0][1];else if(e.length==2)this.width=e[0],this.height=e[1];else throw new Error("1 or 2 arguments required");return this}copy(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}clone(){return new er(this.x,this.y,this.width,this.height)}containsPoint(...e){let t,i;if(e.length==2)t=e[0],i=e[1];else if(e.length==1)t=e[0][0],i=e[0][1];else throw new Error("1 or 2 arguments required");return this.x<=t&&this.x+this.width>=t&&this.y<=i&&this.y+this.height>=i}containsRectangle(e){let t=e.x,i=t+e.width,n=e.y,s=n+e.height;return t>this.x&&t<this.x+this.width&&i>this.x&&i<this.x+this.width&&n>this.y&&n<this.y+this.height&&s>this.y&&s<this.y+this.height}overlaps(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}area(){return this.width*this.height}perimeter(){return(this.width+this.height)*2}};var Nr=class{audioContext;bgMusicNode=null;masterGain;bgMusicGain;cueGain;constructor(){this.audioContext=new AudioContext,this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.masterGain.gain.value=1,this.bgMusicGain=this.audioContext.createGain(),this.bgMusicGain.connect(this.masterGain),this.bgMusicGain.gain.value=1,this.cueGain=this.audioContext.createGain(),this.cueGain.connect(this.masterGain),this.cueGain.gain.value=1}get masterVolume(){return this.masterGain.gain.value}set masterVolume(e){this.masterGain.gain.value=B.sat(e)}get bgMusicVolume(){return this.bgMusicGain.gain.value}set bgMusicVolume(e){this.bgMusicGain.gain.value=B.sat(e)}get cueVolume(){return this.cueGain.gain.value}set cueVolume(e){this.cueGain.gain.value=B.sat(e)}playBgMusic(e,t={}){let i=t.loop===void 0?!0:t.loop,n=t.time===void 0?0:t.time,s=M.files.get(e);this.stopBgMusic(),this.bgMusicNode=this.audioContext.createBufferSource(),this.bgMusicNode.buffer=s,this.bgMusicNode.loop=i,this.bgMusicNode.start(n),this.bgMusicNode.connect(this.bgMusicGain)}stopBgMusic(){this.isBgMusicPlaying()&&(this.bgMusicNode.stop(0),this.bgMusicNode=null)}isBgMusicPlaying(){return this.bgMusicNode!==null}playCue(e,t=1){let i=M.files.get(e),n=this.audioContext.createBufferSource();n.buffer=i,n.start(0);let s=this.audioContext.createGain();s.connect(this.cueGain),s.gain.value=B.sat(t),n.connect(s)}onResume(){this.audioContext.state=="suspended"&&this.audioContext.resume()}};var Or=class{type;constructor(){this.detectDeviceType()}detectDeviceType(){let e=navigator.userAgent;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(e)?this.type="mobile":this.type="desktop"}};var M=class{static async init(e){this.graphics=new lr(e),this.files=new cr,this.input=new or,this.audio=new Nr,this.device=new Or;for(let t of["mousedown","touchdown","keydown"])addEventListener(t,()=>this.audio.onResume());this.input.initEvents(),this.graphics.compileShaders(),this.graphics.generateFonts(),e.preload(),await this.files.waitForAssetsToLoad(),e.create(),addEventListener("resize",()=>this.graphics.onResize()),this.graphics.onResize(),this.graphics.onResume()}static get gl(){return this.graphics.gl}};U(M,"graphics"),U(M,"files"),U(M,"input"),U(M,"audio"),U(M,"device");export{_r as Game,M as Gol,Cr as Screen,tt as glMatrix,it as graphics,nt as math};
//# sourceMappingURL=goliath.esm.min.js.map
